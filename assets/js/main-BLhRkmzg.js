!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e={};function t(e){let t=e.length;for(;--t>=0;)e[t]=0}const n=256,s=286,i=30,a=15,o=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),r=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),l=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),c=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new Array(576);t(d);const h=new Array(60);t(h);const u=new Array(512);t(u);const g=new Array(256);t(g);const m=new Array(29);t(m);const p=new Array(i);function f(e,t,n,s,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=s,this.max_length=i,this.has_stree=e&&e.length}let y,w,b;function v(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(p);const _=e=>e<256?u[e]:u[256+(e>>>7)],k=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},E=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,k(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},x=(e,t,n)=>{E(e,n[2*t],n[2*t+1])},S=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},C=(e,t,n)=>{const s=new Array(16);let i,o,r=0;for(i=1;i<=a;i++)r=r+n[i-1]<<1,s[i]=r;for(o=0;o<=t;o++){let t=e[2*o+1];0!==t&&(e[2*o]=S(s[t]++,t))}},I=e=>{let t;for(t=0;t<s;t++)e.dyn_ltree[2*t]=0;for(t=0;t<i;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},D=e=>{e.bi_valid>8?k(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},L=(e,t,n,s)=>{const i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&s[t]<=s[n]},z=(e,t,n)=>{const s=e.heap[n];let i=n<<1;for(;i<=e.heap_len&&(i<e.heap_len&&L(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!L(t,s,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=s},T=(e,t,s)=>{let i,a,l,c,d=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+d++],i+=(255&e.pending_buf[e.sym_buf+d++])<<8,a=e.pending_buf[e.sym_buf+d++],0===i?x(e,a,t):(l=g[a],x(e,l+n+1,t),c=o[l],0!==c&&(a-=m[l],E(e,a,c)),i--,l=_(i),x(e,l,s),c=r[l],0!==c&&(i-=p[l],E(e,i,c)))}while(d<e.sym_next);x(e,256,t)},M=(e,t)=>{const n=t.dyn_tree,s=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems;let r,l,c,d=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<o;r++)0!==n[2*r]?(e.heap[++e.heap_len]=d=r,e.depth[r]=0):n[2*r+1]=0;for(;e.heap_len<2;)c=e.heap[++e.heap_len]=d<2?++d:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,i&&(e.static_len-=s[2*c+1]);for(t.max_code=d,r=e.heap_len>>1;r>=1;r--)z(e,n,r);c=o;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],z(e,n,1),l=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=l,n[2*c]=n[2*r]+n[2*l],e.depth[c]=(e.depth[r]>=e.depth[l]?e.depth[r]:e.depth[l])+1,n[2*r+1]=n[2*l+1]=c,e.heap[1]=c++,z(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,s=t.max_code,i=t.stat_desc.static_tree,o=t.stat_desc.has_stree,r=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,c=t.stat_desc.max_length;let d,h,u,g,m,p,f=0;for(g=0;g<=a;g++)e.bl_count[g]=0;for(n[2*e.heap[e.heap_max]+1]=0,d=e.heap_max+1;d<573;d++)h=e.heap[d],g=n[2*n[2*h+1]+1]+1,g>c&&(g=c,f++),n[2*h+1]=g,h>s||(e.bl_count[g]++,m=0,h>=l&&(m=r[h-l]),p=n[2*h],e.opt_len+=p*(g+m),o&&(e.static_len+=p*(i[2*h+1]+m)));if(0!==f){do{for(g=c-1;0===e.bl_count[g];)g--;e.bl_count[g]--,e.bl_count[g+1]+=2,e.bl_count[c]--,f-=2}while(f>0);for(g=c;0!==g;g--)for(h=e.bl_count[g];0!==h;)u=e.heap[--d],u>s||(n[2*u+1]!==g&&(e.opt_len+=(g-n[2*u+1])*n[2*u],n[2*u+1]=g),h--)}})(e,t),C(n,d,e.bl_count)},A=(e,t,n)=>{let s,i,a=-1,o=t[1],r=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(n+1)+1]=65535,s=0;s<=n;s++)i=o,o=t[2*(s+1)+1],++r<l&&i===o||(r<c?e.bl_tree[2*i]+=r:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[32]++):r<=10?e.bl_tree[34]++:e.bl_tree[36]++,r=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4))},B=(e,t,n)=>{let s,i,a=-1,o=t[1],r=0,l=7,c=4;for(0===o&&(l=138,c=3),s=0;s<=n;s++)if(i=o,o=t[2*(s+1)+1],!(++r<l&&i===o)){if(r<c)do{x(e,i,e.bl_tree)}while(0!==--r);else 0!==i?(i!==a&&(x(e,i,e.bl_tree),r--),x(e,16,e.bl_tree),E(e,r-3,2)):r<=10?(x(e,17,e.bl_tree),E(e,r-3,3)):(x(e,18,e.bl_tree),E(e,r-11,7));r=0,a=i,0===o?(l=138,c=3):i===o?(l=6,c=3):(l=7,c=4)}};let W=!1;const R=(e,t,n,s)=>{E(e,0+(s?1:0),3),D(e),k(e,n),k(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var N={_tr_init:e=>{W||((()=>{let e,t,n,c,v;const _=new Array(16);for(n=0,c=0;c<28;c++)for(m[c]=n,e=0;e<1<<o[c];e++)g[n++]=c;for(g[n-1]=c,v=0,c=0;c<16;c++)for(p[c]=v,e=0;e<1<<r[c];e++)u[v++]=c;for(v>>=7;c<i;c++)for(p[c]=v<<7,e=0;e<1<<r[c]-7;e++)u[256+v++]=c;for(t=0;t<=a;t++)_[t]=0;for(e=0;e<=143;)d[2*e+1]=8,e++,_[8]++;for(;e<=255;)d[2*e+1]=9,e++,_[9]++;for(;e<=279;)d[2*e+1]=7,e++,_[7]++;for(;e<=287;)d[2*e+1]=8,e++,_[8]++;for(C(d,287,_),e=0;e<i;e++)h[2*e+1]=5,h[2*e]=S(e,5);y=new f(d,o,257,s,a),w=new f(h,r,0,i,a),b=new f(new Array(0),l,0,19,7)})(),W=!0),e.l_desc=new v(e.dyn_ltree,y),e.d_desc=new v(e.dyn_dtree,w),e.bl_desc=new v(e.bl_tree,b),e.bi_buf=0,e.bi_valid=0,I(e)},_tr_stored_block:R,_tr_flush_block:(e,t,s,i)=>{let a,o,r=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<n;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),M(e,e.l_desc),M(e,e.d_desc),r=(e=>{let t;for(A(e,e.dyn_ltree,e.l_desc.max_code),A(e,e.dyn_dtree,e.d_desc.max_code),M(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*c[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=a&&(a=o)):a=o=s+5,s+4<=a&&-1!==t?R(e,t,s,i):4===e.strategy||o===a?(E(e,2+(i?1:0),3),T(e,d,h)):(E(e,4+(i?1:0),3),((e,t,n,s)=>{let i;for(E(e,t-257,5),E(e,n-1,5),E(e,s-4,4),i=0;i<s;i++)E(e,e.bl_tree[2*c[i]+1],3);B(e,e.dyn_ltree,t-1),B(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),T(e,e.dyn_ltree,e.dyn_dtree)),I(e),i&&D(e)},_tr_tally:(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(g[s]+n+1)]++,e.dyn_dtree[2*_(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{E(e,2,3),x(e,256,d),(e=>{16===e.bi_valid?(k(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var F=(e,t,n,s)=>{let i=65535&e,a=e>>>16&65535,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{i=i+t[s++]|0,a=a+i|0}while(--o);i%=65521,a%=65521}return i|a<<16};const $=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var O=(e,t,n,s)=>{const i=$,a=s+n;e^=-1;for(let o=s;o<a;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},U={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},H={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:P,_tr_stored_block:G,_tr_flush_block:V,_tr_tally:Z,_tr_align:q}=N,{Z_NO_FLUSH:j,Z_PARTIAL_FLUSH:K,Z_FULL_FLUSH:Y,Z_FINISH:X,Z_BLOCK:Q,Z_OK:J,Z_STREAM_END:ee,Z_STREAM_ERROR:te,Z_DATA_ERROR:ne,Z_BUF_ERROR:se,Z_DEFAULT_COMPRESSION:ie,Z_FILTERED:ae,Z_HUFFMAN_ONLY:oe,Z_RLE:re,Z_FIXED:le,Z_DEFAULT_STRATEGY:ce,Z_UNKNOWN:de,Z_DEFLATED:he}=H,ue=258,ge=262,me=42,pe=113,fe=666,ye=(e,t)=>(e.msg=U[t],t),we=e=>2*e-(e>4?9:0),be=e=>{let t=e.length;for(;--t>=0;)e[t]=0},ve=e=>{let t,n,s,i=e.w_size;t=e.hash_size,s=t;do{n=e.head[--s],e.head[s]=n>=i?n-i:0}while(--t);t=i,s=t;do{n=e.prev[--s],e.prev[s]=n>=i?n-i:0}while(--t)};let _e=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ke=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Ee=(e,t)=>{V(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ke(e.strm)},xe=(e,t)=>{e.pending_buf[e.pending++]=t},Se=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Ce=(e,t,n,s)=>{let i=e.avail_in;return i>s&&(i=s),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=F(e.adler,t,i,n):2===e.state.wrap&&(e.adler=O(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},Ie=(e,t)=>{let n,s,i=e.max_chain_length,a=e.strstart,o=e.prev_length,r=e.nice_match;const l=e.strstart>e.w_size-ge?e.strstart-(e.w_size-ge):0,c=e.window,d=e.w_mask,h=e.prev,u=e.strstart+ue;let g=c[a+o-1],m=c[a+o];e.prev_length>=e.good_match&&(i>>=2),r>e.lookahead&&(r=e.lookahead);do{if(n=t,c[n+o]===m&&c[n+o-1]===g&&c[n]===c[a]&&c[++n]===c[a+1]){a+=2,n++;do{}while(c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&c[++a]===c[++n]&&a<u);if(s=ue-(u-a),a=u-ue,s>o){if(e.match_start=t,o=s,s>=r)break;g=c[a+o-1],m=c[a+o]}}}while((t=h[t&d])>l&&0!==--i);return o<=e.lookahead?o:e.lookahead},De=e=>{const t=e.w_size;let n,s,i;do{if(s=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ge)&&(e.window.set(e.window.subarray(t,t+t-s),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),ve(e),s+=t),0===e.strm.avail_in)break;if(n=Ce(e.strm,e.window,e.strstart+e.lookahead,s),e.lookahead+=n,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=_e(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=_e(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ge&&0!==e.strm.avail_in)},Le=(e,t)=>{let n,s,i,a=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,r=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,s=e.strstart-e.block_start,n>s+e.strm.avail_in&&(n=s+e.strm.avail_in),n>i&&(n=i),n<a&&(0===n&&t!==X||t===j||n!==s+e.strm.avail_in))break;o=t===X&&n===s+e.strm.avail_in?1:0,G(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ke(e.strm),s&&(s>n&&(s=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+s),e.strm.next_out),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s,e.block_start+=s,n-=s),n&&(Ce(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return r-=e.strm.avail_in,r&&(r>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=r&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-r,e.strm.next_in),e.strstart),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==j&&t!==X&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Ce(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,a=i>e.w_size?e.w_size:i,s=e.strstart-e.block_start,(s>=a||(s||t===X)&&t!==j&&0===e.strm.avail_in&&s<=i)&&(n=s>i?i:s,o=t===X&&0===e.strm.avail_in&&n===s?1:0,G(e,e.block_start,n,o),e.block_start+=n,ke(e.strm)),o?3:1)},ze=(e,t)=>{let n,s;for(;;){if(e.lookahead<ge){if(De(e),e.lookahead<ge&&t===j)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=_e(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ge&&(e.match_length=Ie(e,n)),e.match_length>=3)if(s=Z(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=_e(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=_e(e,e.ins_h,e.window[e.strstart+1]);else s=Z(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(Ee(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===X?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2},Te=(e,t)=>{let n,s,i;for(;;){if(e.lookahead<ge){if(De(e),e.lookahead<ge&&t===j)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=_e(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ge&&(e.match_length=Ie(e,n),e.match_length<=5&&(e.strategy===ae||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,s=Z(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=_e(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(Ee(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=Z(e,0,e.window[e.strstart-1]),s&&Ee(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Z(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===X?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2};function Me(e,t,n,s,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=s,this.func=i}const Ae=[new Me(0,0,0,0,Le),new Me(4,4,8,4,ze),new Me(4,5,16,8,ze),new Me(4,6,32,32,ze),new Me(4,4,16,16,Te),new Me(8,16,32,32,Te),new Me(8,16,128,128,Te),new Me(8,32,128,256,Te),new Me(32,128,258,1024,Te),new Me(32,258,258,4096,Te)];function Be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=he,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),be(this.dyn_ltree),be(this.dyn_dtree),be(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),be(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),be(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const We=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==me&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==pe&&t.status!==fe?1:0},Re=e=>{if(We(e))return ye(e,te);e.total_in=e.total_out=0,e.data_type=de;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?me:pe,e.adler=2===t.wrap?0:1,t.last_flush=-2,P(t),J},Ne=e=>{const t=Re(e);var n;return t===J&&((n=e.state).window_size=2*n.w_size,be(n.head),n.max_lazy_match=Ae[n.level].max_lazy,n.good_match=Ae[n.level].good_length,n.nice_match=Ae[n.level].nice_length,n.max_chain_length=Ae[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},Fe=(e,t,n,s,i,a)=>{if(!e)return te;let o=1;if(t===ie&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),i<1||i>9||n!==he||s<8||s>15||t<0||t>9||a<0||a>le||8===s&&1!==o)return ye(e,te);8===s&&(s=9);const r=new Be;return e.state=r,r.strm=e,r.status=me,r.wrap=o,r.gzhead=null,r.w_bits=s,r.w_size=1<<r.w_bits,r.w_mask=r.w_size-1,r.hash_bits=i+7,r.hash_size=1<<r.hash_bits,r.hash_mask=r.hash_size-1,r.hash_shift=~~((r.hash_bits+3-1)/3),r.window=new Uint8Array(2*r.w_size),r.head=new Uint16Array(r.hash_size),r.prev=new Uint16Array(r.w_size),r.lit_bufsize=1<<i+6,r.pending_buf_size=4*r.lit_bufsize,r.pending_buf=new Uint8Array(r.pending_buf_size),r.sym_buf=r.lit_bufsize,r.sym_end=3*(r.lit_bufsize-1),r.level=t,r.strategy=a,r.method=n,Ne(e)};var $e={deflateInit:(e,t)=>Fe(e,t,he,15,8,ce),deflateInit2:Fe,deflateReset:Ne,deflateResetKeep:Re,deflateSetHeader:(e,t)=>We(e)||2!==e.state.wrap?te:(e.state.gzhead=t,J),deflate:(e,t)=>{if(We(e)||t>Q||t<0)return e?ye(e,te):te;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===fe&&t!==X)return ye(e,0===e.avail_out?se:te);const s=n.last_flush;if(n.last_flush=t,0!==n.pending){if(ke(e),0===e.avail_out)return n.last_flush=-1,J}else if(0===e.avail_in&&we(t)<=we(s)&&t!==X)return ye(e,se);if(n.status===fe&&0!==e.avail_in)return ye(e,se);if(n.status===me&&0===n.wrap&&(n.status=pe),n.status===me){let t=he+(n.w_bits-8<<4)<<8,s=-1;if(s=n.strategy>=oe||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=s<<6,0!==n.strstart&&(t|=32),t+=31-t%31,Se(n,t),0!==n.strstart&&(Se(n,e.adler>>>16),Se(n,65535&e.adler)),e.adler=1,n.status=pe,ke(e),0!==n.pending)return n.last_flush=-1,J}if(57===n.status)if(e.adler=0,xe(n,31),xe(n,139),xe(n,8),n.gzhead)xe(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),xe(n,255&n.gzhead.time),xe(n,n.gzhead.time>>8&255),xe(n,n.gzhead.time>>16&255),xe(n,n.gzhead.time>>24&255),xe(n,9===n.level?2:n.strategy>=oe||n.level<2?4:0),xe(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(xe(n,255&n.gzhead.extra.length),xe(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=O(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(xe(n,0),xe(n,0),xe(n,0),xe(n,0),xe(n,0),xe(n,9===n.level?2:n.strategy>=oe||n.level<2?4:0),xe(n,3),n.status=pe,ke(e),0!==n.pending)return n.last_flush=-1,J;if(69===n.status){if(n.gzhead.extra){let t=n.pending,s=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+s>n.pending_buf_size;){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=O(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=i,ke(e),0!==n.pending)return n.last_flush=-1,J;t=0,s-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending+=s,n.gzhead.hcrc&&n.pending>t&&(e.adler=O(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=O(e.adler,n.pending_buf,n.pending-s,s)),ke(e),0!==n.pending)return n.last_flush=-1,J;s=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,xe(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>s&&(e.adler=O(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,s=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>s&&(e.adler=O(e.adler,n.pending_buf,n.pending-s,s)),ke(e),0!==n.pending)return n.last_flush=-1,J;s=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,xe(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>s&&(e.adler=O(e.adler,n.pending_buf,n.pending-s,s))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ke(e),0!==n.pending))return n.last_flush=-1,J;xe(n,255&e.adler),xe(n,e.adler>>8&255),e.adler=0}if(n.status=pe,ke(e),0!==n.pending)return n.last_flush=-1,J}if(0!==e.avail_in||0!==n.lookahead||t!==j&&n.status!==fe){let s=0===n.level?Le(n,t):n.strategy===oe?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(De(e),0===e.lookahead)){if(t===j)return 1;break}if(e.match_length=0,n=Z(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Ee(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===re?((e,t)=>{let n,s,i,a;const o=e.window;for(;;){if(e.lookahead<=ue){if(De(e),e.lookahead<=ue&&t===j)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,s=o[i],s===o[++i]&&s===o[++i]&&s===o[++i])){a=e.strstart+ue;do{}while(s===o[++i]&&s===o[++i]&&s===o[++i]&&s===o[++i]&&s===o[++i]&&s===o[++i]&&s===o[++i]&&s===o[++i]&&i<a);e.match_length=ue-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=Z(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=Z(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Ee(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2})(n,t):Ae[n.level].func(n,t);if(3!==s&&4!==s||(n.status=fe),1===s||3===s)return 0===e.avail_out&&(n.last_flush=-1),J;if(2===s&&(t===K?q(n):t!==Q&&(G(n,0,0,!1),t===Y&&(be(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),ke(e),0===e.avail_out))return n.last_flush=-1,J}return t!==X?J:n.wrap<=0?ee:(2===n.wrap?(xe(n,255&e.adler),xe(n,e.adler>>8&255),xe(n,e.adler>>16&255),xe(n,e.adler>>24&255),xe(n,255&e.total_in),xe(n,e.total_in>>8&255),xe(n,e.total_in>>16&255),xe(n,e.total_in>>24&255)):(Se(n,e.adler>>>16),Se(n,65535&e.adler)),ke(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?J:ee)},deflateEnd:e=>{if(We(e))return te;const t=e.state.status;return e.state=null,t===pe?ye(e,ne):J},deflateSetDictionary:(e,t)=>{let n=t.length;if(We(e))return te;const s=e.state,i=s.wrap;if(2===i||1===i&&s.status!==me||s.lookahead)return te;if(1===i&&(e.adler=F(e.adler,t,n,0)),s.wrap=0,n>=s.w_size){0===i&&(be(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(n-s.w_size,n),0),t=e,n=s.w_size}const a=e.avail_in,o=e.next_in,r=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,De(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=_e(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,De(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=o,e.input=r,e.avail_in=a,s.wrap=i,J},deflateInfo:"pako deflate (from Nodeca project)"};const Oe=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Ue=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Oe(n,t)&&(e[t]=n[t])}}return e},He=e=>{let t=0;for(let s=0,i=e.length;s<i;s++)t+=e[s].length;const n=new Uint8Array(t);for(let s=0,i=0,a=e.length;s<a;s++){let t=e[s];n.set(t,i),i+=t.length}return n};let Pe=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(An){Pe=!1}const Ge=new Uint8Array(256);for(let Bn=0;Bn<256;Bn++)Ge[Bn]=Bn>=252?6:Bn>=248?5:Bn>=240?4:Bn>=224?3:Bn>=192?2:1;Ge[254]=Ge[254]=1;var Ve=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,s,i,a,o=e.length,r=0;for(i=0;i<o;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<o&&(s=e.charCodeAt(i+1),56320==(64512&s)&&(n=65536+(n-55296<<10)+(s-56320),i++)),r+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(r),a=0,i=0;a<r;i++)n=e.charCodeAt(i),55296==(64512&n)&&i+1<o&&(s=e.charCodeAt(i+1),56320==(64512&s)&&(n=65536+(n-55296<<10)+(s-56320),i++)),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},Ze=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,i;const a=new Array(2*n);for(i=0,s=0;s<n;){let t=e[s++];if(t<128){a[i++]=t;continue}let o=Ge[t];if(o>4)a[i++]=65533,s+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&s<n;)t=t<<6|63&e[s++],o--;o>1?a[i++]=65533:t<65536?a[i++]=t:(t-=65536,a[i++]=55296|t>>10&1023,a[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Pe)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let s=0;s<t;s++)n+=String.fromCharCode(e[s]);return n})(a,i)},qe=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Ge[e[n]]>t?n:t};var je=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ke=Object.prototype.toString,{Z_NO_FLUSH:Ye,Z_SYNC_FLUSH:Xe,Z_FULL_FLUSH:Qe,Z_FINISH:Je,Z_OK:et,Z_STREAM_END:tt,Z_DEFAULT_COMPRESSION:nt,Z_DEFAULT_STRATEGY:st,Z_DEFLATED:it}=H;function at(e){this.options=Ue({level:nt,method:it,chunkSize:16384,windowBits:15,memLevel:8,strategy:st},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new je,this.strm.avail_out=0;let n=$e.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==et)throw new Error(U[n]);if(t.header&&$e.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Ve(t.dictionary):"[object ArrayBuffer]"===Ke.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=$e.deflateSetDictionary(this.strm,e),n!==et)throw new Error(U[n]);this._dict_set=!0}}function ot(e,t){const n=new at(t);if(n.push(e,!0),n.err)throw n.msg||U[n.err];return n.result}at.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize;let i,a;if(this.ended)return!1;for(a=t===~~t?t:!0===t?Je:Ye,"string"==typeof e?n.input=Ve(e):"[object ArrayBuffer]"===Ke.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),(a===Xe||a===Qe)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=$e.deflate(n,a),i===tt)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=$e.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===et;if(0!==n.avail_out){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},at.prototype.onData=function(e){this.chunks.push(e)},at.prototype.onEnd=function(e){e===et&&(this.result=He(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var rt={Deflate:at,deflate:ot,deflateRaw:function(e,t){return(t=t||{}).raw=!0,ot(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,ot(e,t)}};const lt=16209;var ct=function(e,t){let n,s,i,a,o,r,l,c,d,h,u,g,m,p,f,y,w,b,v,_,k,E,x,S;const C=e.state;n=e.next_in,x=e.input,s=n+(e.avail_in-5),i=e.next_out,S=e.output,a=i-(t-e.avail_out),o=i+(e.avail_out-257),r=C.dmax,l=C.wsize,c=C.whave,d=C.wnext,h=C.window,u=C.hold,g=C.bits,m=C.lencode,p=C.distcode,f=(1<<C.lenbits)-1,y=(1<<C.distbits)-1;e:do{g<15&&(u+=x[n++]<<g,g+=8,u+=x[n++]<<g,g+=8),w=m[u&f];t:for(;;){if(b=w>>>24,u>>>=b,g-=b,b=w>>>16&255,0===b)S[i++]=65535&w;else{if(!(16&b)){if(64&b){if(32&b){C.mode=16191;break e}e.msg="invalid literal/length code",C.mode=lt;break e}w=m[(65535&w)+(u&(1<<b)-1)];continue t}for(v=65535&w,b&=15,b&&(g<b&&(u+=x[n++]<<g,g+=8),v+=u&(1<<b)-1,u>>>=b,g-=b),g<15&&(u+=x[n++]<<g,g+=8,u+=x[n++]<<g,g+=8),w=p[u&y];;){if(b=w>>>24,u>>>=b,g-=b,b=w>>>16&255,16&b){if(_=65535&w,b&=15,g<b&&(u+=x[n++]<<g,g+=8,g<b&&(u+=x[n++]<<g,g+=8)),_+=u&(1<<b)-1,_>r){e.msg="invalid distance too far back",C.mode=lt;break e}if(u>>>=b,g-=b,b=i-a,_>b){if(b=_-b,b>c&&C.sane){e.msg="invalid distance too far back",C.mode=lt;break e}if(k=0,E=h,0===d){if(k+=l-b,b<v){v-=b;do{S[i++]=h[k++]}while(--b);k=i-_,E=S}}else if(d<b){if(k+=l+d-b,b-=d,b<v){v-=b;do{S[i++]=h[k++]}while(--b);if(k=0,d<v){b=d,v-=b;do{S[i++]=h[k++]}while(--b);k=i-_,E=S}}}else if(k+=d-b,b<v){v-=b;do{S[i++]=h[k++]}while(--b);k=i-_,E=S}for(;v>2;)S[i++]=E[k++],S[i++]=E[k++],S[i++]=E[k++],v-=3;v&&(S[i++]=E[k++],v>1&&(S[i++]=E[k++]))}else{k=i-_;do{S[i++]=S[k++],S[i++]=S[k++],S[i++]=S[k++],v-=3}while(v>2);v&&(S[i++]=S[k++],v>1&&(S[i++]=S[k++]))}break}if(64&b){e.msg="invalid distance code",C.mode=lt;break e}w=p[(65535&w)+(u&(1<<b)-1)]}}break}}while(n<s&&i<o);v=g>>3,n-=v,g-=v<<3,u&=(1<<g)-1,e.next_in=n,e.next_out=i,e.avail_in=n<s?s-n+5:5-(n-s),e.avail_out=i<o?o-i+257:257-(i-o),C.hold=u,C.bits=g};const dt=15,ht=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ut=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),gt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),mt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var pt=(e,t,n,s,i,a,o,r)=>{const l=r.bits;let c,d,h,u,g,m,p=0,f=0,y=0,w=0,b=0,v=0,_=0,k=0,E=0,x=0,S=null;const C=new Uint16Array(16),I=new Uint16Array(16);let D,L,z,T=null;for(p=0;p<=dt;p++)C[p]=0;for(f=0;f<s;f++)C[t[n+f]]++;for(b=l,w=dt;w>=1&&0===C[w];w--);if(b>w&&(b=w),0===w)return i[a++]=20971520,i[a++]=20971520,r.bits=1,0;for(y=1;y<w&&0===C[y];y++);for(b<y&&(b=y),k=1,p=1;p<=dt;p++)if(k<<=1,k-=C[p],k<0)return-1;if(k>0&&(0===e||1!==w))return-1;for(I[1]=0,p=1;p<dt;p++)I[p+1]=I[p]+C[p];for(f=0;f<s;f++)0!==t[n+f]&&(o[I[t[n+f]]++]=f);if(0===e?(S=T=o,m=20):1===e?(S=ht,T=ut,m=257):(S=gt,T=mt,m=0),x=0,f=0,p=y,g=a,v=b,_=0,h=-1,E=1<<b,u=E-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){D=p-_,o[f]+1<m?(L=0,z=o[f]):o[f]>=m?(L=T[o[f]-m],z=S[o[f]-m]):(L=96,z=0),c=1<<p-_,d=1<<v,y=d;do{d-=c,i[g+(x>>_)+d]=D<<24|L<<16|z}while(0!==d);for(c=1<<p-1;x&c;)c>>=1;if(0!==c?(x&=c-1,x+=c):x=0,f++,0===--C[p]){if(p===w)break;p=t[n+o[f]]}if(p>b&&(x&u)!==h){for(0===_&&(_=b),g+=y,v=p-_,k=1<<v;v+_<w&&(k-=C[v+_],!(k<=0));)v++,k<<=1;if(E+=1<<v,1===e&&E>852||2===e&&E>592)return 1;h=x&u,i[h]=b<<24|v<<16|g-a}}return 0!==x&&(i[g+x]=p-_<<24|64<<16),r.bits=b,0};const{Z_FINISH:ft,Z_BLOCK:yt,Z_TREES:wt,Z_OK:bt,Z_STREAM_END:vt,Z_NEED_DICT:_t,Z_STREAM_ERROR:kt,Z_DATA_ERROR:Et,Z_MEM_ERROR:xt,Z_BUF_ERROR:St,Z_DEFLATED:Ct}=H,It=16180,Dt=16190,Lt=16191,zt=16192,Tt=16194,Mt=16199,At=16200,Bt=16206,Wt=16209,Rt=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Nt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ft=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<It||t.mode>16211?1:0},$t=e=>{if(Ft(e))return kt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=It,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,bt},Ot=e=>{if(Ft(e))return kt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,$t(e)},Ut=(e,t)=>{let n;if(Ft(e))return kt;const s=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?kt:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=n,s.wbits=t,Ot(e))},Ht=(e,t)=>{if(!e)return kt;const n=new Nt;e.state=n,n.strm=e,n.window=null,n.mode=It;const s=Ut(e,t);return s!==bt&&(e.state=null),s};let Pt,Gt,Vt=!0;const Zt=e=>{if(Vt){Pt=new Int32Array(512),Gt=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(pt(1,e.lens,0,288,Pt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;pt(2,e.lens,0,32,Gt,0,e.work,{bits:5}),Vt=!1}e.lencode=Pt,e.lenbits=9,e.distcode=Gt,e.distbits=5},qt=(e,t,n,s)=>{let i;const a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),s>=a.wsize?(a.window.set(t.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>s&&(i=s),a.window.set(t.subarray(n-s,n-s+i),a.wnext),(s-=i)?(a.window.set(t.subarray(n-s,n),0),a.wnext=s,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0};var jt={inflateReset:Ot,inflateReset2:Ut,inflateResetKeep:$t,inflateInit:e=>Ht(e,15),inflateInit2:Ht,inflate:(e,t)=>{let n,s,i,a,o,r,l,c,d,h,u,g,m,p,f,y,w,b,v,_,k,E,x=0;const S=new Uint8Array(4);let C,I;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ft(e)||!e.output||!e.input&&0!==e.avail_in)return kt;n=e.state,n.mode===Lt&&(n.mode=zt),o=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,s=e.input,r=e.avail_in,c=n.hold,d=n.bits,h=r,u=l,E=bt;e:for(;;)switch(n.mode){case It:if(0===n.wrap){n.mode=zt;break}for(;d<16;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,S[0]=255&c,S[1]=c>>>8&255,n.check=O(n.check,S,2,0),c=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=Wt;break}if((15&c)!==Ct){e.msg="unknown compression method",n.mode=Wt;break}if(c>>>=4,d-=4,k=8+(15&c),0===n.wbits&&(n.wbits=k),k>15||k>n.wbits){e.msg="invalid window size",n.mode=Wt;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:Lt,c=0,d=0;break;case 16181:for(;d<16;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}if(n.flags=c,(255&n.flags)!==Ct){e.msg="unknown compression method",n.mode=Wt;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Wt;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(S[0]=255&c,S[1]=c>>>8&255,n.check=O(n.check,S,2,0)),c=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(S[0]=255&c,S[1]=c>>>8&255,S[2]=c>>>16&255,S[3]=c>>>24&255,n.check=O(n.check,S,4,0)),c=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(S[0]=255&c,S[1]=c>>>8&255,n.check=O(n.check,S,2,0)),c=0,d=0,n.mode=16184;case 16184:if(1024&n.flags){for(;d<16;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(S[0]=255&c,S[1]=c>>>8&255,n.check=O(n.check,S,2,0)),c=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(g=n.length,g>r&&(g=r),g&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(s.subarray(a,a+g),k)),512&n.flags&&4&n.wrap&&(n.check=O(n.check,s,g,a)),r-=g,a+=g,n.length-=g),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===r)break e;g=0;do{k=s[a+g++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&g<r);if(512&n.flags&&4&n.wrap&&(n.check=O(n.check,s,g,a)),r-=g,a+=g,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===r)break e;g=0;do{k=s[a+g++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&g<r);if(512&n.flags&&4&n.wrap&&(n.check=O(n.check,s,g,a)),r-=g,a+=g,k)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;d<16;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Wt;break}c=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Lt;break;case 16189:for(;d<32;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}e.adler=n.check=Rt(c),c=0,d=0,n.mode=Dt;case Dt:if(0===n.havedict)return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=r,n.hold=c,n.bits=d,_t;e.adler=n.check=1,n.mode=Lt;case Lt:if(t===yt||t===wt)break e;case zt:if(n.last){c>>>=7&d,d-=7&d,n.mode=Bt;break}for(;d<3;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}switch(n.last=1&c,c>>>=1,d-=1,3&c){case 0:n.mode=16193;break;case 1:if(Zt(n),n.mode=Mt,t===wt){c>>>=2,d-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Wt}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Wt;break}if(n.length=65535&c,c=0,d=0,n.mode=Tt,t===wt)break e;case Tt:n.mode=16195;case 16195:if(g=n.length,g){if(g>r&&(g=r),g>l&&(g=l),0===g)break e;i.set(s.subarray(a,a+g),o),r-=g,a+=g,l-=g,o+=g,n.length-=g;break}n.mode=Lt;break;case 16196:for(;d<14;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}if(n.nlen=257+(31&c),c>>>=5,d-=5,n.ndist=1+(31&c),c>>>=5,d-=5,n.ncode=4+(15&c),c>>>=4,d-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Wt;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}n.lens[D[n.have++]]=7&c,c>>>=3,d-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},E=pt(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,E){e.msg="invalid code lengths set",n.mode=Wt;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;x=n.lencode[c&(1<<n.lenbits)-1],f=x>>>24,y=x>>>16&255,w=65535&x,!(f<=d);){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}if(w<16)c>>>=f,d-=f,n.lens[n.have++]=w;else{if(16===w){for(I=f+2;d<I;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}if(c>>>=f,d-=f,0===n.have){e.msg="invalid bit length repeat",n.mode=Wt;break}k=n.lens[n.have-1],g=3+(3&c),c>>>=2,d-=2}else if(17===w){for(I=f+3;d<I;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}c>>>=f,d-=f,k=0,g=3+(7&c),c>>>=3,d-=3}else{for(I=f+7;d<I;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}c>>>=f,d-=f,k=0,g=11+(127&c),c>>>=7,d-=7}if(n.have+g>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Wt;break}for(;g--;)n.lens[n.have++]=k}}if(n.mode===Wt)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Wt;break}if(n.lenbits=9,C={bits:n.lenbits},E=pt(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,E){e.msg="invalid literal/lengths set",n.mode=Wt;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},E=pt(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,E){e.msg="invalid distances set",n.mode=Wt;break}if(n.mode=Mt,t===wt)break e;case Mt:n.mode=At;case At:if(r>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=r,n.hold=c,n.bits=d,ct(e,u),o=e.next_out,i=e.output,l=e.avail_out,a=e.next_in,s=e.input,r=e.avail_in,c=n.hold,d=n.bits,n.mode===Lt&&(n.back=-1);break}for(n.back=0;x=n.lencode[c&(1<<n.lenbits)-1],f=x>>>24,y=x>>>16&255,w=65535&x,!(f<=d);){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}if(y&&!(240&y)){for(b=f,v=y,_=w;x=n.lencode[_+((c&(1<<b+v)-1)>>b)],f=x>>>24,y=x>>>16&255,w=65535&x,!(b+f<=d);){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}c>>>=b,d-=b,n.back+=b}if(c>>>=f,d-=f,n.back+=f,n.length=w,0===y){n.mode=16205;break}if(32&y){n.back=-1,n.mode=Lt;break}if(64&y){e.msg="invalid literal/length code",n.mode=Wt;break}n.extra=15&y,n.mode=16201;case 16201:if(n.extra){for(I=n.extra;d<I;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;x=n.distcode[c&(1<<n.distbits)-1],f=x>>>24,y=x>>>16&255,w=65535&x,!(f<=d);){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}if(!(240&y)){for(b=f,v=y,_=w;x=n.distcode[_+((c&(1<<b+v)-1)>>b)],f=x>>>24,y=x>>>16&255,w=65535&x,!(b+f<=d);){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}c>>>=b,d-=b,n.back+=b}if(c>>>=f,d-=f,n.back+=f,64&y){e.msg="invalid distance code",n.mode=Wt;break}n.offset=w,n.extra=15&y,n.mode=16203;case 16203:if(n.extra){for(I=n.extra;d<I;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Wt;break}n.mode=16204;case 16204:if(0===l)break e;if(g=u-l,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Wt;break}g>n.wnext?(g-=n.wnext,m=n.wsize-g):m=n.wnext-g,g>n.length&&(g=n.length),p=n.window}else p=i,m=o-n.offset,g=n.length;g>l&&(g=l),l-=g,n.length-=g;do{i[o++]=p[m++]}while(--g);0===n.length&&(n.mode=At);break;case 16205:if(0===l)break e;i[o++]=n.length,l--,n.mode=At;break;case Bt:if(n.wrap){for(;d<32;){if(0===r)break e;r--,c|=s[a++]<<d,d+=8}if(u-=l,e.total_out+=u,n.total+=u,4&n.wrap&&u&&(e.adler=n.check=n.flags?O(n.check,i,u,o-u):F(n.check,i,u,o-u)),u=l,4&n.wrap&&(n.flags?c:Rt(c))!==n.check){e.msg="incorrect data check",n.mode=Wt;break}c=0,d=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;d<32;){if(0===r)break e;r--,c+=s[a++]<<d,d+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Wt;break}c=0,d=0}n.mode=16208;case 16208:E=vt;break e;case Wt:E=Et;break e;case 16210:return xt;default:return kt}return e.next_out=o,e.avail_out=l,e.next_in=a,e.avail_in=r,n.hold=c,n.bits=d,(n.wsize||u!==e.avail_out&&n.mode<Wt&&(n.mode<Bt||t!==ft))&&qt(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,n.total+=u,4&n.wrap&&u&&(e.adler=n.check=n.flags?O(n.check,i,u,e.next_out-u):F(n.check,i,u,e.next_out-u)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Lt?128:0)+(n.mode===Mt||n.mode===Tt?256:0),(0===h&&0===u||t===ft)&&E===bt&&(E=St),E},inflateEnd:e=>{if(Ft(e))return kt;let t=e.state;return t.window&&(t.window=null),e.state=null,bt},inflateGetHeader:(e,t)=>{if(Ft(e))return kt;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,bt):kt},inflateSetDictionary:(e,t)=>{const n=t.length;let s,i,a;return Ft(e)?kt:(s=e.state,0!==s.wrap&&s.mode!==Dt?kt:s.mode===Dt&&(i=1,i=F(i,t,n,0),i!==s.check)?Et:(a=qt(e,t,n,n),a?(s.mode=16210,xt):(s.havedict=1,bt)))},inflateInfo:"pako inflate (from Nodeca project)"};var Kt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Yt=Object.prototype.toString,{Z_NO_FLUSH:Xt,Z_FINISH:Qt,Z_OK:Jt,Z_STREAM_END:en,Z_NEED_DICT:tn,Z_STREAM_ERROR:nn,Z_DATA_ERROR:sn,Z_MEM_ERROR:an}=H;function on(e){this.options=Ue({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new je,this.strm.avail_out=0;let n=jt.inflateInit2(this.strm,t.windowBits);if(n!==Jt)throw new Error(U[n]);if(this.header=new Kt,jt.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Ve(t.dictionary):"[object ArrayBuffer]"===Yt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=jt.inflateSetDictionary(this.strm,t.dictionary),n!==Jt)))throw new Error(U[n])}function rn(e,t){const n=new on(t);if(n.push(e),n.err)throw n.msg||U[n.err];return n.result}on.prototype.push=function(e,t){const n=this.strm,s=this.options.chunkSize,i=this.options.dictionary;let a,o,r;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Qt:Xt,"[object ArrayBuffer]"===Yt.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(s),n.next_out=0,n.avail_out=s),a=jt.inflate(n,o),a===tn&&i&&(a=jt.inflateSetDictionary(n,i),a===Jt?a=jt.inflate(n,o):a===sn&&(a=tn));n.avail_in>0&&a===en&&n.state.wrap>0&&0!==e[n.next_in];)jt.inflateReset(n),a=jt.inflate(n,o);switch(a){case nn:case sn:case tn:case an:return this.onEnd(a),this.ended=!0,!1}if(r=n.avail_out,n.next_out&&(0===n.avail_out||a===en))if("string"===this.options.to){let e=qe(n.output,n.next_out),t=n.next_out-e,i=Ze(n.output,e);n.next_out=t,n.avail_out=s-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==Jt||0!==r){if(a===en)return a=jt.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},on.prototype.onData=function(e){this.chunks.push(e)},on.prototype.onEnd=function(e){e===Jt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=He(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ln={Inflate:on,inflate:rn,inflateRaw:function(e,t){return(t=t||{}).raw=!0,rn(e,t)},ungzip:rn};const{Deflate:cn,deflate:dn,deflateRaw:hn,gzip:un}=rt,{Inflate:gn,inflate:mn,inflateRaw:pn,ungzip:fn}=ln;var yn={Deflate:cn,deflate:dn,deflateRaw:hn,gzip:un,Inflate:gn,inflate:mn,inflateRaw:pn,ungzip:fn,constants:H};class wn{constructor(e){this.SQL=e,this.db=null,this.metadata=null,this.loadedChunks=new Set,this.loadingProgress=0,this.totalBytes=0,this.loadedBytes=0,this.isInitialized=!1,this.listeners={progress:[],chunkLoaded:[],complete:[],error:[]},this.dbName="WordDiscovererCache",this.dbVersion=1,this.cacheDB=null}async initializeCache(){return new Promise((e,t)=>{const n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>{console.warn("Failed to open IndexedDB, continuing without cache"),e(null)},n.onsuccess=t=>{this.cacheDB=t.target.result,console.log("✅ IndexedDB cache initialized"),e(this.cacheDB)},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("chunks")||t.createObjectStore("chunks",{keyPath:"chunkNumber"}),t.objectStoreNames.contains("metadata")||t.createObjectStore("metadata",{keyPath:"key"})}})}async saveChunkToCache(e,t){if(this.cacheDB)return new Promise((n,s)=>{try{const s=this.cacheDB.transaction(["chunks"],"readwrite").objectStore("chunks");let i;if(t instanceof ArrayBuffer)i=new Uint8Array(t);else{if(!(t instanceof Uint8Array))throw new TypeError("Data must be ArrayBuffer or Uint8Array");i=t}const a=s.put({chunkNumber:e,data:i,timestamp:Date.now(),version:this.metadata.version});a.onsuccess=()=>{console.log(`💾 Cached chunk ${e}`),n()},a.onerror=t=>{console.warn(`Failed to cache chunk ${e}:`,t.target.error),n()}}catch(i){console.warn(`Error caching chunk ${e}:`,i),n()}})}async loadChunkFromCache(e){return this.cacheDB?new Promise((t,n)=>{try{const n=this.cacheDB.transaction(["chunks"],"readonly"),s=n.objectStore("chunks").get(e);s.onsuccess=n=>{const s=n.target.result;if(s&&s.data){if(s.version&&s.version!==this.metadata.version)return console.log(`⚠️ Cache version mismatch for chunk ${e}, re-downloading`),void t(null);let n;if(console.log(`📦 Loaded chunk ${e} from cache`),s.data instanceof Uint8Array)n=s.data.buffer;else{if(!(s.data instanceof ArrayBuffer))return console.warn(`Unexpected data type in cache for chunk ${e}, re-downloading`),void t(null);n=s.data}t(n)}else t(null)},s.onerror=n=>{console.warn(`Error loading chunk ${e} from cache:`,n.target.error),t(null)}}catch(s){console.warn(`Error accessing cache for chunk ${e}:`,s),t(null)}}):null}async saveMetadataToCache(e){if(this.cacheDB)return new Promise((t,n)=>{const s=this.cacheDB.transaction(["metadata"],"readwrite").objectStore("metadata").put({key:"metadata",data:e,timestamp:Date.now()});s.onsuccess=()=>t(),s.onerror=()=>t()})}async loadMetadataFromCache(){return this.cacheDB?new Promise((e,t)=>{const n=this.cacheDB.transaction(["metadata"],"readonly").objectStore("metadata").get("metadata");n.onsuccess=t=>{const n=t.target.result;n&&n.data?(console.log("✅ Loaded metadata from cache"),e(n.data)):e(null)},n.onerror=()=>e(null)}):null}async isChunkCached(e){return null!==await this.loadChunkFromCache(e)}async initialize(){try{console.log("🚀 Initializing Progressive Database Loader..."),await this.initializeCache();let e=await this.loadMetadataFromCache();if(!e){const t="/woaiios/db-chunks/metadata.json";console.log("📥 Fetching metadata...");const n=await fetch(t);if(!n.ok)throw new Error(`Failed to load metadata: ${n.status}`);e=await n.json(),await this.saveMetadataToCache(e)}return this.metadata=e,this.totalBytes=e.chunks.reduce((e,t)=>e+t.sizeBytes,0),console.log(`📊 Metadata loaded: ${e.totalChunks} chunks, ${e.totalWords.toLocaleString()} words`),this.db=new this.SQL.Database,this.db.exec("\n                CREATE TABLE words (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    word TEXT NOT NULL,\n                    phonetic TEXT,\n                    definition TEXT,\n                    translation TEXT,\n                    pos TEXT,\n                    collins INTEGER DEFAULT 0,\n                    oxford INTEGER DEFAULT 0,\n                    tag TEXT,\n                    bnc INTEGER DEFAULT 0,\n                    frq INTEGER DEFAULT 0,\n                    exchange TEXT,\n                    detail TEXT,\n                    audio TEXT\n                );\n                CREATE INDEX idx_word ON words(word);\n            "),this.isInitialized=!0,this.emit("progress",{loaded:0,total:this.totalBytes,percentage:0,message:"Initialized"}),!0}catch(e){return console.error("Error initializing progressive loader:",e),this.emit("error",e),!1}}async loadChunk(e){if(!this.isInitialized)throw new Error("Loader not initialized");if(this.loadedChunks.has(e))return console.log(`⚠️ Chunk ${e} already loaded`),!0;try{const t=this.metadata.chunks.find(t=>t.chunkNumber===e);if(!t)throw new Error(`Chunk ${e} not found in metadata`);let n=await this.loadChunkFromCache(e),s=!1;if(n)s=!0,console.log(`📦 Loading chunk ${e}/${this.metadata.totalChunks} from cache (${t.wordCount.toLocaleString()} words)...`),this.emit("progress",{loaded:this.loadedBytes,total:this.totalBytes,percentage:this.loadingProgress,message:`Loading from cache: chunk ${e}/${this.metadata.totalChunks}`,fromCache:!0}),e<=3&&await new Promise(e=>setTimeout(e,100));else{console.log(`📥 Downloading chunk ${e}/${this.metadata.totalChunks} (${t.wordCount.toLocaleString()} words)...`),this.emit("progress",{loaded:this.loadedBytes,total:this.totalBytes,percentage:this.loadingProgress,message:`Downloading: chunk ${e}/${this.metadata.totalChunks}`,fromCache:!1});const s=`/woaiios/db-chunks/${t.filename}`,i=await fetch(s);if(!i.ok)throw new Error(`Failed to load chunk ${e}: ${i.status}`);let a=await i.arrayBuffer();if("gzip"===i.headers.get("Content-Encoding")||a.byteLength>1.5*t.sizeBytes)n=a;else{const e=new Uint8Array(a);n=yn.ungzip(e).buffer}await this.saveChunkToCache(e,n)}const i=new this.SQL.Database(new Uint8Array(n)),a=i.exec("SELECT word, phonetic, definition, translation, pos, collins, oxford, tag, bnc, frq, exchange, detail, audio FROM words");if(a.length>0&&a[0].values.length>0){const e=this.db.prepare("\n                    INSERT INTO words (word, phonetic, definition, translation, pos, collins, oxford, tag, bnc, frq, exchange, detail, audio)\n                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n                ");for(const t of a[0].values)e.run(t);e.free()}i.close(),this.loadedChunks.add(e),this.loadedBytes+=t.sizeBytes,this.loadingProgress=this.loadedBytes/this.totalBytes*100;const o=s?"📦":"✅",r=s?"from cache":"downloaded";return console.log(`${o} Chunk ${e} loaded ${r} (${this.loadingProgress.toFixed(1)}% complete)`),this.emit("chunkLoaded",{chunkNumber:e,loaded:this.loadedChunks.size,total:this.metadata.totalChunks,percentage:this.loadingProgress,fromCache:s}),this.emit("progress",{loaded:this.loadedBytes,total:this.totalBytes,percentage:this.loadingProgress,message:`Loaded chunk ${e}/${this.metadata.totalChunks} ${s?"(cached)":""}`,fromCache:s}),!0}catch(t){return console.error(`Error loading chunk ${e}:`,t),console.error("Error stack:",t.stack),console.error("Error details:",{message:t.message,name:t.name,chunkNumber:e}),this.emit("error",t),!1}}async loadAllChunks(){this.isInitialized||await this.initialize(),console.log("📚 Starting progressive database loading...");for(let e=1;e<=this.metadata.totalChunks;e++)await this.loadChunk(e);return console.log("✨ All chunks loaded successfully!"),this.emit("complete",{totalChunks:this.metadata.totalChunks,totalWords:this.metadata.totalWords}),!0}async loadPriorityChunks(e=3){this.isInitialized||await this.initialize(),console.log(`📚 Loading ${e} priority chunks...`);for(let t=1;t<=Math.min(e,this.metadata.totalChunks);t++)await this.loadChunk(t);return e<this.metadata.totalChunks&&this.loadRemainingChunksInBackground(e+1),!0}async loadRemainingChunksInBackground(e){console.log(`🔄 Loading remaining chunks in background starting from ${e}...`);for(let t=e;t<=this.metadata.totalChunks;t++)await this.loadChunk(t),await new Promise(e=>setTimeout(e,100));console.log("✨ All chunks loaded successfully!"),this.emit("complete",{totalChunks:this.metadata.totalChunks,totalWords:this.metadata.totalWords})}getDatabase(){return this.db}isReady(){return this.isInitialized&&this.loadedChunks.size>0}getProgress(){return{percentage:this.loadingProgress,loadedChunks:this.loadedChunks.size,totalChunks:this.metadata?this.metadata.totalChunks:0,loadedBytes:this.loadedBytes,totalBytes:this.totalBytes}}on(e,t){this.listeners[e]&&this.listeners[e].push(t)}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>e(t))}close(){this.db&&(this.db.close(),this.db=null),this.cacheDB&&(this.cacheDB.close(),this.cacheDB=null)}}class bn{constructor(){this.dbName="WordDiscovererDirectDB",this.dbVersion=1,this.db=null,this.isInitialized=!1,this.memoryCache=new Map,this.maxCacheSize=1e4,this.stats={cacheHits:0,cacheMisses:0,totalQueries:0}}async initialize(){return new Promise((e,t)=>{const n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>{console.error("Failed to open DirectDataStorage IndexedDB"),t(new Error("Failed to initialize DirectDataStorage"))},n.onsuccess=t=>{this.db=t.target.result,this.isInitialized=!0,console.log("✅ DirectDataStorage initialized"),e(this.db)},n.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("words")){t.createObjectStore("words",{keyPath:"word"}).createIndex("word_lower","word_lower",{unique:!1})}t.objectStoreNames.contains("metadata")||t.createObjectStore("metadata",{keyPath:"key"}),console.log("✅ DirectDataStorage schema created")}})}async importFromDatabase(e,t=null){this.isInitialized||await this.initialize(),console.log("🔄 Starting data import to DirectDataStorage...");const n=Date.now();try{const s=await this.getMetadata("importComplete");if(s&&!0===s.value)return console.log("✅ Data already imported, skipping"),!0;const i=e.exec("\n                SELECT word, phonetic, definition, translation, pos, collins, oxford, \n                       tag, bnc, frq, exchange, detail, audio \n                FROM words\n            ");if(0===i.length||0===i[0].values.length)throw new Error("No data found in SQL database");const a=i[0].values,o=a.length;console.log(`📊 Importing ${o.toLocaleString()} words...`);const r=1e3;let l=0;for(let e=0;e<a.length;e+=r){const n=a.slice(e,e+r),s=this.db.transaction(["words"],"readwrite"),i=s.objectStore("words");for(const e of n){const t={word:e[0],word_lower:e[0].toLowerCase(),phonetic:e[1]||"",definition:e[2]||"",translation:e[3]||"",pos:e[4]||"",collins:parseInt(e[5])||0,oxford:"1"===e[6]||1===e[6],tag:e[7]||"",bnc:parseInt(e[8])||0,frq:parseInt(e[9])||0,exchange:e[10]||"",detail:e[11]||"",audio:e[12]||""};i.put(t)}await new Promise((e,t)=>{s.oncomplete=e,s.onerror=()=>t(s.error)}),l+=n.length,t&&t({imported:l,total:o,percentage:l/o*100}),l%1e4!=0&&l!==o||console.log(`📥 Imported ${l.toLocaleString()}/${o.toLocaleString()} words (${(l/o*100).toFixed(1)}%)`)}await this.setMetadata("importComplete",!0),await this.setMetadata("importDate",(new Date).toISOString()),await this.setMetadata("totalWords",o);const c=Date.now()-n;return console.log(`✅ Import completed in ${(c/1e3).toFixed(2)}s`),console.log(`📊 Total words imported: ${l.toLocaleString()}`),!0}catch(s){throw console.error("❌ Error importing data:",s),s}}async queryWord(e){if(!this.isInitialized)return null;this.stats.totalQueries++;const t=e.toLowerCase();return this.memoryCache.has(t)?(this.stats.cacheHits++,this.memoryCache.get(t)):(this.stats.cacheMisses++,new Promise((n,s)=>{try{const s=this.db.transaction(["words"],"readonly").objectStore("words"),i=s.index("word_lower").get(t);i.onsuccess=e=>{const s=e.target.result;s&&this.addToCache(t,s),n(s||null)},i.onerror=()=>{console.error("Error querying word:",e),n(null)}}catch(i){console.error("Error in queryWord:",i),n(null)}}))}async queryWordsBatch(e){if(!this.isInitialized)return[];const t=[...new Set(e.map(e=>e.toLowerCase()))],n=[],s=[];for(const i of t)this.memoryCache.has(i)?(this.stats.cacheHits++,n.push({word:i,data:this.memoryCache.get(i)})):s.push(i);if(s.length>0){this.stats.cacheMisses+=s.length;const e=this.db.transaction(["words"],"readonly").objectStore("words").index("word_lower"),t=s.map(t=>new Promise(n=>{const s=e.get(t);s.onsuccess=e=>{const s=e.target.result;s?(this.addToCache(t,s),n({word:t,data:s})):n({word:t,data:null})},s.onerror=()=>n({word:t,data:null})})),i=await Promise.all(t);n.push(...i)}return n}addToCache(e,t){if(this.memoryCache.size>=this.maxCacheSize){const e=this.memoryCache.keys().next().value;this.memoryCache.delete(e)}this.memoryCache.set(e,t)}clearCache(){this.memoryCache.clear(),this.stats={cacheHits:0,cacheMisses:0,totalQueries:0}}getCacheStats(){return{...this.stats,cacheSize:this.memoryCache.size,hitRate:this.stats.totalQueries>0?(this.stats.cacheHits/this.stats.totalQueries*100).toFixed(2)+"%":"0%"}}async setMetadata(e,t){return new Promise((n,s)=>{const i=this.db.transaction(["metadata"],"readwrite").objectStore("metadata").put({key:e,value:t});i.onsuccess=()=>n(),i.onerror=()=>s(i.error)})}async getMetadata(e){return new Promise((t,n)=>{const s=this.db.transaction(["metadata"],"readonly").objectStore("metadata").get(e);s.onsuccess=e=>t(e.target.result),s.onerror=()=>t(null)})}async isDataImported(){const e=await this.getMetadata("importComplete");return e&&!0===e.value}async clearData(){return new Promise((e,t)=>{const n=this.db.transaction(["words","metadata"],"readwrite");n.objectStore("words").clear(),n.objectStore("metadata").clear(),n.oncomplete=()=>{this.clearCache(),console.log("✅ DirectDataStorage cleared"),e()},n.onerror=()=>t(n.error)})}close(){this.db&&(this.db.close(),this.db=null,this.isInitialized=!1),this.clearCache()}}class vn{constructor(){this.db=null,this.isLoaded=!1,this.queryCache=new Map,this.SQL=null,this.progressiveLoader=null,this.progressCallback=null,this.directStorage=null,this.useDirectStorage=!0}setProgressCallback(e){this.progressCallback=e}async initialize(){try{if(this.useDirectStorage){console.log("🚀 Initializing DirectDataStorage for optimized lookups..."),this.directStorage=new bn,await this.directStorage.initialize();if(await this.directStorage.isDataImported())return console.log("✅ DirectDataStorage ready with pre-imported data"),this.isLoaded=!0,!0;console.log("⚠️ Data not yet imported to DirectDataStorage, will import after loading SQL database")}let t;console.log("Initializing sql.js...");t=(await function(t,n){let s=Promise.resolve();if(n&&n.length>0){let t=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=i?.nonce||i?.getAttribute("nonce");s=t(n.map(t=>{if((t=function(e){return"/woaiios/"+e}(t))in e)return;e[t]=!0;const n=t.endsWith(".css"),s=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${s}`))return;const i=document.createElement("link");return i.rel=n?"stylesheet":"modulepreload",n||(i.as="script"),i.crossOrigin="",i.href=t,a&&i.setAttribute("nonce",a),document.head.appendChild(i),n?new Promise((e,n)=>{i.addEventListener("load",e),i.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(e=>{for(const t of e||[])"rejected"===t.status&&i(t.reason);return t().catch(i)})}(()=>import("./sql-wasm-DAuD2IuQ.js").then(e=>e.s),[])).default;this.SQL=await t({locateFile:e=>`/woaiios/assets/${e}`}),console.log("🚀 Using progressive database loading..."),this.progressiveLoader=new wn(this.SQL),this.progressiveLoader.on("progress",e=>{this.progressCallback&&this.progressCallback(e)}),this.progressiveLoader.on("chunkLoaded",e=>{console.log(`✅ Chunk ${e.chunkNumber} loaded (${e.percentage.toFixed(1)}% complete)`)}),this.progressiveLoader.on("complete",async e=>{if(console.log(`✨ All database chunks loaded! Total: ${e.totalWords.toLocaleString()} words`),this.useDirectStorage&&this.directStorage){if(!(await this.directStorage.isDataImported())){console.log("🔄 Starting one-time import to DirectDataStorage for future performance...");try{await this.directStorage.importFromDatabase(this.db,e=>{console.log(`📥 Import progress: ${e.percentage.toFixed(1)}%`)}),console.log("✅ Import to DirectDataStorage completed!")}catch(t){console.warn("⚠️ Failed to import to DirectDataStorage, will continue with SQL:",t)}}}}),this.progressiveLoader.on("error",e=>{console.error("Progressive loader error:",e)}),await this.progressiveLoader.initialize(),await this.progressiveLoader.loadPriorityChunks(3),this.db=this.progressiveLoader.getDatabase();const n=this.db.exec("SELECT COUNT(*) as count FROM words LIMIT 1");if(n.length>0){const e=n[0].values[0][0];console.log(`ECDICT database ready with ${e.toLocaleString()} words (loading more in background...)`)}return this.isLoaded=!0,!0}catch(t){return console.error("Error loading ECDICT database:",t),this.isLoaded=!1,!1}}queryWord(e){if(this.useDirectStorage&&this.directStorage&&this.directStorage.isInitialized)return this.directStorage.queryWord(e);if(!this.isLoaded||!this.db)return null;const t=e.toLowerCase();if(this.queryCache.has(t))return this.queryCache.get(t);try{const e=this.db.exec("SELECT word, phonetic, definition, translation, pos, collins, oxford, tag, bnc, frq, exchange, detail \n                 FROM words \n                 WHERE LOWER(word) = ?\n                 LIMIT 1",[t]);if(e.length>0&&e[0].values.length>0){const n=e[0].values[0],s={word:n[0],phonetic:n[1]||"",definition:n[2]||"",translation:n[3]||"",pos:n[4]||"",collins:parseInt(n[5])||0,oxford:"1"===n[6]||1===n[6],tag:n[7]||"",bnc:parseInt(n[8])||0,frq:parseInt(n[9])||0,exchange:n[10]||"",detail:n[11]||""};if(this.queryCache.set(t,s),this.queryCache.size>1e4){const e=this.queryCache.keys().next().value;this.queryCache.delete(e)}return s}return null}catch(n){return console.error("Error querying word:",e,n),null}}async queryWordsBatch(e){if(this.useDirectStorage&&this.directStorage&&this.directStorage.isInitialized){return(await this.directStorage.queryWordsBatch(e)).map(e=>e.data)}if(!this.isLoaded||!this.db)return[];const t=[...new Set(e.map(e=>e.toLowerCase()))],n=[];for(const s of t){const e=this.queryWord(s);e&&(e instanceof Promise?n.push(await e):n.push(e))}return n}parseExchange(e){const t={p:null,d:null,i:null,3:null,r:null,t:null,s:null,0:null,1:null};if(!e)return t;const n=e.split("/");for(const s of n){const[e,n]=s.split(":");e&&n&&(t[e]=n)}return t}async getWordDifficulty(e){let t=await this.queryWord(e);if(t||(t=await this.findByLemma(e)),!t)return{level:"common",score:0,className:"common",info:null};let n="expert",s=100;const i=t.tag||"";let a=!1;if(1===t.oxford?(n="common",s=0,a=!0):t.collins>=5?(n="common",s=10,a=!0):t.collins>=4||i.includes("zk")||i.includes("gk")||i.includes("cet4")?(n="beginner",s=25,a=!0):t.collins>=3||i.includes("cet6")?(n="intermediate",s=50,a=!0):t.collins>=1||i.includes("ielts")||i.includes("toefl")?(n="advanced",s=75,a=!0):t.bnc>0&&t.bnc<2e4?(n="common",s=15,a=!0):t.bnc>0&&t.bnc<5e4?(n="beginner",s=30,a=!0):t.bnc>0&&t.bnc<1e5&&(n="intermediate",s=55,a=!0),!a&&t.exchange){const n=this.parseExchange(t.exchange),s=n[0]||n[1];if(s&&s.toLowerCase()!==e.toLowerCase()){if(await this.queryWord(s)){return await this.getWordDifficulty(s)}}}return{level:n,score:s,className:n,info:t}}async findByLemma(e){if(!this.isLoaded||!this.db)return null;try{const t=this.db.exec("SELECT word, exchange \n                 FROM words \n                 WHERE exchange LIKE ? \n                 LIMIT 10",[`%${e}%`]);if(t.length>0&&t[0].values.length>0)for(const n of t[0].values){const t=n[0],s=n[1],i=this.parseExchange(s);for(const n of Object.values(i))if(n&&n.toLowerCase()===e.toLowerCase())return await this.queryWord(t)}return null}catch(t){return console.error("Error finding lemma:",t),null}}fuzzyMatch(e,t=10){if(!this.isLoaded||!this.db)return[];try{const n=e.toLowerCase(),s=this.db.exec("SELECT word, phonetic, translation \n                 FROM words \n                 WHERE LOWER(word) LIKE ? \n                 LIMIT ?",[`${n}%`,t]);return s.length>0&&s[0].values.length>0?s[0].values.map(e=>({word:e[0],phonetic:e[1]||"",translation:e[2]||""})):[]}catch(n){return console.error("Error fuzzy matching:",n),[]}}isDatabaseLoaded(){return this.isLoaded}close(){this.db&&(this.db.close(),this.db=null,this.isLoaded=!1)}}class _n{constructor(e,t){this.wordDatabase=e,this.translationService=t,this.tokenizer=null,this.translationCache=new Map,this.maxCacheSize=5e3,this.LEMMA_KEY="0",this.LEMMA_VARIATION_KEY="1",this.EXPERT_DIFFICULTY={level:"expert",score:100,className:"expert"},this.loadTokenizer()}async loadTokenizer(){try{if(!Intl.Segmenter)throw new Error("Intl.Segmenter not supported in this browser");this.tokenizer=new Intl.Segmenter(void 0,{granularity:"word"}),console.log("Intl.Segmenter loaded successfully")}catch(e){console.warn("Error loading Intl.Segmenter, falling back to simple extraction:",e),this.tokenizer={tokenize:e=>e.split(/\s+/).map(e=>({value:e,tag:"word"}))}}}parseExchange(e){const t={p:null,d:null,i:null,3:null,r:null,t:null,s:null,[this.LEMMA_KEY]:null,[this.LEMMA_VARIATION_KEY]:null};if(!e)return t;const n=e.split("/");for(const s of n){const[e,n]=s.split(":");e&&n&&(t[e]=n)}return t}hasMetadata(e){if(!e)return!1;const t=e.tag||"";return 1===e.oxford||!0===e.oxford||e.collins>0||e.bnc>0||t.includes("zk")||t.includes("gk")||t.includes("cet4")||t.includes("cet6")||t.includes("ielts")||t.includes("toefl")||t.includes("gre")}extractWords(e){if(this.tokenizer&&this.tokenizer.segment){const t=this.tokenizer.segment(e);return Array.from(t).filter(e=>e.isWordLike).map(e=>e.segment).filter(e=>e.length>1).filter(e=>/^[a-zA-Z]+$/.test(e))}return e.split(/\s+/).filter(e=>e.length>1).filter(e=>/^[a-zA-Z]+$/.test(e))}async analyzeWords(e,t,n,s){const i={totalWords:e.length,highlightedWords:[],newWords:[],difficultyScore:0,wordFrequency:{}},{learning:a,mastered:o}=s;e.forEach(e=>{const t=e.toLowerCase();i.wordFrequency[t]=(i.wordFrequency[t]||0)+1});const r=[...new Set(e.map(e=>e.toLowerCase()))],l=performance.now(),c=new Map;if(this.wordDatabase.useDirectStorage&&this.wordDatabase.directStorage&&this.wordDatabase.directStorage.isInitialized){(await this.wordDatabase.directStorage.queryWordsBatch(r)).forEach(e=>{e.data&&c.set(e.word,e.data)})}else for(const u of r){const e=await this.wordDatabase.queryWord(u);e&&c.set(u,e)}const d=new Set;for(const u of r){const e=c.get(u);if(e&&!this.hasMetadata(e)&&e.exchange){const t=this.parseExchange(e.exchange),n=t[this.LEMMA_KEY]||t[this.LEMMA_VARIATION_KEY];if(n&&n.toLowerCase()!==u){const e=n.toLowerCase();c.has(e)||d.add(e)}}}if(d.size>0){const e=Array.from(d);if(this.wordDatabase.useDirectStorage&&this.wordDatabase.directStorage&&this.wordDatabase.directStorage.isInitialized){(await this.wordDatabase.directStorage.queryWordsBatch(e)).forEach(e=>{e.data&&c.set(e.word,e.data)})}else for(const t of e){const e=await this.wordDatabase.queryWord(t);e&&c.set(t,e)}}for(const u of r){const s=e.find(e=>e.toLowerCase()===u)||u;let r=c.get(u),l=r;if(r&&!this.hasMetadata(r)&&r.exchange){const e=this.parseExchange(r.exchange),t=e[this.LEMMA_KEY]||e[this.LEMMA_VARIATION_KEY];if(t&&t.toLowerCase()!==u){const e=c.get(t.toLowerCase());e&&this.hasMetadata(e)&&(l=e)}}let d=this.calculateDifficultyFromData(l,u);const h=o.has(u),g=a.has(u);g&&(d={...this.EXPERT_DIFFICULTY,info:d.info});!h&&(g||this.shouldHighlight(u,d,n,a,t))&&(i.highlightedWords.push({word:s,difficulty:d,frequency:i.wordFrequency[u],translation:this.formatTranslationFromData(s,r),phonetic:r?.phonetic||""}),a.has(u)||i.newWords.push(u)),i.difficultyScore+=d.score}const h=performance.now();return console.log(`📊 Analyzed ${r.length} unique words in ${(h-l).toFixed(2)}ms`),i.difficultyScore=r.length>0?Math.round(i.difficultyScore/r.length):0,i}calculateDifficultyFromData(e,t){if(!e)return{level:"common",score:0,className:"common",info:null};let n="expert",s=100;const i=e.tag||"";return 1===e.oxford||!0===e.oxford?(n="common",s=0):e.collins>=5?(n="common",s=10):e.collins>=4||i.includes("zk")||i.includes("gk")||i.includes("cet4")?(n="beginner",s=25):e.collins>=3||i.includes("cet6")?(n="intermediate",s=50):e.collins>=1||i.includes("ielts")||i.includes("toefl")?(n="advanced",s=75):e.bnc>0&&e.bnc<2e4?(n="common",s=15):e.bnc>0&&e.bnc<5e4?(n="beginner",s=30):e.bnc>0&&e.bnc<1e5&&(n="intermediate",s=55),{level:n,score:s,className:n,info:e}}formatTranslationFromData(e,t){if(!t)return`<div class="word-info">\n                <h3>${e}</h3>\n                <p class="no-translation">未找到释义</p>\n            </div>`;let n='<div class="word-info ecdict-entry compact">';if(n+=`<h3 class="word-title">${t.word}</h3>`,t.phonetic&&(n+=`<div class="phonetic-line">/${t.phonetic}/</div>`),t.translation){n+='<div class="translation-compact">';const e=t.translation.split("\\n"),s=e[0]?this.escapeHtml(e[0].trim()):"";s&&(n+=`<p>${s}</p>`),n+="</div>"}return n+='<div class="word-details-toggle" onclick="this.parentElement.classList.toggle(\'expanded\')">',n+='<span class="toggle-icon">▼</span> <span class="toggle-text">更多详情</span>',n+="</div>",n+='<div class="word-details-content">',(t.collins>0||t.oxford)&&(n+='<div class="word-meta">',t.collins>0&&(n+=`<span class="collins-stars">${"★".repeat(t.collins)}</span>`),t.oxford&&(n+='<span class="oxford-badge">Oxford 3000</span>'),n+="</div>"),n+="</div>",n+="</div>",n}shouldHighlight(e,t,n,s,i){const a={common:0,beginner:1,intermediate:2,advanced:3,expert:4,unknown:5},o=a[t.level]>a[i];switch(n){case"unknown":return o&&!s.has(e);case"difficult":return o;case"all":return!0;default:return!1}}async getTranslation(e){const t=e.toLowerCase();if(this.translationCache.has(t))return this.translationCache.get(t);if(!this.wordDatabase.isDatabaseLoaded())return'<div class="word-info"><p>数据库未加载</p></div>';let n,s=await this.wordDatabase.queryWord(t);if(s||(s=await this.wordDatabase.findByLemma(t)),s){if(n='<div class="word-info ecdict-entry compact">',n+=`<h3 class="word-title">${s.word}</h3>`,s.phonetic&&(n+=`<div class="phonetic-line">/${s.phonetic}/</div>`),s.translation){n+='<div class="translation-compact">';const e=s.translation.split("\\n"),t=e[0]?this.escapeHtml(e[0].trim()):"";t&&(n+=`<p>${t}</p>`),n+="</div>"}if(n+='<div class="word-details-toggle" onclick="this.parentElement.classList.toggle(\'expanded\')">',n+='<span class="toggle-icon">▼</span> <span class="toggle-text">更多详情</span>',n+="</div>",n+='<div class="word-details-content">',(s.collins>0||s.oxford)&&(n+='<div class="word-meta">',s.collins>0&&(n+=`<span class="collins-stars">${"★".repeat(s.collins)}</span>`),s.oxford&&(n+='<span class="oxford-badge">Oxford 3000</span>'),n+="</div>"),s.tag){const e=s.tag.split(" ").filter(e=>e);if(e.length>0){n+='<div class="word-tags">';const t={zk:"中考",gk:"高考",cet4:"CET-4",cet6:"CET-6",ielts:"IELTS",toefl:"TOEFL",gre:"GRE",tem4:"TEM-4",tem8:"TEM-8"};e.forEach(e=>{const s=t[e]||e;n+=`<span class="tag">${s}</span>`}),n+="</div>"}}if(s.translation){const e=s.translation.split("\\n");e.length>1&&(n+='<div class="translation">',e.forEach((e,t)=>{e.trim()&&t>0&&(n+=`<p>${this.escapeHtml(e)}</p>`)}),n+="</div>")}if(s.definition){n+='<div class="definition">',n+="<h4>English Definition:</h4>";s.definition.split("\\n").forEach(e=>{e.trim()&&(n+=`<p>${this.escapeHtml(e)}</p>`)}),n+="</div>"}if(s.exchange){const e=this.wordDatabase.parseExchange(s.exchange),t={p:"过去式",d:"过去分词",i:"现在分词",3:"第三人称单数",r:"比较级",t:"最高级",s:"复数",0:"原形"},i=[];for(const[n,s]of Object.entries(e))s&&t[n]&&i.push(`${t[n]}: ${s}`);i.length>0&&(n+='<div class="word-forms">',n+="<h4>词形变化:</h4>",n+=`<p>${i.join(" | ")}</p>`,n+="</div>")}(s.bnc>0||s.frq>0)&&(n+='<div class="word-frequency">',s.bnc>0&&(n+=`<span>BNC词频: ${s.bnc.toLocaleString()}</span>`),s.frq>0&&(n+=`<span>当代词频: ${s.frq.toLocaleString()}</span>`),n+="</div>"),n+="</div>",n+="</div>"}else n=`<div class="word-info">\n                <h3>${e}</h3>\n                <p class="no-translation">未找到释义</p>\n            </div>`;if(this.translationCache.set(t,n),this.translationCache.size>this.maxCacheSize){const e=this.translationCache.keys().next().value;this.translationCache.delete(e)}return n}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async processTextForDisplay(e,t){const n=new Map(t.highlightedWords.map(e=>[e.word.toLowerCase(),e])),s=e.split(/(\b[a-zA-Z-]+\b)/),i=[...new Set(s.filter(e=>/\b[a-zA-Z-]+\b/.test(e)))],a=new Map;for(const r of t.highlightedWords)r.translation&&a.set(r.word.toLowerCase(),r.translation);const o=i.filter(e=>!a.has(e.toLowerCase()));if(o.length>0){const e=await Promise.all(o.map(e=>this.getTranslation(e)));o.forEach((t,n)=>{a.set(t.toLowerCase(),e[n])})}return s.map(e=>{const t=e.toLowerCase();if(!/\b[a-zA-Z-]+\b/.test(t))return e;const s=n.get(t),i=a.get(t)||"";let o="word-span";s&&(o+=` highlighted-word ${s.difficulty.className}`);const r=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");if(s&&s.phonetic){return`<ruby class="${o}" data-word="${e}" data-translation="${r}"><rb>${e}</rb><rt class="phonetic-annotation">/${this.escapeHtml(s.phonetic)}/</rt></ruby>`}return`<span class="${o}" data-word="${e}" data-translation="${r}">${e}</span>`}).join("")}calculateComplexityMetrics(e,t){const n=[...new Set(e)],s={totalWords:e.length,uniqueWords:n.length,averageWordLength:0,difficultyDistribution:{common:0,beginner:0,intermediate:0,advanced:0,expert:0}},i=e.reduce((e,t)=>e+t.length,0);return s.averageWordLength=Math.round(i/e.length*10)/10,n.forEach(e=>{const n=this.wordDatabase.getWordDifficulty(e,t);s.difficultyDistribution[n.level]++}),s}clearTranslationCache(){this.translationCache.clear(),console.log("🗑️ Translation cache cleared")}getCacheStats(){return{size:this.translationCache.size,maxSize:this.maxCacheSize,utilization:`${(this.translationCache.size/this.maxCacheSize*100).toFixed(1)}%`}}}class kn{constructor(){this.clientId="781460731280-7moak9c5fq75dubjlnmes4b4gdku3qvt.apps.googleusercontent.com",this.scopes="https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email",this.isInitialized=!1,this.isSignedIn=!1,this.accessToken=null,this.fileId=null,this.gapiLoaded=!1}async initialize(){try{return await this._waitForGoogleIdentityServices(),await this._loadGoogleAPIClient(),this.isInitialized=!0,console.log("Google Drive API initialized successfully"),!0}catch(e){return console.error("Error initializing Google Drive API:",e),!1}}async signIn(e=!1){try{this.isInitialized||await this.initialize();const t=await this._getToken(e);return this.accessToken=t.access_token,this.isSignedIn=!0,await this._initializeGoogleAPIClient(),await this.findOrCreateVocabularyFile(),console.log("Successfully signed in to Google"),!0}catch(t){return console.error("Error signing in:",t),this.isSignedIn=!1,!1}}async signOut(){try{return this.accessToken&&window.google.accounts.oauth2.revoke(this.accessToken),this.isSignedIn=!1,this.accessToken=null,this.fileId=null,console.log("Successfully signed out from Google"),!0}catch(e){return console.error("Error signing out:",e),!1}}async findOrCreateVocabularyFile(){try{let e=await this._findFileInSpace("drive");return e?(this.fileId=e.id,console.log("Found existing vocabulary file in drive:",this.fileId),this.fileId):(e=await this._findFileInSpace("appDataFolder"),e?(this.fileId=e.id,console.warn("Found vocabulary file in hidden appDataFolder."),this.fileId):(this.fileId=await this._createFile(),console.log("Created new vocabulary file in root directory:",this.fileId),this.fileId))}catch(e){return console.error("Error finding/creating vocabulary file:",e),null}}async uploadVocabulary(e){try{if(!this.isSignedIn||!this.fileId)throw new Error("Not signed in or file not found");const t=JSON.stringify(e,null,2);return await gapi.client.request({path:`/upload/drive/v3/files/${this.fileId}`,method:"PATCH",params:{uploadType:"media"},headers:{"Content-Type":"application/json"},body:t}),console.log("Vocabulary uploaded successfully to Google Drive"),!0}catch(t){return console.error("Error uploading vocabulary:",t),403===t.status&&(console.log("Attempting to refresh access token..."),await this.refreshAccessToken(),this.uploadVocabulary(e))}}async downloadVocabulary(){if(!this.isSignedIn||!this.fileId)throw new Error("Not signed in or file not found");try{const e=await gapi.client.drive.files.get({fileId:this.fileId,alt:"media"});return e.body?(console.log("Vocabulary downloaded successfully from Google Drive"),JSON.parse(e.body)):null}catch(e){return console.error("Error downloading vocabulary:",e),null}}async syncVocabulary(e){if(!this.isSignedIn)return{success:!1,error:"Not signed in to Google"};try{const t=await this.downloadVocabulary();if(!t||!t.version){console.log("No remote data or old format found. Uploading local data.");return{success:await this.uploadVocabulary(e),action:"upload",data:e}}const n=this._mergeVocabularies(e,t);return await this.uploadVocabulary(n)?{success:!0,action:"merge",data:n}:{success:!1,action:"merge_fail",data:e,error:"Failed to upload merged vocabulary"}}catch(t){return console.error("Error syncing vocabulary:",t),{success:!1,error:t.message}}}getAuthStatus(){return{isInitialized:this.isInitialized,isSignedIn:this.isSignedIn,hasFile:!!this.fileId}}async getUserInfo(){if(!this.isSignedIn)return null;try{const e=(await gapi.client.people.people.get({resourceName:"people/me",personFields:"names,emailAddresses,photos"})).result;return{name:e.names&&e.names[0]?e.names[0].displayName:"Google User",email:e.emailAddresses&&e.emailAddresses[0]?e.emailAddresses[0].value:"",imageUrl:e.photos&&e.photos[0]?e.photos[0].url:null}}catch(e){return console.error("Error getting user info:",e),null}}_getToken(e=!1){return new Promise((t,n)=>{window.google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:this.scopes,callback:e=>e.error?n(new Error(e.error_description)):t(e)}).requestAccessToken({prompt:e?"none":""})})}async refreshAccessToken(){try{const e=await this._getToken(!0);return this.accessToken=e.access_token,gapi.client.setToken({access_token:this.accessToken}),console.log("Access token refreshed successfully"),!0}catch(e){return console.error("Token refresh error:",e),this.isSignedIn=!1,!1}}_waitForGoogleIdentityServices(){return new Promise((e,t)=>{if(window.google&&window.google.accounts)return e();const n=setTimeout(()=>t(new Error("Google Identity Services failed to load")),1e4),s=setInterval(()=>{window.google&&window.google.accounts&&(clearTimeout(n),clearInterval(s),e())},100)})}_loadGoogleAPIClient(){return new Promise((e,t)=>{if(window.gapi&&window.gapi.client)return e();const n=document.createElement("script");n.src="https://apis.google.com/js/api.js",n.onload=()=>gapi.load("client",e),n.onerror=t,document.head.appendChild(n)})}async _initializeGoogleAPIClient(){await gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest","https://people.googleapis.com/$discovery/rest?version=v1"]}),gapi.client.setToken({access_token:this.accessToken})}async _findFileInSpace(e){const t=await gapi.client.drive.files.list({q:"name='WordDiscoverer_Vocabulary.json' and trashed=false",spaces:e,fields:"files(id, name)"});return t.result.files&&t.result.files.length>0?t.result.files[0]:null}async _createFile(){return(await gapi.client.drive.files.create({resource:{name:"WordDiscoverer_Vocabulary.json",parents:["root"]},fields:"id"})).result.id}_mergeVocabularies(e,t){console.log("Performing two-way merge for vocabulary v2.0");const n=new Map(e.learningWords||[]),s=new Map(e.masteredWords||[]),i=new Map(t.learningWords||t.vocabulary||[]),a=new Map(t.masteredWords||[]),o=new Map([...i,...n]),r=new Map([...a,...s]);for(const l of s.keys())o.has(l)&&o.delete(l);for(const l of n.keys())r.has(l)&&r.delete(l);return{version:"2.0",exportDate:(new Date).toISOString(),learningWords:Array.from(o.entries()),masteredWords:Array.from(r.entries())}}}class En{constructor(){const{learningWords:e,masteredWords:t}=this.loadVocabulary();this.learningWords=e,this.masteredWords=t,this.googleDriveManager=new kn,this.syncEnabled=!1,this.lastSyncTime=null,this.isSyncing=!1}addWord(e,t){return!this.isKnownWord(e)&&(this.learningWords.set(e,{translation:t,addedDate:(new Date).toISOString(),reviewCount:0,lastReviewed:null}),this.saveVocabulary(),!0)}masterWord(e,t){const n=e.toLowerCase();if(this.masteredWords.has(n))return"already_mastered";let s;return this.learningWords.has(n)?(s=this.learningWords.get(n),this.learningWords.delete(n),this.masteredWords.set(n,s),this.saveVocabulary(),"moved_to_mastered"):(s={translation:t,addedDate:(new Date).toISOString(),reviewCount:0,lastReviewed:null},this.masteredWords.set(n,s),this.saveVocabulary(),"added_to_mastered")}unmasterWord(e){const t=e.toLowerCase();if(this.masteredWords.has(t)){const e=this.masteredWords.get(t);return this.masteredWords.delete(t),this.learningWords.set(t,e),this.saveVocabulary(),"moved_to_learning"}return!1}removeWord(e){return this.learningWords.has(e)?(this.learningWords.delete(e),this.saveVocabulary(),!0):!!this.masteredWords.has(e)&&(this.masteredWords.delete(e),this.saveVocabulary(),!0)}isKnownWord(e){return this.learningWords.has(e)||this.masteredWords.has(e)}isMasteredWord(e){return this.masteredWords.has(e)}getWordData(e){return this.learningWords.get(e)||this.masteredWords.get(e)||null}getLearningWords(){return Array.from(this.learningWords.entries())}getMasteredWords(){return Array.from(this.masteredWords.entries())}getLearningSize(){return this.learningWords.size}getTotalSize(){return this.learningWords.size+this.masteredWords.size}clearVocabulary(){return this.learningWords.clear(),this.masteredWords.clear(),this.saveVocabulary(),!0}getSortedByDate(e){return Array.from(e.entries()).sort((e,t)=>new Date(t[1].addedDate)-new Date(e[1].addedDate))}updateReviewCount(e){const t=this.learningWords.get(e);return!!t&&(t.reviewCount++,t.lastReviewed=(new Date).toISOString(),this.saveVocabulary(),!0)}exportVocabulary(){return{version:"2.0",exportDate:(new Date).toISOString(),learningWords:Array.from(this.learningWords.entries()),masteredWords:Array.from(this.masteredWords.entries())}}importVocabulary(e){try{if("2.0"===e.version&&e.learningWords)this.learningWords=new Map(e.learningWords||[]),this.masteredWords=new Map(e.masteredWords||[]);else{if(!e.vocabulary||!Array.isArray(e.vocabulary))return!1;this.learningWords=new Map(e.vocabulary),this.masteredWords=new Map}return this.saveVocabulary(),!0}catch(t){return console.error("Error importing vocabulary:",t),!1}}getStatistics(){const e=[...Array.from(this.learningWords.values()),...Array.from(this.masteredWords.values())].reduce((e,t)=>e+t.reviewCount,0);return{learningWords:this.learningWords.size,masteredWords:this.masteredWords.size,totalWords:this.getTotalSize(),totalReviews:e}}loadVocabulary(){const e=localStorage.getItem("wordDiscovererVocabulary");if(!e)return{learningWords:new Map,masteredWords:new Map};try{const t=JSON.parse(e);if("2.0"===t.version)return{learningWords:new Map(t.learningWords||[]),masteredWords:new Map(t.masteredWords||[])};if(Array.isArray(t))return console.log("Migrating old vocabulary format to new v2.0 format."),{learningWords:new Map(t),masteredWords:new Map}}catch(t){console.error("Error loading vocabulary:",t)}return{learningWords:new Map,masteredWords:new Map}}saveVocabulary(){const e={version:"2.0",learningWords:Array.from(this.learningWords.entries()),masteredWords:Array.from(this.masteredWords.entries())};localStorage.setItem("wordDiscovererVocabulary",JSON.stringify(e)),this.syncEnabled&&!this.isSyncing&&this.syncToGoogleDrive()}async initializeGoogleDrive(){try{const e=await this.googleDriveManager.initialize();return e&&console.log("Google Drive integration initialized"),e}catch(e){return console.error("Error initializing Google Drive:",e),!1}}async enableGoogleDriveSync(e=!1){try{this.googleDriveManager.isInitialized||await this.initializeGoogleDrive();return!!(await this.googleDriveManager.signIn(e))&&(this.syncEnabled=!0,await this.syncToGoogleDrive(),console.log("Google Drive sync enabled"),!0)}catch(t){return console.error("Error enabling Google Drive sync:",t),!1}}async disableGoogleDriveSync(){try{return this.syncEnabled=!1,await this.googleDriveManager.signOut(),console.log("Google Drive sync disabled"),!0}catch(e){return console.error("Error disabling Google Drive sync:",e),!1}}async syncToGoogleDrive(){if(!this.syncEnabled||!this.googleDriveManager.isSignedIn||this.isSyncing)return!1;this.isSyncing=!0;try{const e=this.exportVocabulary(),t=await this.googleDriveManager.syncVocabulary(e);return t.success?("merge"===t.action?(this.importVocabulary(t.data),console.log("Vocabulary merged and synced with Google Drive"),window.wordDiscoverer&&window.wordDiscoverer.refreshTextAnalysis()):"download"===t.action?(this.importVocabulary(t.data),console.log("Vocabulary synced from Google Drive"),window.wordDiscoverer&&window.wordDiscoverer.refreshTextAnalysis()):"upload"===t.action&&console.log("Vocabulary uploaded to Google Drive"),this.lastSyncTime=(new Date).toISOString(),!0):(console.error("Sync failed:",t.error),!1)}catch(e){return console.error("Error syncing to Google Drive:",e),!1}finally{this.isSyncing=!1}}async forceSyncFromGoogleDrive(){try{if(!this.googleDriveManager.isSignedIn)return!1;const e=await this.googleDriveManager.downloadVocabulary();return!!e&&(this.importVocabulary(e),this.lastSyncTime=(new Date).toISOString(),console.log("Vocabulary force synced from Google Drive"),window.wordDiscoverer&&window.wordDiscoverer.refreshTextAnalysis(),!0)}catch(e){return console.error("Error force syncing from Google Drive:",e),!1}}async getGoogleDriveStatus(){const e=this.googleDriveManager.getAuthStatus(),t=await this.googleDriveManager.getUserInfo();return{syncEnabled:this.syncEnabled,isSignedIn:e.isSignedIn,hasFile:e.hasFile,lastSyncTime:this.lastSyncTime,userInfo:t}}getGoogleDriveManager(){return this.googleDriveManager}}class xn{constructor(){this.settings=this.loadSettings()}getSetting(e){return this.settings[e]}setSetting(e,t){this.settings[e]=t,this.saveSettings()}getAllSettings(){return{...this.settings}}updateSettings(e){this.settings={...this.settings,...e},this.saveSettings()}resetToDefault(){this.settings=this.getDefaultSettings(),this.saveSettings()}exportSettings(){return{settings:this.settings,exportDate:(new Date).toISOString(),version:"1.0"}}importSettings(e){try{return!(!e.settings||"object"!=typeof e.settings)&&(this.settings={...this.getDefaultSettings(),...e.settings},this.saveSettings(),!0)}catch(t){return console.error("Error importing settings:",t),!1}}getDefaultSettings(){return{highlightColor:"#ffeb3b",highlightOpacity:.7,translationService:"bing",targetLanguage:"zh",difficultyLevel:"intermediate",highlightMode:"unknown",autoSave:!0,showTooltips:!0,theme:"light",fontSize:"medium",enableNotifications:!0,reviewReminder:!0,reviewInterval:7,googleDriveSync:!1}}validateSetting(e,t){const n={highlightColor:e=>/^#[0-9A-F]{6}$/i.test(e),highlightOpacity:e=>"number"==typeof e&&e>=0&&e<=1,translationService:e=>["bing","google","yandex"].includes(e),targetLanguage:e=>"string"==typeof e&&2===e.length,difficultyLevel:e=>["common","beginner","intermediate","advanced","expert"].includes(e),highlightMode:e=>["unknown","difficult","all"].includes(e),autoSave:e=>"boolean"==typeof e,showTooltips:e=>"boolean"==typeof e,theme:e=>["light","dark"].includes(e),fontSize:e=>["small","medium","large"].includes(e),enableNotifications:e=>"boolean"==typeof e,reviewReminder:e=>"boolean"==typeof e,reviewInterval:e=>"number"==typeof e&&e>0}[e];return!n||n(t)}getSettingMetadata(e){return{highlightColor:{type:"color",label:"Highlight Color",description:"Color used for highlighting words"},highlightOpacity:{type:"range",label:"Highlight Opacity",description:"Transparency of highlighted words",min:0,max:1,step:.1},translationService:{type:"select",label:"Translation Service",description:"Service used for translations",options:[{value:"bing",label:"Bing Translator"},{value:"google",label:"Google Translate"},{value:"yandex",label:"Yandex Translate"}]},targetLanguage:{type:"text",label:"Target Language",description:"Language code for translations (e.g., zh, es, fr)"},difficultyLevel:{type:"select",label:"Difficulty Level",description:"Base difficulty level for analysis",options:[{value:"common",label:"Common"},{value:"beginner",label:"Beginner"},{value:"intermediate",label:"Intermediate"},{value:"advanced",label:"Advanced"},{value:"expert",label:"Expert"}]},highlightMode:{type:"select",label:"Highlight Mode",description:"Which words to highlight",options:[{value:"unknown",label:"Unknown Words Only"},{value:"difficult",label:"Difficult Words"},{value:"all",label:"All Words"}]},theme:{type:"select",label:"Theme",description:"Application theme",options:[{value:"light",label:"Light"},{value:"dark",label:"Dark"}]},fontSize:{type:"select",label:"Font Size",description:"Text size preference",options:[{value:"small",label:"Small"},{value:"medium",label:"Medium"},{value:"large",label:"Large"}]}}[e]||null}loadSettings(){const e=this.getDefaultSettings(),t=localStorage.getItem("wordDiscovererSettings");if(t)try{const n=JSON.parse(t);return{...e,...n}}catch(n){console.error("Error loading settings:",n)}return e}saveSettings(){localStorage.setItem("wordDiscovererSettings",JSON.stringify(this.settings))}}class Sn{constructor(e){this.element="string"==typeof e?document.querySelector(e):e}addEventListener(e,t,n){const s=this.element.querySelector(e);s&&s.addEventListener(t,n.bind(this))}show(){this.element&&(this.element.style.display="block")}hide(){this.element&&(this.element.style.display="none")}}class Cn extends Sn{constructor(e,t){super(e),this.title=t,this.modalContent=null,this.element.innerHTML=this.render(),this.modalContent=this.element.querySelector(".modal-content"),this.element.addEventListener("click",e=>{e.target===this.element&&this.close()});const n=this.element.querySelector(".close-btn");n&&n.addEventListener("click",()=>this.close())}render(){return`\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h2>${this.title}</h2>\n                    <button class="close-btn"><i class="fas fa-times"></i></button>\n                </div>\n                <div class="modal-body">\n                    \x3c!-- Content will be injected here --\x3e\n                </div>\n            </div>\n        `}open(e){const t=this.element.querySelector(".modal-body");t&&(t.innerHTML=e),this.element.offsetHeight,this.element.classList.add("show"),requestAnimationFrame(()=>{this.calculatePosition()})}close(){this.element.classList.remove("show")}calculatePosition(){const e=this.modalContent;if(!e)return;e.style.marginTop="",e.style.marginBottom="",e.offsetHeight;const t=window.innerHeight,n=e.offsetHeight;if(n<t){const s=Math.max(10,(t-n)/2);e.style.marginTop=`${s}px`,e.style.marginBottom="auto"}else e.style.marginTop="10px",e.style.marginBottom="10px"}}class In{constructor(e){this.vocabularyManager=e,this.modal=new Cn("#vocabularyModal","My Vocabulary"),this.app=null}setApp(e){this.app=e}open(){this.modal.open(this.renderContent()),this.addEventListeners(),this.updateAndRenderLists()}addEventListeners(){document.querySelectorAll(".vocab-tab").forEach(e=>{e.addEventListener("click",e=>this.handleTabClick(e))}),document.getElementById("exportVocabBtn").addEventListener("click",()=>this.onExportVocabulary()),document.getElementById("importVocabBtn").addEventListener("click",()=>document.getElementById("importFile").click()),document.getElementById("importFile").addEventListener("change",e=>this.onImportFileChange(e)),document.getElementById("clearVocabBtn").addEventListener("click",()=>this.onClearVocabulary())}renderContent(){return'\n            <div class="vocab-controls">\n                <button class="btn btn-primary" id="exportVocabBtn"><i class="fas fa-download"></i> Export</button>\n                <button class="btn btn-secondary" id="importVocabBtn"><i class="fas fa-upload"></i> Import</button>\n                <input type="file" id="importFile" accept=".json" style="display: none;">\n                <button class="btn btn-danger" id="clearVocabBtn"><i class="fas fa-trash"></i> Clear All</button>\n            </div>\n            <div class="vocab-tabs">\n                <button class="vocab-tab active" data-tab="learning">Learning (<span id="learning-count">0</span>)</button>\n                <button class="vocab-tab" data-tab="mastered">Mastered (<span id="mastered-count">0</span>)</button>\n            </div>\n            <div id="learning-list-container" class="vocab-tab-content active">\n                <div class="vocab-list" id="learning-list"></div>\n            </div>\n            <div id="mastered-list-container" class="vocab-tab-content">\n                <div class="vocab-list" id="mastered-list"></div>\n            </div>\n        '}updateAndRenderLists(){const e=document.getElementById("learning-list"),t=document.getElementById("mastered-list");if(!e||!t)return;const n=this.vocabularyManager.getSortedByDate(this.vocabularyManager.learningWords);this.renderList(e,n,"learning");const s=this.vocabularyManager.getSortedByDate(this.vocabularyManager.masteredWords);this.renderList(t,s,"mastered"),this.updateCounts()}renderList(e,t,n){e.innerHTML="",0!==t.length?(t.forEach(([t,s])=>{const i="learning"===n?`<button class="btn btn-sm btn-success master-btn" data-word="${t}"><i class="fas fa-check"></i> Master</button>`:`<button class="btn btn-sm btn-info unmaster-btn" data-word="${t}"><i class="fas fa-undo"></i> Learn</button>`,a=document.createElement("div");a.className="vocab-item",a.innerHTML=`\n                <div>\n                    <div class="vocab-word">${t}</div>\n                    <div class="vocab-translation">${s.translation}</div>\n                    <div class="vocab-meta">Added: ${new Date(s.addedDate).toLocaleDateString()}</div>\n                </div>\n                <div class="vocab-actions">\n                    ${i}\n                    <button class="btn btn-sm btn-danger delete-btn" data-word="${t}"><i class="fas fa-trash"></i></button>\n                </div>\n            `,e.appendChild(a)}),e.querySelectorAll(".master-btn").forEach(e=>e.addEventListener("click",e=>this.masterWord(e.currentTarget.dataset.word))),e.querySelectorAll(".unmaster-btn").forEach(e=>e.addEventListener("click",e=>this.unmasterWord(e.currentTarget.dataset.word))),e.querySelectorAll(".delete-btn").forEach(e=>e.addEventListener("click",e=>this.removeFromVocabulary(e.currentTarget.dataset.word)))):e.innerHTML='<p style="text-align: center; color: #6b7280; padding: 2rem;">No words in this list yet.</p>'}updateCounts(){const e=this.vocabularyManager.getLearningSize(),t=this.vocabularyManager.masteredWords.size,n=document.getElementById("vocabCount");n&&(n.textContent=e);const s=document.getElementById("learning-count");s&&(s.textContent=e);const i=document.getElementById("mastered-count");i&&(i.textContent=t)}handleTabClick(e){const t=e.target,n=t.dataset.tab;document.querySelectorAll(".vocab-tab").forEach(e=>e.classList.remove("active")),t.classList.add("active"),document.querySelectorAll(".vocab-tab-content").forEach(e=>e.classList.remove("active")),document.getElementById(`${n}-list-container`).classList.add("active")}masterWord(e){this.vocabularyManager.masterWord(e)&&(this.updateAndRenderLists(),this.app.showNotification(`'${e}' moved to mastered list.`),this.app.refreshTextAnalysis())}unmasterWord(e){this.vocabularyManager.unmasterWord(e)&&(this.updateAndRenderLists(),this.app.showNotification(`'${e}' moved back to learning list.`),this.app.refreshTextAnalysis())}removeFromVocabulary(e){confirm(`Are you sure you want to permanently delete "${e}"?`)&&this.vocabularyManager.removeWord(e)&&(this.updateAndRenderLists(),this.app.showNotification(`'${e}' has been deleted.`,"info"),this.app.refreshTextAnalysis())}onExportVocabulary(){const e=this.vocabularyManager.exportVocabulary();this.app.downloadJSON(e,"word-discoverer-vocabulary.json"),this.app.showNotification("Vocabulary exported successfully!")}onImportFileChange(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=e=>{try{const t=JSON.parse(e.target.result);this.vocabularyManager.importVocabulary(t)?(this.updateAndRenderLists(),this.app.showNotification("Vocabulary imported successfully!"),this.app.refreshTextAnalysis()):this.app.showNotification("Error importing vocabulary. Check file format.","error")}catch(t){this.app.showNotification("Error importing vocabulary. Check file format.","error")}},n.readAsText(t)}onClearVocabulary(){confirm("Clear all vocabulary (both learning and mastered)? This action cannot be undone.")&&(this.vocabularyManager.clearVocabulary(),this.updateAndRenderLists(),this.app.showNotification("All vocabulary has been cleared."),this.app.refreshTextAnalysis())}}class Dn{constructor(e,t){this.settingsManager=e,this.googleDriveManager=t,this.modal=new Cn("#settingsModal","Settings"),this.app=null,this.userInfo=null,this.lastSyncTime=null}setApp(e){this.app=e}open(){this.modal.open(this.renderContent()),this.loadSettingsToUI(),this.addEventListeners(),this.updateGoogleDriveStatus()}addEventListeners(){const e=document.getElementById("highlightOpacity");e&&e.addEventListener("input",e=>this.onOpacityChange(e));const t=document.getElementById("highlightColor");t&&t.addEventListener("change",e=>this.onColorChange(e));const n=document.getElementById("difficultyLevel");n&&n.addEventListener("change",e=>{this.settingsManager.setSetting("difficultyLevel",e.target.value);const t=document.getElementById("mainDifficultyLevel");t&&t.value!==e.target.value&&(t.value=e.target.value)});const s=document.getElementById("highlightMode");s&&s.addEventListener("change",e=>{this.settingsManager.setSetting("highlightMode",e.target.value);const t=document.getElementById("mainHighlightMode");t&&t.value!==e.target.value&&(t.value=e.target.value)});const i=document.getElementById("exportSettingsBtn");i&&i.addEventListener("click",()=>this.onExportSettings());const a=document.getElementById("importSettingsBtn");a&&a.addEventListener("click",()=>{const e=document.getElementById("importSettingsFile");e&&e.click()});const o=document.getElementById("importSettingsFile");o&&o.addEventListener("change",e=>this.onImportSettingsFileChange(e));const r=document.getElementById("enableGoogleDriveBtn");r&&r.addEventListener("click",()=>this.onEnableGoogleDrive());const l=document.getElementById("syncNowBtn");l&&l.addEventListener("click",()=>this.onSyncNow());const c=document.getElementById("disconnectGoogleDriveBtn");c&&c.addEventListener("click",()=>this.onDisconnectGoogleDrive())}renderContent(){return`\n            <div class="settings-section">\n                <h3>Highlighting</h3>\n                <div class="setting-item">\n                    <label for="highlightColor">Highlight Color:</label>\n                    <input type="color" id="highlightColor">\n                </div>\n                <div class="setting-item">\n                    <label for="highlightOpacity">Opacity:</label>\n                    <input type="range" id="highlightOpacity" min="0.1" max="1" step="0.1">\n                    <span id="opacityValue"></span>\n                </div>\n            </div>\n            <div class="settings-section">\n                <h3>Analysis</h3>\n                <div class="setting-item">\n                    <label for="difficultyLevel">Difficulty Level:</label>\n                    <select id="difficultyLevel">\n                        <option value="beginner">Beginner</option>\n                        <option value="intermediate">Intermediate</option>\n                        <option value="advanced">Advanced</option>\n                        <option value="expert">Expert</option>\n                    </select>\n                </div>\n                <div class="setting-item">\n                    <label for="highlightMode">Highlight Mode:</label>\n                    <select id="highlightMode">\n                        <option value="unknown">Unknown Words Only</option>\n                        <option value="difficult">Difficult Words</option>\n                        <option value="all">All Words</option>\n                    </select>\n                </div>\n            </div>\n            <div class="settings-section">\n                <h3>Google Drive Sync</h3>\n                \x3c!-- Google Drive UI will be rendered here --\x3e\n                <div id="google-drive-section">${this.renderGoogleDriveUI()}</div>\n            </div>\n            <div class="settings-section">\n                <h3>Data Management</h3>\n                <div class="setting-item">\n                    <button class="btn btn-primary" id="exportSettingsBtn"><i class="fas fa-download"></i> Export Settings</button>\n                    <button class="btn btn-secondary" id="importSettingsBtn"><i class="fas fa-upload"></i> Import Settings</button>\n                    <input type="file" id="importSettingsFile" accept=".json" style="display: none;">\n                </div>\n            </div>\n        `}renderGoogleDriveUI(){const e=this.googleDriveManager.getAuthStatus();return e.isInitialized?e.isSignedIn?`\n            <div class="google-drive-status">\n                <div class="user-info">\n                    ${this.userInfo&&this.userInfo.imageUrl?`<img src="${this.userInfo.imageUrl}" alt="User Avatar" class="user-avatar">`:'<div class="user-avatar-placeholder"><i class="fas fa-user"></i></div>'}\n                    <div class="user-details">\n                        <div class="user-name">${this.userInfo?.name||"Google User"}</div>\n                        <div class="user-email">${this.userInfo?.email||"No email provided"}</div>\n                    </div>\n                </div>\n                \n                <div class="sync-controls">\n                    <button class="btn btn-primary" id="syncNowBtn">\n                        <i class="fas fa-sync-alt"></i> Sync Now\n                    </button>\n                    <button class="btn btn-secondary" id="disconnectGoogleDriveBtn">\n                        <i class="fas fa-sign-out-alt"></i> Disconnect\n                    </button>\n                </div>\n                \n                ${this.lastSyncTime?`<div class="sync-info">\n                        <div class="last-sync">\n                            <i class="fas fa-check-circle"></i>\n                            <span>Last synced: ${new Date(this.lastSyncTime).toLocaleString()}</span>\n                        </div>\n                    </div>`:'<div class="sync-info">\n                        <div class="last-sync">\n                            <i class="fas fa-info-circle"></i>\n                            <span>Never synced</span>\n                        </div>\n                    </div>'}\n            </div>\n        `:'\n                <div class="google-drive-status">\n                    <div class="status-indicator">\n                        <i class="fas fa-unlink"></i>\n                        <span>Google Drive not connected</span>\n                    </div>\n                    <button class="btn btn-success" id="enableGoogleDriveBtn">\n                        <i class="fab fa-google"></i> Connect to Google Drive\n                    </button>\n                </div>\n            ':'\n                <div class="google-drive-status">\n                    <div class="status-indicator">\n                        <i class="fas fa-exclamation-circle"></i>\n                        <span>Google Drive not initialized</span>\n                    </div>\n                    <button class="btn btn-primary" id="enableGoogleDriveBtn">\n                        <i class="fab fa-google"></i> Initialize Google Drive\n                    </button>\n                </div>\n            '}async updateGoogleDriveStatus(){try{this.googleDriveManager.isSignedIn&&(this.userInfo=await this.googleDriveManager.getUserInfo());const e=document.getElementById("google-drive-section");e&&(e.innerHTML=this.renderGoogleDriveUI(),this.addEventListeners())}catch(e){console.error("Error updating Google Drive status:",e)}}loadSettingsToUI(){const e=this.settingsManager.getAllSettings();Object.entries(e).forEach(([e,t])=>{const n=document.getElementById(e);if(n)if("range"===n.type){n.value=t;const s=document.getElementById(e+"Value");s&&(s.textContent=Math.round(100*t)+"%")}else n.value=t});const t=document.getElementById("mainDifficultyLevel");t&&(t.value=e.difficultyLevel||"intermediate");const n=document.getElementById("mainHighlightMode");n&&(n.value=e.highlightMode||"unknown")}onOpacityChange(e){const t=parseFloat(e.target.value),n=document.getElementById("opacityValue");n&&(n.textContent=Math.round(100*t)+"%"),this.settingsManager.setSetting("highlightOpacity",t)}onColorChange(e){this.settingsManager.setSetting("highlightColor",e.target.value)}onExportSettings(){const e=this.settingsManager.exportSettings();this.app.downloadJSON(e,"settings.json"),this.app.showNotification("Settings exported successfully!")}onImportSettingsFileChange(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=e=>{try{const t=JSON.parse(e.target.result);this.settingsManager.importSettings(t)?(this.loadSettingsToUI(),this.app.showNotification("Settings imported successfully!")):this.app.showNotification("Error importing settings.","error")}catch(t){this.app.showNotification("Error importing settings.","error")}},n.readAsText(t)}async onEnableGoogleDrive(){try{const e=document.getElementById("enableGoogleDriveBtn");e&&(e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Connecting...',e.disabled=!0),this.googleDriveManager.isInitialized||await this.googleDriveManager.initialize();await this.googleDriveManager.signIn()?(this.app.showNotification("Successfully connected to Google Drive!"),await this.updateGoogleDriveStatus()):(this.app.showNotification("Failed to connect to Google Drive.","error"),e&&(e.innerHTML='<i class="fab fa-google"></i> Connect to Google Drive',e.disabled=!1))}catch(e){console.error("Error enabling Google Drive:",e),this.app.showNotification("Error connecting to Google Drive.","error");const t=document.getElementById("enableGoogleDriveBtn");t&&(t.innerHTML='<i class="fab fa-google"></i> Connect to Google Drive',t.disabled=!1)}}async onSyncNow(){try{const e=document.getElementById("syncNowBtn");if(e){const t=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Syncing...',e.disabled=!0;try{const e=this.app.vocabularyManager.exportVocabulary(),t=await this.googleDriveManager.syncVocabulary(e);t.success?(this.lastSyncTime=new Date,this.app.showNotification("Successfully synced with Google Drive!"),await this.updateGoogleDriveStatus(),"download"!==t.action&&"merge"!==t.action||(this.app.vocabularyManager.importVocabulary(t.data),this.app.updateCounts(),this.app.showNotification("Vocabulary updated from Google Drive!"))):this.app.showNotification("Failed to sync with Google Drive: "+t.error,"error")}finally{e.innerHTML=t,e.disabled=!1}}}catch(e){console.error("Error syncing with Google Drive:",e),this.app.showNotification("Error syncing with Google Drive.","error");const t=document.getElementById("syncNowBtn");t&&(t.innerHTML='<i class="fas fa-sync-alt"></i> Sync Now',t.disabled=!1)}}async onDisconnectGoogleDrive(){try{await this.googleDriveManager.signOut()?(this.userInfo=null,this.lastSyncTime=null,this.app.showNotification("Disconnected from Google Drive."),await this.updateGoogleDriveStatus()):this.app.showNotification("Failed to disconnect from Google Drive.","error")}catch(e){console.error("Error disconnecting from Google Drive:",e),this.app.showNotification("Error disconnecting from Google Drive.","error")}}}class Ln extends Sn{constructor(e,t){super(e),this.vocabularyManager=t,this.app=null,this.currentWord=null,this.currentTranslation=null}setApp(e){this.app=e}render(e){this.element.innerHTML=e,this.addEventListeners()}addEventListeners(){this.element.addEventListener("click",e=>{let t=e.target;if("RB"!==t.tagName.toUpperCase()&&"RT"!==t.tagName.toUpperCase()||(t=t.parentElement),t.classList.contains("word-span")){const n=t.dataset.word,s=t.dataset.translation;this.showWordModal(n,s,e)}})}showWordModal(e,t,n){this.currentWord=e,this.currentTranslation=t;const s=document.getElementById("wordModal");document.getElementById("wordModalContent");const i=document.getElementById("wordModalTitle"),a=document.getElementById("wordModalTranslation"),o=document.getElementById("wordModalActions");if(i.textContent=e,t.includes("<")&&t.includes(">")?a.innerHTML=t:a.textContent=t,o.innerHTML="",this.vocabularyManager.masteredWords.has(e)){const t=document.createElement("button");t.textContent="Move to Learning List",t.className="btn btn-secondary",t.onclick=()=>{this.handleWordUnmaster(e),this.closeWordModal()},o.appendChild(t)}else if(this.vocabularyManager.learningWords.has(e)){const n=document.createElement("button");n.textContent="Mark as Mastered",n.className="btn btn-primary",n.onclick=()=>{this.handleWordMaster(e,t),this.closeWordModal()},o.appendChild(n)}else{const n=document.createElement("button");n.textContent="Add to Learning List",n.className="btn btn-primary",n.onclick=()=>{this.handleWordAddToLearning(e,t),this.closeWordModal()},o.appendChild(n);const s=document.createElement("button");s.textContent="Add to Mastered List",s.className="btn btn-secondary",s.onclick=()=>{this.handleWordMaster(e,t),this.closeWordModal()},o.appendChild(s)}const r=document.createElement("button");r.textContent="Close",r.className="btn btn-outline",r.onclick=()=>this.closeWordModal(),o.appendChild(r),s.classList.add("show"),s.onclick=e=>{e.target===s&&this.closeWordModal()}}closeWordModal(){document.getElementById("wordModal").classList.remove("show")}async handleWordAddToLearning(e,t){this.vocabularyManager.addWord(e,t)&&this.app.showNotification(`📖 '${e}' added to learning list.`),this.app.updateCounts(),await this.refreshTextAnalysis()}async handleWordMaster(e,t){const n=this.vocabularyManager.masterWord(e,t);"added_to_mastered"!==n&&"moved_to_mastered"!==n||this.app.showNotification(`✅ '${e}' marked as mastered.`),this.app.updateCounts(),await this.refreshTextAnalysis()}async handleWordUnmaster(e){"moved_to_learning"===this.vocabularyManager.unmasterWord(e)&&(this.app.showNotification(`📖 '${e}' moved to learning list.`),this.app.updateCounts()),await this.refreshTextAnalysis()}async refreshTextAnalysis(){const e=document.getElementById("textInput").value;if(!e)return;const t=await this.app.performTextAnalysis(e),n=await this.app.textAnalyzer.processTextForDisplay(e,t);this.render(n),this.app.updateStatistics&&this.app.updateStatistics(t),this.app.displayHighlightedWords?.(t.highlightedWords)}}class zn{constructor(){this.recognition=null,this.isRecording=!1,this.targetText="",this.recognizedText="",this.callbacks={onStart:null,onResult:null,onEnd:null,onError:null},this.initializeSpeechRecognition()}initializeSpeechRecognition(){const e=window.SpeechRecognition||window.webkitSpeechRecognition;e?(this.recognition=new e,this.recognition.lang="en-US",this.recognition.continuous=!1,this.recognition.interimResults=!1,this.recognition.maxAlternatives=1,this.recognition.onstart=()=>{this.isRecording=!0,this.callbacks.onStart&&this.callbacks.onStart()},this.recognition.onresult=e=>{const t=e.results[0][0];this.recognizedText=t.transcript;const n=t.confidence,s=this.calculatePronunciationScore(this.targetText,this.recognizedText);this.callbacks.onResult&&this.callbacks.onResult({recognized:this.recognizedText,target:this.targetText,score:s,confidence:n,feedback:this.generateFeedback(s,this.targetText,this.recognizedText)})},this.recognition.onerror=e=>{console.error("Speech recognition error:",e.error),this.isRecording=!1,this.callbacks.onError&&this.callbacks.onError(e.error)},this.recognition.onend=()=>{this.isRecording=!1,this.callbacks.onEnd&&this.callbacks.onEnd()}):console.error("Speech Recognition API is not supported in this browser")}startRecording(e){if(!this.recognition)throw new Error("Speech recognition is not supported in this browser");if(this.isRecording)console.warn("Already recording");else{this.targetText=e.trim().toLowerCase(),this.recognizedText="";try{this.recognition.start()}catch(t){console.error("Error starting recording:",t),this.callbacks.onError&&this.callbacks.onError(t.message)}}}stopRecording(){this.recognition&&this.isRecording&&this.recognition.stop()}calculatePronunciationScore(e,t){const n=e.toLowerCase().trim(),s=t.toLowerCase().trim();if(n===s)return 100;const i=this.normalizeWords(n),a=this.normalizeWords(s),o=this.calculateWordMatchScore(i,a),r=this.calculateLevenshteinSimilarity(n,s),l=Math.round(.6*o+.4*r);return Math.max(0,Math.min(100,l))}normalizeWords(e){return e.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter(e=>e.length>0)}calculateWordMatchScore(e,t){if(0===e.length)return 0;let n=0;const s=new Set(e),i=new Set(t);for(const d of s)i.has(d)&&n++;let a=0;const o=Math.min(e.length,t.length);for(let d=0;d<o;d++)e[d]===t[d]&&a++;const r=n/s.size,l=a/e.length,c=Math.min(e.length,t.length)/Math.max(e.length,t.length);return Math.round(100*(.5*r+.3*l+.2*c))}calculateLevenshteinSimilarity(e,t){const n=this.levenshteinDistance(e,t),s=Math.max(e.length,t.length);if(0===s)return 100;const i=(s-n)/s*100;return Math.round(i)}levenshteinDistance(e,t){const n=e.length,s=t.length,i=Array(n+1).fill(null).map(()=>Array(s+1).fill(0));for(let a=0;a<=n;a++)i[a][0]=a;for(let a=0;a<=s;a++)i[0][a]=a;for(let a=1;a<=n;a++)for(let n=1;n<=s;n++)e[a-1]===t[n-1]?i[a][n]=i[a-1][n-1]:i[a][n]=Math.min(i[a-1][n]+1,i[a][n-1]+1,i[a-1][n-1]+1);return i[n][s]}generateFeedback(e,t,n){let s="",i="",a=[];e>=90?(s="excellent",i="🎉 Excellent! Your pronunciation is very accurate!"):e>=75?(s="good",i="👍 Good job! Your pronunciation is quite clear.",a.push("Try to speak a bit more clearly for even better results.")):e>=60?(s="fair",i="😊 Not bad! Keep practicing to improve.",a.push("Pay attention to word endings and pronunciation."),a.push("Try to speak more slowly and clearly.")):(s="needs-improvement",i="💪 Keep practicing! Pronunciation takes time to master.",a.push("Break down the sentence into smaller parts."),a.push("Listen to native speakers and try to imitate."),a.push("Practice individual words first."));const o=this.normalizeWords(t),r=this.normalizeWords(n),l=o.filter(e=>!r.includes(e)),c=r.filter(e=>!o.includes(e));return l.length>0&&a.push(`Missing words: ${l.join(", ")}`),c.length>0&&a.push(`Extra words detected: ${c.join(", ")}`),{level:s,message:i,suggestions:a,score:e}}on(e,t){this.callbacks.hasOwnProperty("on"+e.charAt(0).toUpperCase()+e.slice(1))&&(this.callbacks["on"+e.charAt(0).toUpperCase()+e.slice(1)]=t)}static isSupported(){return!(!window.SpeechRecognition&&!window.webkitSpeechRecognition)}}class Tn extends Sn{constructor(e="#pronunciationModal"){super(e),this.pronunciationChecker=new zn,this.currentSentence="",this.practiceHistory=[],this.maxHistorySize=10,this.sampleSentences=["Hello, how are you today?","I love learning English every day.","Practice makes perfect.","The quick brown fox jumps over the lazy dog.","Reading books helps improve vocabulary.","Pronunciation is important for clear communication.","I enjoy studying new words and phrases.","Speaking English fluently takes time and effort.","Consistency is key to language learning success.","Every mistake is an opportunity to learn."],this.setupEventHandlers()}setupEventHandlers(){this.pronunciationChecker.on("start",()=>{this.updateRecordingUI(!0)}),this.pronunciationChecker.on("result",e=>{this.displayResult(e),this.addToHistory(e)}),this.pronunciationChecker.on("end",()=>{this.updateRecordingUI(!1)}),this.pronunciationChecker.on("error",e=>{this.showError(e),this.updateRecordingUI(!1)})}render(){const e=zn.isSupported(),t=`\n            <div class="modal-content pronunciation-checker-modal">\n                <div class="modal-header">\n                    <h3><i class="fas fa-microphone"></i> Pronunciation Practice</h3>\n                    <button class="modal-close" id="pronunciationModalClose">&times;</button>\n                </div>\n                <div class="modal-body">\n                    ${e?"":'\n                        <div class="alert alert-warning">\n                            <i class="fas fa-exclamation-triangle"></i>\n                            <strong>Browser Not Supported</strong>\n                            <p>Your browser doesn\'t support speech recognition. Please use Chrome, Edge, or Safari.</p>\n                        </div>\n                    '}\n                    \n                    <div class="pronunciation-section">\n                        <h4>Select or Enter a Sentence</h4>\n                        \n                        \x3c!-- Sample sentences --\x3e\n                        <div class="sample-sentences">\n                            <select id="sampleSentenceSelect" class="form-control">\n                                <option value="">-- Choose a sample sentence --</option>\n                                ${this.sampleSentences.map((e,t)=>`<option value="${t}">${e}</option>`).join("")}\n                            </select>\n                        </div>\n                        \n                        \x3c!-- Custom sentence input --\x3e\n                        <div class="custom-sentence">\n                            <textarea \n                                id="customSentenceInput" \n                                class="form-control" \n                                placeholder="Or type your own sentence here..."\n                                rows="3"\n                            ></textarea>\n                        </div>\n                        \n                        \x3c!-- Current practice sentence --\x3e\n                        <div class="practice-sentence" id="practiceSentence" style="display: none;">\n                            <h4>Practice Sentence:</h4>\n                            <div class="sentence-display" id="sentenceDisplay"></div>\n                        </div>\n                        \n                        \x3c!-- Recording controls --\x3e\n                        <div class="recording-controls" id="recordingControls" style="display: none;">\n                            <button \n                                id="startRecordingBtn" \n                                class="btn btn-primary btn-large"\n                                ${e?"":"disabled"}\n                            >\n                                <i class="fas fa-microphone"></i>\n                                <span class="btn-text">Start Recording</span>\n                            </button>\n                            <button \n                                id="stopRecordingBtn" \n                                class="btn btn-danger btn-large" \n                                style="display: none;"\n                            >\n                                <i class="fas fa-stop"></i>\n                                <span class="btn-text">Stop Recording</span>\n                            </button>\n                        </div>\n                        \n                        <div class="recording-status" id="recordingStatus" style="display: none;">\n                            <div class="recording-indicator">\n                                <i class="fas fa-circle recording-dot"></i>\n                                <span>Recording... Speak now!</span>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Results --\x3e\n                        <div class="pronunciation-result" id="pronunciationResult" style="display: none;">\n                            <h4>Result</h4>\n                            \n                            <div class="result-score" id="resultScore">\n                                <div class="score-circle">\n                                    <div class="score-value" id="scoreValue">0</div>\n                                    <div class="score-label">Score</div>\n                                </div>\n                            </div>\n                            \n                            <div class="result-details">\n                                <div class="result-item">\n                                    <strong>You said:</strong>\n                                    <p id="recognizedText" class="recognized-text"></p>\n                                </div>\n                                \n                                <div class="result-item">\n                                    <strong>Target:</strong>\n                                    <p id="targetText" class="target-text"></p>\n                                </div>\n                                \n                                <div class="feedback-section" id="feedbackSection">\n                                    <strong>Feedback:</strong>\n                                    <p id="feedbackMessage" class="feedback-message"></p>\n                                    <ul id="suggestionsList" class="suggestions-list"></ul>\n                                </div>\n                            </div>\n                            \n                            <div class="result-actions">\n                                <button id="tryAgainBtn" class="btn btn-secondary">\n                                    <i class="fas fa-redo"></i> Try Again\n                                </button>\n                                <button id="newSentenceBtn" class="btn btn-outline">\n                                    <i class="fas fa-random"></i> New Sentence\n                                </button>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Practice History --\x3e\n                        <div class="practice-history" id="practiceHistory" style="display: none;">\n                            <h4>Practice History</h4>\n                            <div id="historyList" class="history-list"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `;this.container.innerHTML=t,this.attachEventListeners()}attachEventListeners(){const e=document.getElementById("pronunciationModalClose");e&&e.addEventListener("click",()=>this.close());const t=document.getElementById("sampleSentenceSelect");t&&t.addEventListener("change",e=>{const t=e.target.value;if(""!==t){const e=this.sampleSentences[parseInt(t)];this.setSentence(e),document.getElementById("customSentenceInput").value=""}});const n=document.getElementById("customSentenceInput");n&&n.addEventListener("input",e=>{const t=e.target.value.trim();t.length>0&&(this.setSentence(t),document.getElementById("sampleSentenceSelect").value="")});const s=document.getElementById("startRecordingBtn");s&&s.addEventListener("click",()=>this.startRecording());const i=document.getElementById("stopRecordingBtn");i&&i.addEventListener("click",()=>this.stopRecording());const a=document.getElementById("tryAgainBtn");a&&a.addEventListener("click",()=>this.tryAgain());const o=document.getElementById("newSentenceBtn");o&&o.addEventListener("click",()=>this.selectNewSentence())}setSentence(e){this.currentSentence=e.trim();const t=document.getElementById("sentenceDisplay"),n=document.getElementById("practiceSentence"),s=document.getElementById("recordingControls"),i=document.getElementById("pronunciationResult");t&&(t.textContent=this.currentSentence),n&&(n.style.display="block"),s&&(s.style.display="flex"),i&&(i.style.display="none")}startRecording(){if(this.currentSentence)try{this.pronunciationChecker.startRecording(this.currentSentence)}catch(e){this.showError(e.message)}else alert("Please select or enter a sentence first.")}stopRecording(){this.pronunciationChecker.stopRecording()}updateRecordingUI(e){const t=document.getElementById("startRecordingBtn"),n=document.getElementById("stopRecordingBtn"),s=document.getElementById("recordingStatus");t&&(t.style.display=e?"none":"inline-block"),n&&(n.style.display=e?"inline-block":"none"),s&&(s.style.display=e?"block":"none")}displayResult(e){const t=document.getElementById("pronunciationResult"),n=document.getElementById("scoreValue"),s=document.getElementById("recognizedText"),i=document.getElementById("targetText"),a=document.getElementById("feedbackMessage"),o=document.getElementById("suggestionsList");t&&(t.style.display="block"),n&&(n.textContent=e.score,n.className=`score-value score-${e.feedback.level}`),s&&(s.textContent=e.recognized),i&&(i.textContent=e.target),a&&(a.textContent=e.feedback.message),o&&(o.innerHTML="",e.feedback.suggestions.length>0&&e.feedback.suggestions.forEach(e=>{const t=document.createElement("li");t.textContent=e,o.appendChild(t)}))}addToHistory(e){const t={timestamp:(new Date).toLocaleString(),sentence:e.target,recognized:e.recognized,score:e.score,level:e.feedback.level};this.practiceHistory.unshift(t),this.practiceHistory.length>this.maxHistorySize&&this.practiceHistory.pop(),this.updateHistoryDisplay()}updateHistoryDisplay(){const e=document.getElementById("practiceHistory"),t=document.getElementById("historyList");e&&t&&(0!==this.practiceHistory.length?(e.style.display="block",t.innerHTML="",this.practiceHistory.forEach((e,n)=>{const s=document.createElement("div");s.className="history-item",s.innerHTML=`\n                <div class="history-header">\n                    <span class="history-time">${e.timestamp}</span>\n                    <span class="history-score score-${e.level}">${e.score}</span>\n                </div>\n                <div class="history-sentence">${e.sentence}</div>\n            `,t.appendChild(s)})):e.style.display="none")}tryAgain(){const e=document.getElementById("pronunciationResult");e&&(e.style.display="none")}selectNewSentence(){document.getElementById("sampleSentenceSelect").value="",document.getElementById("customSentenceInput").value="",document.getElementById("practiceSentence").style.display="none",document.getElementById("recordingControls").style.display="none",document.getElementById("pronunciationResult").style.display="none",this.currentSentence=""}showError(e){let t="An error occurred. Please try again.";"not-allowed"===e||"permission-denied"===e?t="Microphone permission denied. Please allow microphone access in your browser settings.":"no-speech"===e?t="No speech detected. Please try speaking again.":"network"===e&&(t="Network error. Please check your internet connection."),alert(t)}open(){this.container.querySelector(".pronunciation-checker-modal")||this.render(),this.container.classList.add("show")}close(){this.container.classList.remove("show"),this.pronunciationChecker.isRecording&&this.pronunciationChecker.stopRecording()}}class Mn{constructor(){this.settingsManager=new xn,this.wordDatabase=new vn,this.vocabularyManager=new En,this.textAnalyzer=new _n(this.wordDatabase),this.vocabularyComponent=new In(this.vocabularyManager),this.settingsComponent=new Dn(this.settingsManager,this.vocabularyManager.googleDriveManager),this.analyzedTextComponent=new Ln("#analyzedText",this.vocabularyManager),this.pronunciationCheckerComponent=new Tn("#pronunciationModal"),this.vocabularyComponent.setApp(this),this.settingsComponent.setApp(this),this.analyzedTextComponent.setApp(this),this.initialize()}async initialize(){this.addEventListeners(),this.updateCounts();const e=document.getElementById("dbLoadingOverlay"),t=document.getElementById("dbProgressBar"),n=document.getElementById("dbProgressPercentage"),s=document.getElementById("dbProgressChunks"),i=document.getElementById("dbLoadingMessage");e.classList.add("show"),this.wordDatabase.setProgressCallback(e=>{t.style.width=`${e.percentage.toFixed(1)}%`,n.textContent=`${e.percentage.toFixed(1)}%`;let s=e.message||"Loading...";!0===e.fromCache?(s=`📦 ${s}`,i.style.color="#059669"):!1===e.fromCache&&(s=`⬇️ ${s}`,i.style.color="#3b82f6"),i.textContent=s}),this.wordDatabase.progressiveLoader&&(this.wordDatabase.progressiveLoader.on("chunkLoaded",e=>{const t=e.fromCache?" (cached)":"";s.textContent=`${e.loaded}/${e.total} chunks${t}`}),this.wordDatabase.progressiveLoader.on("complete",()=>{setTimeout(()=>{e.classList.remove("show")},1e3)})),await this.wordDatabase.initialize(),setTimeout(()=>{e.classList.remove("show")},500),console.log("WordDiscoverer initialized successfully")}addEventListeners(){document.getElementById("analyzeBtn").addEventListener("click",()=>this.analyzeText()),document.getElementById("vocabularyBtn").addEventListener("click",()=>this.vocabularyComponent.open()),document.getElementById("settingsBtn").addEventListener("click",()=>this.settingsComponent.open()),document.getElementById("pronunciationBtn").addEventListener("click",()=>this.pronunciationCheckerComponent.open()),document.getElementById("clearBtn").addEventListener("click",()=>this.clearText());const e=document.getElementById("wordModalClose");e&&e.addEventListener("click",()=>{document.getElementById("wordModal").classList.remove("show")});const t=document.getElementById("mainDifficultyLevel");t&&t.addEventListener("change",async e=>{this.settingsManager.setSetting("difficultyLevel",e.target.value),await this.refreshTextAnalysis()});const n=document.getElementById("mainHighlightMode");n&&n.addEventListener("change",async e=>{this.settingsManager.setSetting("highlightMode",e.target.value),await this.refreshTextAnalysis()})}async analyzeText(){const e=document.getElementById("textInput").value.trim();if(!e)return void this.showNotification("Please enter some text to analyze.","error");const t=document.getElementById("loadingOverlay");t.classList.add("show");try{const t=await this.performTextAnalysis(e),n=await this.textAnalyzer.processTextForDisplay(e,t);this.analyzedTextComponent.render(n),document.getElementById("analyzedTextSection").style.display="block",document.getElementById("statistics").style.display="flex",document.getElementById("highlightedWordsList").style.display="block",this.updateStatistics(t),this.displayHighlightedWords(t.highlightedWords)}catch(n){console.error("Analysis error:",n),this.showNotification("Error analyzing text. Please try again.","error")}finally{t.classList.remove("show")}}async performTextAnalysis(e){const t=this.textAnalyzer.extractWords(e);return await this.textAnalyzer.analyzeWords(t,this.settingsManager.getSetting("difficultyLevel"),this.settingsManager.getSetting("highlightMode"),{learning:this.vocabularyManager.learningWords,mastered:this.vocabularyManager.masteredWords})}async refreshTextAnalysis(){if("block"!==document.getElementById("analyzedTextSection").style.display)return;const e=document.getElementById("textInput").value.trim();if(!e)return;const t=await this.performTextAnalysis(e),n=await this.textAnalyzer.processTextForDisplay(e,t);this.analyzedTextComponent.render(n),this.updateStatistics(t),this.displayHighlightedWords(t.highlightedWords)}updateStatistics(e){document.getElementById("totalWords").textContent=e.totalWords,document.getElementById("highlightedWords").textContent=e.highlightedWords.length,document.getElementById("newWords").textContent=e.newWords.length,document.getElementById("difficultyScore").textContent=e.difficultyScore}displayHighlightedWords(e){const t=document.getElementById("highlightedWordsContainer");if(t.innerHTML="",0===e.length)return void(t.innerHTML="<p>No highlighted words found.</p>");e.forEach(e=>{const n=document.createElement("div");n.className="highlighted-word-item";const s=document.createElement("div");s.innerHTML=e.translation;let i="",a="";const o=s.querySelector(".phonetic-line");o&&(i=o.textContent.trim());const r=s.querySelector(".translation-compact p");if(r&&(a=r.textContent.trim()),!i&&!a){const e=s.querySelector(".pron");e&&(i=e.textContent.trim());const t=s.querySelector(".trans");t&&(a=t.textContent.trim())}if(!a){const e=s.querySelector("p");e&&(a=e.textContent.trim())}const l=document.createElement("div");l.className="word",l.textContent=i?`${e.word} ${i}`:e.word,n.appendChild(l);const c=document.createElement("div");c.className="translation",c.textContent=a||"无翻译",n.appendChild(c),t.appendChild(n)})}updateCounts(){this.vocabularyComponent.updateCounts()}showNotification(e,t="success"){const n=document.createElement("div"),s={success:"#10b981",error:"#ef4444",info:"#3b82f6"};n.style.cssText=`\n            position: fixed; top: 20px; right: 20px; background: ${s[t]||s.success}; color: white;\n            padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n            z-index: 3000; animation: slideIn 0.3s ease; max-width: 300px; word-wrap: break-word;\n        `,n.textContent=e,document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}downloadJSON(e,t){const n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}clearText(){document.getElementById("textInput").value="",document.getElementById("analyzedTextSection").style.display="none",document.getElementById("statistics").style.display="none",document.getElementById("highlightedWordsList").style.display="none",document.getElementById("analyzedText").innerHTML="",document.getElementById("totalWords").textContent="0",document.getElementById("highlightedWords").textContent="0",document.getElementById("newWords").textContent="0",document.getElementById("difficultyScore").textContent="0",document.getElementById("highlightedWordsContainer").innerHTML=""}}document.addEventListener("DOMContentLoaded",()=>{window.wordDiscoverer=new Mn});
