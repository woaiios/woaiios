!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e={};function t(e){let t=e.length;for(;--t>=0;)e[t]=0}const a=256,n=286,s=30,i=15,r=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),o=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),l=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),d=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=new Array(576);t(c);const h=new Array(60);t(h);const u=new Array(512);t(u);const g=new Array(256);t(g);const m=new Array(29);t(m);const f=new Array(s);function p(e,t,a,n,s){this.static_tree=e,this.extra_bits=t,this.extra_base=a,this.elems=n,this.max_length=s,this.has_stree=e&&e.length}let w,y,b;function _(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(f);const v=e=>e<256?u[e]:u[256+(e>>>7)],k=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},E=(e,t,a)=>{e.bi_valid>16-a?(e.bi_buf|=t<<e.bi_valid&65535,k(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=a-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=a)},x=(e,t,a)=>{E(e,a[2*t],a[2*t+1])},S=(e,t)=>{let a=0;do{a|=1&e,e>>>=1,a<<=1}while(--t>0);return a>>>1},D=(e,t,a)=>{const n=new Array(16);let s,r,o=0;for(s=1;s<=i;s++)o=o+a[s-1]<<1,n[s]=o;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=S(n[t]++,t))}},C=e=>{let t;for(t=0;t<n;t++)e.dyn_ltree[2*t]=0;for(t=0;t<s;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},L=e=>{e.bi_valid>8?k(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},I=(e,t,a,n)=>{const s=2*t,i=2*a;return e[s]<e[i]||e[s]===e[i]&&n[t]<=n[a]},z=(e,t,a)=>{const n=e.heap[a];let s=a<<1;for(;s<=e.heap_len&&(s<e.heap_len&&I(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!I(t,n,e.heap[s],e.depth));)e.heap[a]=e.heap[s],a=s,s<<=1;e.heap[a]=n},T=(e,t,n)=>{let s,i,l,d,c=0;if(0!==e.sym_next)do{s=255&e.pending_buf[e.sym_buf+c++],s+=(255&e.pending_buf[e.sym_buf+c++])<<8,i=e.pending_buf[e.sym_buf+c++],0===s?x(e,i,t):(l=g[i],x(e,l+a+1,t),d=r[l],0!==d&&(i-=m[l],E(e,i,d)),s--,l=v(s),x(e,l,n),d=o[l],0!==d&&(s-=f[l],E(e,s,d)))}while(c<e.sym_next);x(e,256,t)},A=(e,t)=>{const a=t.dyn_tree,n=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let o,l,d,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<r;o++)0!==a[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):a[2*o+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=c<2?++c:0,a[2*d]=1,e.depth[d]=0,e.opt_len--,s&&(e.static_len-=n[2*d+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)z(e,a,o);d=r;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],z(e,a,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,a[2*d]=a[2*o]+a[2*l],e.depth[d]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,a[2*o+1]=a[2*l+1]=d,e.heap[1]=d++,z(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const a=t.dyn_tree,n=t.max_code,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,d=t.stat_desc.max_length;let c,h,u,g,m,f,p=0;for(g=0;g<=i;g++)e.bl_count[g]=0;for(a[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)h=e.heap[c],g=a[2*a[2*h+1]+1]+1,g>d&&(g=d,p++),a[2*h+1]=g,h>n||(e.bl_count[g]++,m=0,h>=l&&(m=o[h-l]),f=a[2*h],e.opt_len+=f*(g+m),r&&(e.static_len+=f*(s[2*h+1]+m)));if(0!==p){do{for(g=d-1;0===e.bl_count[g];)g--;e.bl_count[g]--,e.bl_count[g+1]+=2,e.bl_count[d]--,p-=2}while(p>0);for(g=d;0!==g;g--)for(h=e.bl_count[g];0!==h;)u=e.heap[--c],u>n||(a[2*u+1]!==g&&(e.opt_len+=(g-a[2*u+1])*a[2*u],a[2*u+1]=g),h--)}})(e,t),D(a,c,e.bl_count)},M=(e,t,a)=>{let n,s,i=-1,r=t[1],o=0,l=7,d=4;for(0===r&&(l=138,d=3),t[2*(a+1)+1]=65535,n=0;n<=a;n++)s=r,r=t[2*(n+1)+1],++o<l&&s===r||(o<d?e.bl_tree[2*s]+=o:0!==s?(s!==i&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=s,0===r?(l=138,d=3):s===r?(l=6,d=3):(l=7,d=4))},B=(e,t,a)=>{let n,s,i=-1,r=t[1],o=0,l=7,d=4;for(0===r&&(l=138,d=3),n=0;n<=a;n++)if(s=r,r=t[2*(n+1)+1],!(++o<l&&s===r)){if(o<d)do{x(e,s,e.bl_tree)}while(0!==--o);else 0!==s?(s!==i&&(x(e,s,e.bl_tree),o--),x(e,16,e.bl_tree),E(e,o-3,2)):o<=10?(x(e,17,e.bl_tree),E(e,o-3,3)):(x(e,18,e.bl_tree),E(e,o-11,7));o=0,i=s,0===r?(l=138,d=3):s===r?(l=6,d=3):(l=7,d=4)}};let W=!1;const N=(e,t,a,n)=>{E(e,0+(n?1:0),3),L(e),k(e,a),k(e,~a),a&&e.pending_buf.set(e.window.subarray(t,t+a),e.pending),e.pending+=a};var R={_tr_init:e=>{W||((()=>{let e,t,a,d,_;const v=new Array(16);for(a=0,d=0;d<28;d++)for(m[d]=a,e=0;e<1<<r[d];e++)g[a++]=d;for(g[a-1]=d,_=0,d=0;d<16;d++)for(f[d]=_,e=0;e<1<<o[d];e++)u[_++]=d;for(_>>=7;d<s;d++)for(f[d]=_<<7,e=0;e<1<<o[d]-7;e++)u[256+_++]=d;for(t=0;t<=i;t++)v[t]=0;for(e=0;e<=143;)c[2*e+1]=8,e++,v[8]++;for(;e<=255;)c[2*e+1]=9,e++,v[9]++;for(;e<=279;)c[2*e+1]=7,e++,v[7]++;for(;e<=287;)c[2*e+1]=8,e++,v[8]++;for(D(c,287,v),e=0;e<s;e++)h[2*e+1]=5,h[2*e]=S(e,5);w=new p(c,r,257,n,i),y=new p(h,o,0,s,i),b=new p(new Array(0),l,0,19,7)})(),W=!0),e.l_desc=new _(e.dyn_ltree,w),e.d_desc=new _(e.dyn_dtree,y),e.bl_desc=new _(e.bl_tree,b),e.bi_buf=0,e.bi_valid=0,C(e)},_tr_stored_block:N,_tr_flush_block:(e,t,n,s)=>{let i,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<a;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),A(e,e.l_desc),A(e,e.d_desc),o=(e=>{let t;for(M(e,e.dyn_ltree,e.l_desc.max_code),M(e,e.dyn_dtree,e.d_desc.max_code),A(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*d[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=i&&(i=r)):i=r=n+5,n+4<=i&&-1!==t?N(e,t,n,s):4===e.strategy||r===i?(E(e,2+(s?1:0),3),T(e,c,h)):(E(e,4+(s?1:0),3),((e,t,a,n)=>{let s;for(E(e,t-257,5),E(e,a-1,5),E(e,n-4,4),s=0;s<n;s++)E(e,e.bl_tree[2*d[s]+1],3);B(e,e.dyn_ltree,t-1),B(e,e.dyn_dtree,a-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),T(e,e.dyn_ltree,e.dyn_dtree)),C(e),s&&L(e)},_tr_tally:(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(g[n]+a+1)]++,e.dyn_dtree[2*v(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{E(e,2,3),x(e,256,c),(e=>{16===e.bi_valid?(k(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var F=(e,t,a,n)=>{let s=65535&e,i=e>>>16&65535,r=0;for(;0!==a;){r=a>2e3?2e3:a,a-=r;do{s=s+t[n++]|0,i=i+s|0}while(--r);s%=65521,i%=65521}return s|i<<16};const O=new Uint32Array((()=>{let e,t=[];for(var a=0;a<256;a++){e=a;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t})());var $=(e,t,a,n)=>{const s=O,i=n+a;e^=-1;for(let r=n;r<i;r++)e=e>>>8^s[255&(e^t[r])];return-1^e},U={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},G={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Z,_tr_stored_block:H,_tr_flush_block:V,_tr_tally:P,_tr_align:q}=R,{Z_NO_FLUSH:j,Z_PARTIAL_FLUSH:K,Z_FULL_FLUSH:Y,Z_FINISH:X,Z_BLOCK:Q,Z_OK:J,Z_STREAM_END:ee,Z_STREAM_ERROR:te,Z_DATA_ERROR:ae,Z_BUF_ERROR:ne,Z_DEFAULT_COMPRESSION:se,Z_FILTERED:ie,Z_HUFFMAN_ONLY:re,Z_RLE:oe,Z_FIXED:le,Z_DEFAULT_STRATEGY:de,Z_UNKNOWN:ce,Z_DEFLATED:he}=G,ue=258,ge=262,me=42,fe=113,pe=666,we=(e,t)=>(e.msg=U[t],t),ye=e=>2*e-(e>4?9:0),be=e=>{let t=e.length;for(;--t>=0;)e[t]=0},_e=e=>{let t,a,n,s=e.w_size;t=e.hash_size,n=t;do{a=e.head[--n],e.head[n]=a>=s?a-s:0}while(--t);t=s,n=t;do{a=e.prev[--n],e.prev[n]=a>=s?a-s:0}while(--t)};let ve=(e,t,a)=>(t<<e.hash_shift^a)&e.hash_mask;const ke=e=>{const t=e.state;let a=t.pending;a>e.avail_out&&(a=e.avail_out),0!==a&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+a),e.next_out),e.next_out+=a,t.pending_out+=a,e.total_out+=a,e.avail_out-=a,t.pending-=a,0===t.pending&&(t.pending_out=0))},Ee=(e,t)=>{V(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ke(e.strm)},xe=(e,t)=>{e.pending_buf[e.pending++]=t},Se=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},De=(e,t,a,n)=>{let s=e.avail_in;return s>n&&(s=n),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),a),1===e.state.wrap?e.adler=F(e.adler,t,s,a):2===e.state.wrap&&(e.adler=$(e.adler,t,s,a)),e.next_in+=s,e.total_in+=s,s)},Ce=(e,t)=>{let a,n,s=e.max_chain_length,i=e.strstart,r=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-ge?e.strstart-(e.w_size-ge):0,d=e.window,c=e.w_mask,h=e.prev,u=e.strstart+ue;let g=d[i+r-1],m=d[i+r];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(a=t,d[a+r]===m&&d[a+r-1]===g&&d[a]===d[i]&&d[++a]===d[i+1]){i+=2,a++;do{}while(d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&d[++i]===d[++a]&&i<u);if(n=ue-(u-i),i=u-ue,n>r){if(e.match_start=t,r=n,n>=o)break;g=d[i+r-1],m=d[i+r]}}}while((t=h[t&c])>l&&0!==--s);return r<=e.lookahead?r:e.lookahead},Le=e=>{const t=e.w_size;let a,n,s;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ge)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),_e(e),n+=t),0===e.strm.avail_in)break;if(a=De(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=a,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=ve(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=ve(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ge&&0!==e.strm.avail_in)},Ie=(e,t)=>{let a,n,s,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r=0,o=e.strm.avail_in;do{if(a=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,n=e.strstart-e.block_start,a>n+e.strm.avail_in&&(a=n+e.strm.avail_in),a>s&&(a=s),a<i&&(0===a&&t!==X||t===j||a!==n+e.strm.avail_in))break;r=t===X&&a===n+e.strm.avail_in?1:0,H(e,0,0,r),e.pending_buf[e.pending-4]=a,e.pending_buf[e.pending-3]=a>>8,e.pending_buf[e.pending-2]=~a,e.pending_buf[e.pending-1]=~a>>8,ke(e.strm),n&&(n>a&&(n=a),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,a-=n),a&&(De(e.strm,e.strm.output,e.strm.next_out,a),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a)}while(0===r);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),r?4:t!==j&&t!==X&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(De(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,i=s>e.w_size?e.w_size:s,n=e.strstart-e.block_start,(n>=i||(n||t===X)&&t!==j&&0===e.strm.avail_in&&n<=s)&&(a=n>s?s:n,r=t===X&&0===e.strm.avail_in&&a===n?1:0,H(e,e.block_start,a,r),e.block_start+=a,ke(e.strm)),r?3:1)},ze=(e,t)=>{let a,n;for(;;){if(e.lookahead<ge){if(Le(e),e.lookahead<ge&&t===j)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-ge&&(e.match_length=Ce(e,a)),e.match_length>=3)if(n=P(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ve(e,e.ins_h,e.window[e.strstart+1]);else n=P(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(Ee(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===X?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2},Te=(e,t)=>{let a,n,s;for(;;){if(e.lookahead<ge){if(Le(e),e.lookahead<ge&&t===j)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-ge&&(e.match_length=Ce(e,a),e.match_length<=5&&(e.strategy===ie||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,n=P(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(Ee(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(n=P(e,0,e.window[e.strstart-1]),n&&Ee(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=P(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===X?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2};function Ae(e,t,a,n,s){this.good_length=e,this.max_lazy=t,this.nice_length=a,this.max_chain=n,this.func=s}const Me=[new Ae(0,0,0,0,Ie),new Ae(4,4,8,4,ze),new Ae(4,5,16,8,ze),new Ae(4,6,32,32,ze),new Ae(4,4,16,16,Te),new Ae(8,16,32,32,Te),new Ae(8,16,128,128,Te),new Ae(8,32,128,256,Te),new Ae(32,128,258,1024,Te),new Ae(32,258,258,4096,Te)];function Be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=he,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),be(this.dyn_ltree),be(this.dyn_dtree),be(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),be(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),be(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const We=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==me&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==fe&&t.status!==pe?1:0},Ne=e=>{if(We(e))return we(e,te);e.total_in=e.total_out=0,e.data_type=ce;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?me:fe,e.adler=2===t.wrap?0:1,t.last_flush=-2,Z(t),J},Re=e=>{const t=Ne(e);var a;return t===J&&((a=e.state).window_size=2*a.w_size,be(a.head),a.max_lazy_match=Me[a.level].max_lazy,a.good_match=Me[a.level].good_length,a.nice_match=Me[a.level].nice_length,a.max_chain_length=Me[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),t},Fe=(e,t,a,n,s,i)=>{if(!e)return te;let r=1;if(t===se&&(t=6),n<0?(r=0,n=-n):n>15&&(r=2,n-=16),s<1||s>9||a!==he||n<8||n>15||t<0||t>9||i<0||i>le||8===n&&1!==r)return we(e,te);8===n&&(n=9);const o=new Be;return e.state=o,o.strm=e,o.status=me,o.wrap=r,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=i,o.method=a,Re(e)};var Oe={deflateInit:(e,t)=>Fe(e,t,he,15,8,de),deflateInit2:Fe,deflateReset:Re,deflateResetKeep:Ne,deflateSetHeader:(e,t)=>We(e)||2!==e.state.wrap?te:(e.state.gzhead=t,J),deflate:(e,t)=>{if(We(e)||t>Q||t<0)return e?we(e,te):te;const a=e.state;if(!e.output||0!==e.avail_in&&!e.input||a.status===pe&&t!==X)return we(e,0===e.avail_out?ne:te);const n=a.last_flush;if(a.last_flush=t,0!==a.pending){if(ke(e),0===e.avail_out)return a.last_flush=-1,J}else if(0===e.avail_in&&ye(t)<=ye(n)&&t!==X)return we(e,ne);if(a.status===pe&&0!==e.avail_in)return we(e,ne);if(a.status===me&&0===a.wrap&&(a.status=fe),a.status===me){let t=he+(a.w_bits-8<<4)<<8,n=-1;if(n=a.strategy>=re||a.level<2?0:a.level<6?1:6===a.level?2:3,t|=n<<6,0!==a.strstart&&(t|=32),t+=31-t%31,Se(a,t),0!==a.strstart&&(Se(a,e.adler>>>16),Se(a,65535&e.adler)),e.adler=1,a.status=fe,ke(e),0!==a.pending)return a.last_flush=-1,J}if(57===a.status)if(e.adler=0,xe(a,31),xe(a,139),xe(a,8),a.gzhead)xe(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),xe(a,255&a.gzhead.time),xe(a,a.gzhead.time>>8&255),xe(a,a.gzhead.time>>16&255),xe(a,a.gzhead.time>>24&255),xe(a,9===a.level?2:a.strategy>=re||a.level<2?4:0),xe(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(xe(a,255&a.gzhead.extra.length),xe(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=$(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(xe(a,0),xe(a,0),xe(a,0),xe(a,0),xe(a,0),xe(a,9===a.level?2:a.strategy>=re||a.level<2?4:0),xe(a,3),a.status=fe,ke(e),0!==a.pending)return a.last_flush=-1,J;if(69===a.status){if(a.gzhead.extra){let t=a.pending,n=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+n>a.pending_buf_size;){let s=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+s),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>t&&(e.adler=$(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex+=s,ke(e),0!==a.pending)return a.last_flush=-1,J;t=0,n-=s}let s=new Uint8Array(a.gzhead.extra);a.pending_buf.set(s.subarray(a.gzindex,a.gzindex+n),a.pending),a.pending+=n,a.gzhead.hcrc&&a.pending>t&&(e.adler=$(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let t,n=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>n&&(e.adler=$(e.adler,a.pending_buf,a.pending-n,n)),ke(e),0!==a.pending)return a.last_flush=-1,J;n=0}t=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,xe(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>n&&(e.adler=$(e.adler,a.pending_buf,a.pending-n,n)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let t,n=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>n&&(e.adler=$(e.adler,a.pending_buf,a.pending-n,n)),ke(e),0!==a.pending)return a.last_flush=-1,J;n=0}t=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,xe(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>n&&(e.adler=$(e.adler,a.pending_buf,a.pending-n,n))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(ke(e),0!==a.pending))return a.last_flush=-1,J;xe(a,255&e.adler),xe(a,e.adler>>8&255),e.adler=0}if(a.status=fe,ke(e),0!==a.pending)return a.last_flush=-1,J}if(0!==e.avail_in||0!==a.lookahead||t!==j&&a.status!==pe){let n=0===a.level?Ie(a,t):a.strategy===re?((e,t)=>{let a;for(;;){if(0===e.lookahead&&(Le(e),0===e.lookahead)){if(t===j)return 1;break}if(e.match_length=0,a=P(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(Ee(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2})(a,t):a.strategy===oe?((e,t)=>{let a,n,s,i;const r=e.window;for(;;){if(e.lookahead<=ue){if(Le(e),e.lookahead<=ue&&t===j)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,n=r[s],n===r[++s]&&n===r[++s]&&n===r[++s])){i=e.strstart+ue;do{}while(n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&s<i);e.match_length=ue-(i-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(a=P(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=P(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(Ee(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2})(a,t):Me[a.level].func(a,t);if(3!==n&&4!==n||(a.status=pe),1===n||3===n)return 0===e.avail_out&&(a.last_flush=-1),J;if(2===n&&(t===K?q(a):t!==Q&&(H(a,0,0,!1),t===Y&&(be(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),ke(e),0===e.avail_out))return a.last_flush=-1,J}return t!==X?J:a.wrap<=0?ee:(2===a.wrap?(xe(a,255&e.adler),xe(a,e.adler>>8&255),xe(a,e.adler>>16&255),xe(a,e.adler>>24&255),xe(a,255&e.total_in),xe(a,e.total_in>>8&255),xe(a,e.total_in>>16&255),xe(a,e.total_in>>24&255)):(Se(a,e.adler>>>16),Se(a,65535&e.adler)),ke(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?J:ee)},deflateEnd:e=>{if(We(e))return te;const t=e.state.status;return e.state=null,t===fe?we(e,ae):J},deflateSetDictionary:(e,t)=>{let a=t.length;if(We(e))return te;const n=e.state,s=n.wrap;if(2===s||1===s&&n.status!==me||n.lookahead)return te;if(1===s&&(e.adler=F(e.adler,t,a,0)),n.wrap=0,a>=n.w_size){0===s&&(be(n.head),n.strstart=0,n.block_start=0,n.insert=0);let e=new Uint8Array(n.w_size);e.set(t.subarray(a-n.w_size,a),0),t=e,a=n.w_size}const i=e.avail_in,r=e.next_in,o=e.input;for(e.avail_in=a,e.next_in=0,e.input=t,Le(n);n.lookahead>=3;){let e=n.strstart,t=n.lookahead-2;do{n.ins_h=ve(n,n.ins_h,n.window[e+3-1]),n.prev[e&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=e,e++}while(--t);n.strstart=e,n.lookahead=2,Le(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=r,e.input=o,e.avail_in=i,n.wrap=s,J},deflateInfo:"pako deflate (from Nodeca project)"};const $e=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Ue=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const t in a)$e(a,t)&&(e[t]=a[t])}}return e},Ge=e=>{let t=0;for(let n=0,s=e.length;n<s;n++)t+=e[n].length;const a=new Uint8Array(t);for(let n=0,s=0,i=e.length;n<i;n++){let t=e[n];a.set(t,s),s+=t.length}return a};let Ze=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(za){Ze=!1}const He=new Uint8Array(256);for(let Ta=0;Ta<256;Ta++)He[Ta]=Ta>=252?6:Ta>=248?5:Ta>=240?4:Ta>=224?3:Ta>=192?2:1;He[254]=He[254]=1;var Ve=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,a,n,s,i,r=e.length,o=0;for(s=0;s<r;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<r&&(n=e.charCodeAt(s+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),s++)),o+=a<128?1:a<2048?2:a<65536?3:4;for(t=new Uint8Array(o),i=0,s=0;i<o;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<r&&(n=e.charCodeAt(s+1),56320==(64512&n)&&(a=65536+(a-55296<<10)+(n-56320),s++)),a<128?t[i++]=a:a<2048?(t[i++]=192|a>>>6,t[i++]=128|63&a):a<65536?(t[i++]=224|a>>>12,t[i++]=128|a>>>6&63,t[i++]=128|63&a):(t[i++]=240|a>>>18,t[i++]=128|a>>>12&63,t[i++]=128|a>>>6&63,t[i++]=128|63&a);return t},Pe=(e,t)=>{const a=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let n,s;const i=new Array(2*a);for(s=0,n=0;n<a;){let t=e[n++];if(t<128){i[s++]=t;continue}let r=He[t];if(r>4)i[s++]=65533,n+=r-1;else{for(t&=2===r?31:3===r?15:7;r>1&&n<a;)t=t<<6|63&e[n++],r--;r>1?i[s++]=65533:t<65536?i[s++]=t:(t-=65536,i[s++]=55296|t>>10&1023,i[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Ze)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let a="";for(let n=0;n<t;n++)a+=String.fromCharCode(e[n]);return a})(i,s)},qe=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let a=t-1;for(;a>=0&&128==(192&e[a]);)a--;return a<0||0===a?t:a+He[e[a]]>t?a:t};var je=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ke=Object.prototype.toString,{Z_NO_FLUSH:Ye,Z_SYNC_FLUSH:Xe,Z_FULL_FLUSH:Qe,Z_FINISH:Je,Z_OK:et,Z_STREAM_END:tt,Z_DEFAULT_COMPRESSION:at,Z_DEFAULT_STRATEGY:nt,Z_DEFLATED:st}=G;function it(e){this.options=Ue({level:at,method:st,chunkSize:16384,windowBits:15,memLevel:8,strategy:nt},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new je,this.strm.avail_out=0;let a=Oe.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(a!==et)throw new Error(U[a]);if(t.header&&Oe.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Ve(t.dictionary):"[object ArrayBuffer]"===Ke.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,a=Oe.deflateSetDictionary(this.strm,e),a!==et)throw new Error(U[a]);this._dict_set=!0}}function rt(e,t){const a=new it(t);if(a.push(e,!0),a.err)throw a.msg||U[a.err];return a.result}it.prototype.push=function(e,t){const a=this.strm,n=this.options.chunkSize;let s,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?Je:Ye,"string"==typeof e?a.input=Ve(e):"[object ArrayBuffer]"===Ke.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(n),a.next_out=0,a.avail_out=n),(i===Xe||i===Qe)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(s=Oe.deflate(a,i),s===tt)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),s=Oe.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===et;if(0!==a.avail_out){if(i>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},it.prototype.onData=function(e){this.chunks.push(e)},it.prototype.onEnd=function(e){e===et&&(this.result=Ge(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ot={Deflate:it,deflate:rt,deflateRaw:function(e,t){return(t=t||{}).raw=!0,rt(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,rt(e,t)}};const lt=16209;var dt=function(e,t){let a,n,s,i,r,o,l,d,c,h,u,g,m,f,p,w,y,b,_,v,k,E,x,S;const D=e.state;a=e.next_in,x=e.input,n=a+(e.avail_in-5),s=e.next_out,S=e.output,i=s-(t-e.avail_out),r=s+(e.avail_out-257),o=D.dmax,l=D.wsize,d=D.whave,c=D.wnext,h=D.window,u=D.hold,g=D.bits,m=D.lencode,f=D.distcode,p=(1<<D.lenbits)-1,w=(1<<D.distbits)-1;e:do{g<15&&(u+=x[a++]<<g,g+=8,u+=x[a++]<<g,g+=8),y=m[u&p];t:for(;;){if(b=y>>>24,u>>>=b,g-=b,b=y>>>16&255,0===b)S[s++]=65535&y;else{if(!(16&b)){if(64&b){if(32&b){D.mode=16191;break e}e.msg="invalid literal/length code",D.mode=lt;break e}y=m[(65535&y)+(u&(1<<b)-1)];continue t}for(_=65535&y,b&=15,b&&(g<b&&(u+=x[a++]<<g,g+=8),_+=u&(1<<b)-1,u>>>=b,g-=b),g<15&&(u+=x[a++]<<g,g+=8,u+=x[a++]<<g,g+=8),y=f[u&w];;){if(b=y>>>24,u>>>=b,g-=b,b=y>>>16&255,16&b){if(v=65535&y,b&=15,g<b&&(u+=x[a++]<<g,g+=8,g<b&&(u+=x[a++]<<g,g+=8)),v+=u&(1<<b)-1,v>o){e.msg="invalid distance too far back",D.mode=lt;break e}if(u>>>=b,g-=b,b=s-i,v>b){if(b=v-b,b>d&&D.sane){e.msg="invalid distance too far back",D.mode=lt;break e}if(k=0,E=h,0===c){if(k+=l-b,b<_){_-=b;do{S[s++]=h[k++]}while(--b);k=s-v,E=S}}else if(c<b){if(k+=l+c-b,b-=c,b<_){_-=b;do{S[s++]=h[k++]}while(--b);if(k=0,c<_){b=c,_-=b;do{S[s++]=h[k++]}while(--b);k=s-v,E=S}}}else if(k+=c-b,b<_){_-=b;do{S[s++]=h[k++]}while(--b);k=s-v,E=S}for(;_>2;)S[s++]=E[k++],S[s++]=E[k++],S[s++]=E[k++],_-=3;_&&(S[s++]=E[k++],_>1&&(S[s++]=E[k++]))}else{k=s-v;do{S[s++]=S[k++],S[s++]=S[k++],S[s++]=S[k++],_-=3}while(_>2);_&&(S[s++]=S[k++],_>1&&(S[s++]=S[k++]))}break}if(64&b){e.msg="invalid distance code",D.mode=lt;break e}y=f[(65535&y)+(u&(1<<b)-1)]}}break}}while(a<n&&s<r);_=g>>3,a-=_,g-=_<<3,u&=(1<<g)-1,e.next_in=a,e.next_out=s,e.avail_in=a<n?n-a+5:5-(a-n),e.avail_out=s<r?r-s+257:257-(s-r),D.hold=u,D.bits=g};const ct=15,ht=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ut=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),gt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),mt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ft=(e,t,a,n,s,i,r,o)=>{const l=o.bits;let d,c,h,u,g,m,f=0,p=0,w=0,y=0,b=0,_=0,v=0,k=0,E=0,x=0,S=null;const D=new Uint16Array(16),C=new Uint16Array(16);let L,I,z,T=null;for(f=0;f<=ct;f++)D[f]=0;for(p=0;p<n;p++)D[t[a+p]]++;for(b=l,y=ct;y>=1&&0===D[y];y--);if(b>y&&(b=y),0===y)return s[i++]=20971520,s[i++]=20971520,o.bits=1,0;for(w=1;w<y&&0===D[w];w++);for(b<w&&(b=w),k=1,f=1;f<=ct;f++)if(k<<=1,k-=D[f],k<0)return-1;if(k>0&&(0===e||1!==y))return-1;for(C[1]=0,f=1;f<ct;f++)C[f+1]=C[f]+D[f];for(p=0;p<n;p++)0!==t[a+p]&&(r[C[t[a+p]]++]=p);if(0===e?(S=T=r,m=20):1===e?(S=ht,T=ut,m=257):(S=gt,T=mt,m=0),x=0,p=0,f=w,g=i,_=b,v=0,h=-1,E=1<<b,u=E-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){L=f-v,r[p]+1<m?(I=0,z=r[p]):r[p]>=m?(I=T[r[p]-m],z=S[r[p]-m]):(I=96,z=0),d=1<<f-v,c=1<<_,w=c;do{c-=d,s[g+(x>>v)+c]=L<<24|I<<16|z}while(0!==c);for(d=1<<f-1;x&d;)d>>=1;if(0!==d?(x&=d-1,x+=d):x=0,p++,0===--D[f]){if(f===y)break;f=t[a+r[p]]}if(f>b&&(x&u)!==h){for(0===v&&(v=b),g+=w,_=f-v,k=1<<_;_+v<y&&(k-=D[_+v],!(k<=0));)_++,k<<=1;if(E+=1<<_,1===e&&E>852||2===e&&E>592)return 1;h=x&u,s[h]=b<<24|_<<16|g-i}}return 0!==x&&(s[g+x]=f-v<<24|64<<16),o.bits=b,0};const{Z_FINISH:pt,Z_BLOCK:wt,Z_TREES:yt,Z_OK:bt,Z_STREAM_END:_t,Z_NEED_DICT:vt,Z_STREAM_ERROR:kt,Z_DATA_ERROR:Et,Z_MEM_ERROR:xt,Z_BUF_ERROR:St,Z_DEFLATED:Dt}=G,Ct=16180,Lt=16190,It=16191,zt=16192,Tt=16194,At=16199,Mt=16200,Bt=16206,Wt=16209,Nt=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Rt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ft=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Ct||t.mode>16211?1:0},Ot=e=>{if(Ft(e))return kt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Ct,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,bt},$t=e=>{if(Ft(e))return kt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Ot(e)},Ut=(e,t)=>{let a;if(Ft(e))return kt;const n=e.state;return t<0?(a=0,t=-t):(a=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?kt:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=a,n.wbits=t,$t(e))},Gt=(e,t)=>{if(!e)return kt;const a=new Rt;e.state=a,a.strm=e,a.window=null,a.mode=Ct;const n=Ut(e,t);return n!==bt&&(e.state=null),n};let Zt,Ht,Vt=!0;const Pt=e=>{if(Vt){Zt=new Int32Array(512),Ht=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ft(1,e.lens,0,288,Zt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ft(2,e.lens,0,32,Ht,0,e.work,{bits:5}),Vt=!1}e.lencode=Zt,e.lenbits=9,e.distcode=Ht,e.distbits=5},qt=(e,t,a,n)=>{let s;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),n>=i.wsize?(i.window.set(t.subarray(a-i.wsize,a),0),i.wnext=0,i.whave=i.wsize):(s=i.wsize-i.wnext,s>n&&(s=n),i.window.set(t.subarray(a-n,a-n+s),i.wnext),(n-=s)?(i.window.set(t.subarray(a-n,a),0),i.wnext=n,i.whave=i.wsize):(i.wnext+=s,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=s))),0};var jt={inflateReset:$t,inflateReset2:Ut,inflateResetKeep:Ot,inflateInit:e=>Gt(e,15),inflateInit2:Gt,inflate:(e,t)=>{let a,n,s,i,r,o,l,d,c,h,u,g,m,f,p,w,y,b,_,v,k,E,x=0;const S=new Uint8Array(4);let D,C;const L=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ft(e)||!e.output||!e.input&&0!==e.avail_in)return kt;a=e.state,a.mode===It&&(a.mode=zt),r=e.next_out,s=e.output,l=e.avail_out,i=e.next_in,n=e.input,o=e.avail_in,d=a.hold,c=a.bits,h=o,u=l,E=bt;e:for(;;)switch(a.mode){case Ct:if(0===a.wrap){a.mode=zt;break}for(;c<16;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}if(2&a.wrap&&35615===d){0===a.wbits&&(a.wbits=15),a.check=0,S[0]=255&d,S[1]=d>>>8&255,a.check=$(a.check,S,2,0),d=0,c=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",a.mode=Wt;break}if((15&d)!==Dt){e.msg="unknown compression method",a.mode=Wt;break}if(d>>>=4,c-=4,k=8+(15&d),0===a.wbits&&(a.wbits=k),k>15||k>a.wbits){e.msg="invalid window size",a.mode=Wt;break}a.dmax=1<<a.wbits,a.flags=0,e.adler=a.check=1,a.mode=512&d?16189:It,d=0,c=0;break;case 16181:for(;c<16;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}if(a.flags=d,(255&a.flags)!==Dt){e.msg="unknown compression method",a.mode=Wt;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=Wt;break}a.head&&(a.head.text=d>>8&1),512&a.flags&&4&a.wrap&&(S[0]=255&d,S[1]=d>>>8&255,a.check=$(a.check,S,2,0)),d=0,c=0,a.mode=16182;case 16182:for(;c<32;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}a.head&&(a.head.time=d),512&a.flags&&4&a.wrap&&(S[0]=255&d,S[1]=d>>>8&255,S[2]=d>>>16&255,S[3]=d>>>24&255,a.check=$(a.check,S,4,0)),d=0,c=0,a.mode=16183;case 16183:for(;c<16;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}a.head&&(a.head.xflags=255&d,a.head.os=d>>8),512&a.flags&&4&a.wrap&&(S[0]=255&d,S[1]=d>>>8&255,a.check=$(a.check,S,2,0)),d=0,c=0,a.mode=16184;case 16184:if(1024&a.flags){for(;c<16;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}a.length=d,a.head&&(a.head.extra_len=d),512&a.flags&&4&a.wrap&&(S[0]=255&d,S[1]=d>>>8&255,a.check=$(a.check,S,2,0)),d=0,c=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(g=a.length,g>o&&(g=o),g&&(a.head&&(k=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(n.subarray(i,i+g),k)),512&a.flags&&4&a.wrap&&(a.check=$(a.check,n,g,i)),o-=g,i+=g,a.length-=g),a.length))break e;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===o)break e;g=0;do{k=n[i+g++],a.head&&k&&a.length<65536&&(a.head.name+=String.fromCharCode(k))}while(k&&g<o);if(512&a.flags&&4&a.wrap&&(a.check=$(a.check,n,g,i)),o-=g,i+=g,k)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===o)break e;g=0;do{k=n[i+g++],a.head&&k&&a.length<65536&&(a.head.comment+=String.fromCharCode(k))}while(k&&g<o);if(512&a.flags&&4&a.wrap&&(a.check=$(a.check,n,g,i)),o-=g,i+=g,k)break e}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;c<16;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}if(4&a.wrap&&d!==(65535&a.check)){e.msg="header crc mismatch",a.mode=Wt;break}d=0,c=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=It;break;case 16189:for(;c<32;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}e.adler=a.check=Nt(d),d=0,c=0,a.mode=Lt;case Lt:if(0===a.havedict)return e.next_out=r,e.avail_out=l,e.next_in=i,e.avail_in=o,a.hold=d,a.bits=c,vt;e.adler=a.check=1,a.mode=It;case It:if(t===wt||t===yt)break e;case zt:if(a.last){d>>>=7&c,c-=7&c,a.mode=Bt;break}for(;c<3;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}switch(a.last=1&d,d>>>=1,c-=1,3&d){case 0:a.mode=16193;break;case 1:if(Pt(a),a.mode=At,t===yt){d>>>=2,c-=2;break e}break;case 2:a.mode=16196;break;case 3:e.msg="invalid block type",a.mode=Wt}d>>>=2,c-=2;break;case 16193:for(d>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",a.mode=Wt;break}if(a.length=65535&d,d=0,c=0,a.mode=Tt,t===yt)break e;case Tt:a.mode=16195;case 16195:if(g=a.length,g){if(g>o&&(g=o),g>l&&(g=l),0===g)break e;s.set(n.subarray(i,i+g),r),o-=g,i+=g,l-=g,r+=g,a.length-=g;break}a.mode=It;break;case 16196:for(;c<14;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}if(a.nlen=257+(31&d),d>>>=5,c-=5,a.ndist=1+(31&d),d>>>=5,c-=5,a.ncode=4+(15&d),d>>>=4,c-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=Wt;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;c<3;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}a.lens[L[a.have++]]=7&d,d>>>=3,c-=3}for(;a.have<19;)a.lens[L[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,D={bits:a.lenbits},E=ft(0,a.lens,0,19,a.lencode,0,a.work,D),a.lenbits=D.bits,E){e.msg="invalid code lengths set",a.mode=Wt;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;x=a.lencode[d&(1<<a.lenbits)-1],p=x>>>24,w=x>>>16&255,y=65535&x,!(p<=c);){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}if(y<16)d>>>=p,c-=p,a.lens[a.have++]=y;else{if(16===y){for(C=p+2;c<C;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}if(d>>>=p,c-=p,0===a.have){e.msg="invalid bit length repeat",a.mode=Wt;break}k=a.lens[a.have-1],g=3+(3&d),d>>>=2,c-=2}else if(17===y){for(C=p+3;c<C;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}d>>>=p,c-=p,k=0,g=3+(7&d),d>>>=3,c-=3}else{for(C=p+7;c<C;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}d>>>=p,c-=p,k=0,g=11+(127&d),d>>>=7,c-=7}if(a.have+g>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=Wt;break}for(;g--;)a.lens[a.have++]=k}}if(a.mode===Wt)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=Wt;break}if(a.lenbits=9,D={bits:a.lenbits},E=ft(1,a.lens,0,a.nlen,a.lencode,0,a.work,D),a.lenbits=D.bits,E){e.msg="invalid literal/lengths set",a.mode=Wt;break}if(a.distbits=6,a.distcode=a.distdyn,D={bits:a.distbits},E=ft(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,D),a.distbits=D.bits,E){e.msg="invalid distances set",a.mode=Wt;break}if(a.mode=At,t===yt)break e;case At:a.mode=Mt;case Mt:if(o>=6&&l>=258){e.next_out=r,e.avail_out=l,e.next_in=i,e.avail_in=o,a.hold=d,a.bits=c,dt(e,u),r=e.next_out,s=e.output,l=e.avail_out,i=e.next_in,n=e.input,o=e.avail_in,d=a.hold,c=a.bits,a.mode===It&&(a.back=-1);break}for(a.back=0;x=a.lencode[d&(1<<a.lenbits)-1],p=x>>>24,w=x>>>16&255,y=65535&x,!(p<=c);){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}if(w&&!(240&w)){for(b=p,_=w,v=y;x=a.lencode[v+((d&(1<<b+_)-1)>>b)],p=x>>>24,w=x>>>16&255,y=65535&x,!(b+p<=c);){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}d>>>=b,c-=b,a.back+=b}if(d>>>=p,c-=p,a.back+=p,a.length=y,0===w){a.mode=16205;break}if(32&w){a.back=-1,a.mode=It;break}if(64&w){e.msg="invalid literal/length code",a.mode=Wt;break}a.extra=15&w,a.mode=16201;case 16201:if(a.extra){for(C=a.extra;c<C;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}a.length+=d&(1<<a.extra)-1,d>>>=a.extra,c-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;x=a.distcode[d&(1<<a.distbits)-1],p=x>>>24,w=x>>>16&255,y=65535&x,!(p<=c);){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}if(!(240&w)){for(b=p,_=w,v=y;x=a.distcode[v+((d&(1<<b+_)-1)>>b)],p=x>>>24,w=x>>>16&255,y=65535&x,!(b+p<=c);){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}d>>>=b,c-=b,a.back+=b}if(d>>>=p,c-=p,a.back+=p,64&w){e.msg="invalid distance code",a.mode=Wt;break}a.offset=y,a.extra=15&w,a.mode=16203;case 16203:if(a.extra){for(C=a.extra;c<C;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}a.offset+=d&(1<<a.extra)-1,d>>>=a.extra,c-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=Wt;break}a.mode=16204;case 16204:if(0===l)break e;if(g=u-l,a.offset>g){if(g=a.offset-g,g>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=Wt;break}g>a.wnext?(g-=a.wnext,m=a.wsize-g):m=a.wnext-g,g>a.length&&(g=a.length),f=a.window}else f=s,m=r-a.offset,g=a.length;g>l&&(g=l),l-=g,a.length-=g;do{s[r++]=f[m++]}while(--g);0===a.length&&(a.mode=Mt);break;case 16205:if(0===l)break e;s[r++]=a.length,l--,a.mode=Mt;break;case Bt:if(a.wrap){for(;c<32;){if(0===o)break e;o--,d|=n[i++]<<c,c+=8}if(u-=l,e.total_out+=u,a.total+=u,4&a.wrap&&u&&(e.adler=a.check=a.flags?$(a.check,s,u,r-u):F(a.check,s,u,r-u)),u=l,4&a.wrap&&(a.flags?d:Nt(d))!==a.check){e.msg="incorrect data check",a.mode=Wt;break}d=0,c=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;c<32;){if(0===o)break e;o--,d+=n[i++]<<c,c+=8}if(4&a.wrap&&d!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=Wt;break}d=0,c=0}a.mode=16208;case 16208:E=_t;break e;case Wt:E=Et;break e;case 16210:return xt;default:return kt}return e.next_out=r,e.avail_out=l,e.next_in=i,e.avail_in=o,a.hold=d,a.bits=c,(a.wsize||u!==e.avail_out&&a.mode<Wt&&(a.mode<Bt||t!==pt))&&qt(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,a.total+=u,4&a.wrap&&u&&(e.adler=a.check=a.flags?$(a.check,s,u,e.next_out-u):F(a.check,s,u,e.next_out-u)),e.data_type=a.bits+(a.last?64:0)+(a.mode===It?128:0)+(a.mode===At||a.mode===Tt?256:0),(0===h&&0===u||t===pt)&&E===bt&&(E=St),E},inflateEnd:e=>{if(Ft(e))return kt;let t=e.state;return t.window&&(t.window=null),e.state=null,bt},inflateGetHeader:(e,t)=>{if(Ft(e))return kt;const a=e.state;return 2&a.wrap?(a.head=t,t.done=!1,bt):kt},inflateSetDictionary:(e,t)=>{const a=t.length;let n,s,i;return Ft(e)?kt:(n=e.state,0!==n.wrap&&n.mode!==Lt?kt:n.mode===Lt&&(s=1,s=F(s,t,a,0),s!==n.check)?Et:(i=qt(e,t,a,a),i?(n.mode=16210,xt):(n.havedict=1,bt)))},inflateInfo:"pako inflate (from Nodeca project)"};var Kt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Yt=Object.prototype.toString,{Z_NO_FLUSH:Xt,Z_FINISH:Qt,Z_OK:Jt,Z_STREAM_END:ea,Z_NEED_DICT:ta,Z_STREAM_ERROR:aa,Z_DATA_ERROR:na,Z_MEM_ERROR:sa}=G;function ia(e){this.options=Ue({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new je,this.strm.avail_out=0;let a=jt.inflateInit2(this.strm,t.windowBits);if(a!==Jt)throw new Error(U[a]);if(this.header=new Kt,jt.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Ve(t.dictionary):"[object ArrayBuffer]"===Yt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(a=jt.inflateSetDictionary(this.strm,t.dictionary),a!==Jt)))throw new Error(U[a])}function ra(e,t){const a=new ia(t);if(a.push(e),a.err)throw a.msg||U[a.err];return a.result}ia.prototype.push=function(e,t){const a=this.strm,n=this.options.chunkSize,s=this.options.dictionary;let i,r,o;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Qt:Xt,"[object ArrayBuffer]"===Yt.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(n),a.next_out=0,a.avail_out=n),i=jt.inflate(a,r),i===ta&&s&&(i=jt.inflateSetDictionary(a,s),i===Jt?i=jt.inflate(a,r):i===na&&(i=ta));a.avail_in>0&&i===ea&&a.state.wrap>0&&0!==e[a.next_in];)jt.inflateReset(a),i=jt.inflate(a,r);switch(i){case aa:case na:case ta:case sa:return this.onEnd(i),this.ended=!0,!1}if(o=a.avail_out,a.next_out&&(0===a.avail_out||i===ea))if("string"===this.options.to){let e=qe(a.output,a.next_out),t=a.next_out-e,s=Pe(a.output,e);a.next_out=t,a.avail_out=n-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(s)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(i!==Jt||0!==o){if(i===ea)return i=jt.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},ia.prototype.onData=function(e){this.chunks.push(e)},ia.prototype.onEnd=function(e){e===Jt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ge(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var oa={Inflate:ia,inflate:ra,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ra(e,t)},ungzip:ra};const{Deflate:la,deflate:da,deflateRaw:ca,gzip:ha}=ot,{Inflate:ua,inflate:ga,inflateRaw:ma,ungzip:fa}=oa;var pa={Deflate:la,deflate:da,deflateRaw:ca,gzip:ha,Inflate:ua,inflate:ga,inflateRaw:ma,ungzip:fa,constants:G};class wa{constructor(e){this.SQL=e,this.db=null,this.metadata=null,this.loadedChunks=new Set,this.loadingProgress=0,this.totalBytes=0,this.loadedBytes=0,this.isInitialized=!1,this.listeners={progress:[],chunkLoaded:[],complete:[],error:[]},this.dbName="WordDiscovererCache",this.dbVersion=1,this.cacheDB=null}async initializeCache(){return new Promise((e,t)=>{const a=indexedDB.open(this.dbName,this.dbVersion);a.onerror=()=>{console.warn("Failed to open IndexedDB, continuing without cache"),e(null)},a.onsuccess=t=>{this.cacheDB=t.target.result,console.log("✅ IndexedDB cache initialized"),e(this.cacheDB)},a.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("chunks")||t.createObjectStore("chunks",{keyPath:"chunkNumber"}),t.objectStoreNames.contains("metadata")||t.createObjectStore("metadata",{keyPath:"key"})}})}async saveChunkToCache(e,t){if(this.cacheDB)return new Promise((a,n)=>{try{const n=this.cacheDB.transaction(["chunks"],"readwrite").objectStore("chunks");let s;if(t instanceof ArrayBuffer)s=new Uint8Array(t);else{if(!(t instanceof Uint8Array))throw new TypeError("Data must be ArrayBuffer or Uint8Array");s=t}const i=n.put({chunkNumber:e,data:s,timestamp:Date.now(),version:this.metadata.version});i.onsuccess=()=>{console.log(`💾 Cached chunk ${e}`),a()},i.onerror=t=>{console.warn(`Failed to cache chunk ${e}:`,t.target.error),a()}}catch(s){console.warn(`Error caching chunk ${e}:`,s),a()}})}async loadChunkFromCache(e){return this.cacheDB?new Promise((t,a)=>{try{const a=this.cacheDB.transaction(["chunks"],"readonly"),n=a.objectStore("chunks").get(e);n.onsuccess=a=>{const n=a.target.result;if(n&&n.data){if(n.version&&n.version!==this.metadata.version)return console.log(`⚠️ Cache version mismatch for chunk ${e}, re-downloading`),void t(null);let a;if(console.log(`📦 Loaded chunk ${e} from cache`),n.data instanceof Uint8Array)a=n.data.buffer;else{if(!(n.data instanceof ArrayBuffer))return console.warn(`Unexpected data type in cache for chunk ${e}, re-downloading`),void t(null);a=n.data}t(a)}else t(null)},n.onerror=a=>{console.warn(`Error loading chunk ${e} from cache:`,a.target.error),t(null)}}catch(n){console.warn(`Error accessing cache for chunk ${e}:`,n),t(null)}}):null}async saveMetadataToCache(e){if(this.cacheDB)return new Promise((t,a)=>{const n=this.cacheDB.transaction(["metadata"],"readwrite").objectStore("metadata").put({key:"metadata",data:e,timestamp:Date.now()});n.onsuccess=()=>t(),n.onerror=()=>t()})}async loadMetadataFromCache(){return this.cacheDB?new Promise((e,t)=>{const a=this.cacheDB.transaction(["metadata"],"readonly").objectStore("metadata").get("metadata");a.onsuccess=t=>{const a=t.target.result;a&&a.data?(console.log("✅ Loaded metadata from cache"),e(a.data)):e(null)},a.onerror=()=>e(null)}):null}async isChunkCached(e){return null!==await this.loadChunkFromCache(e)}async initialize(){try{console.log("🚀 Initializing Progressive Database Loader..."),await this.initializeCache();let e=await this.loadMetadataFromCache();if(!e){const t="/woaiios/db-chunks/metadata.json";console.log("📥 Fetching metadata...");const a=await fetch(t);if(!a.ok)throw new Error(`Failed to load metadata: ${a.status}`);e=await a.json(),await this.saveMetadataToCache(e)}return this.metadata=e,this.totalBytes=e.chunks.reduce((e,t)=>e+t.sizeBytes,0),console.log(`📊 Metadata loaded: ${e.totalChunks} chunks, ${e.totalWords.toLocaleString()} words`),this.db=new this.SQL.Database,this.db.exec("\n                CREATE TABLE words (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    word TEXT NOT NULL,\n                    phonetic TEXT,\n                    definition TEXT,\n                    translation TEXT,\n                    pos TEXT,\n                    collins INTEGER DEFAULT 0,\n                    oxford INTEGER DEFAULT 0,\n                    tag TEXT,\n                    bnc INTEGER DEFAULT 0,\n                    frq INTEGER DEFAULT 0,\n                    exchange TEXT,\n                    detail TEXT,\n                    audio TEXT\n                );\n                CREATE INDEX idx_word ON words(word);\n            "),this.isInitialized=!0,this.emit("progress",{loaded:0,total:this.totalBytes,percentage:0,message:"Initialized"}),!0}catch(e){return console.error("Error initializing progressive loader:",e),this.emit("error",e),!1}}async loadChunk(e){if(!this.isInitialized)throw new Error("Loader not initialized");if(this.loadedChunks.has(e))return console.log(`⚠️ Chunk ${e} already loaded`),!0;try{const t=this.metadata.chunks.find(t=>t.chunkNumber===e);if(!t)throw new Error(`Chunk ${e} not found in metadata`);let a=await this.loadChunkFromCache(e),n=!1;if(a)n=!0,console.log(`📦 Loading chunk ${e}/${this.metadata.totalChunks} from cache (${t.wordCount.toLocaleString()} words)...`),this.emit("progress",{loaded:this.loadedBytes,total:this.totalBytes,percentage:this.loadingProgress,message:`Loading from cache: chunk ${e}/${this.metadata.totalChunks}`,fromCache:!0}),e<=3&&await new Promise(e=>setTimeout(e,100));else{console.log(`📥 Downloading chunk ${e}/${this.metadata.totalChunks} (${t.wordCount.toLocaleString()} words)...`),this.emit("progress",{loaded:this.loadedBytes,total:this.totalBytes,percentage:this.loadingProgress,message:`Downloading: chunk ${e}/${this.metadata.totalChunks}`,fromCache:!1});const n=`/woaiios/db-chunks/${t.filename}`,s=await fetch(n);if(!s.ok)throw new Error(`Failed to load chunk ${e}: ${s.status}`);let i=await s.arrayBuffer();if("gzip"===s.headers.get("Content-Encoding")||i.byteLength>1.5*t.sizeBytes)a=i;else{const e=new Uint8Array(i);a=pa.ungzip(e).buffer}await this.saveChunkToCache(e,a)}const s=new this.SQL.Database(new Uint8Array(a)),i=s.exec("SELECT word, phonetic, definition, translation, pos, collins, oxford, tag, bnc, frq, exchange, detail, audio FROM words");if(i.length>0&&i[0].values.length>0){const e=this.db.prepare("\n                    INSERT INTO words (word, phonetic, definition, translation, pos, collins, oxford, tag, bnc, frq, exchange, detail, audio)\n                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n                ");for(const t of i[0].values)e.run(t);e.free()}s.close(),this.loadedChunks.add(e),this.loadedBytes+=t.sizeBytes,this.loadingProgress=this.loadedBytes/this.totalBytes*100;const r=n?"📦":"✅",o=n?"from cache":"downloaded";return console.log(`${r} Chunk ${e} loaded ${o} (${this.loadingProgress.toFixed(1)}% complete)`),this.emit("chunkLoaded",{chunkNumber:e,loaded:this.loadedChunks.size,total:this.metadata.totalChunks,percentage:this.loadingProgress,fromCache:n}),this.emit("progress",{loaded:this.loadedBytes,total:this.totalBytes,percentage:this.loadingProgress,message:`Loaded chunk ${e}/${this.metadata.totalChunks} ${n?"(cached)":""}`,fromCache:n}),!0}catch(t){return console.error(`Error loading chunk ${e}:`,t),console.error("Error stack:",t.stack),console.error("Error details:",{message:t.message,name:t.name,chunkNumber:e}),this.emit("error",t),!1}}async loadAllChunks(){this.isInitialized||await this.initialize(),console.log("📚 Starting progressive database loading...");for(let e=1;e<=this.metadata.totalChunks;e++)await this.loadChunk(e);return console.log("✨ All chunks loaded successfully!"),this.emit("complete",{totalChunks:this.metadata.totalChunks,totalWords:this.metadata.totalWords}),!0}async loadPriorityChunks(e=3){this.isInitialized||await this.initialize(),console.log(`📚 Loading ${e} priority chunks...`);for(let t=1;t<=Math.min(e,this.metadata.totalChunks);t++)await this.loadChunk(t);return e<this.metadata.totalChunks&&this.loadRemainingChunksInBackground(e+1),!0}async loadRemainingChunksInBackground(e){console.log(`🔄 Loading remaining chunks in background starting from ${e}...`);for(let t=e;t<=this.metadata.totalChunks;t++)await this.loadChunk(t),await new Promise(e=>setTimeout(e,100));console.log("✨ All chunks loaded successfully!"),this.emit("complete",{totalChunks:this.metadata.totalChunks,totalWords:this.metadata.totalWords})}getDatabase(){return this.db}isReady(){return this.isInitialized&&this.loadedChunks.size>0}getProgress(){return{percentage:this.loadingProgress,loadedChunks:this.loadedChunks.size,totalChunks:this.metadata?this.metadata.totalChunks:0,loadedBytes:this.loadedBytes,totalBytes:this.totalBytes}}on(e,t){this.listeners[e]&&this.listeners[e].push(t)}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>e(t))}close(){this.db&&(this.db.close(),this.db=null),this.cacheDB&&(this.cacheDB.close(),this.cacheDB=null)}}class ya{constructor(){this.dbName="WordDiscovererDirectDB",this.dbVersion=1,this.db=null,this.isInitialized=!1,this.memoryCache=new Map,this.maxCacheSize=1e4,this.stats={cacheHits:0,cacheMisses:0,totalQueries:0}}async initialize(){return new Promise((e,t)=>{const a=indexedDB.open(this.dbName,this.dbVersion);a.onerror=()=>{console.error("Failed to open DirectDataStorage IndexedDB"),t(new Error("Failed to initialize DirectDataStorage"))},a.onsuccess=t=>{this.db=t.target.result,this.isInitialized=!0,console.log("✅ DirectDataStorage initialized"),e(this.db)},a.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("words")){t.createObjectStore("words",{keyPath:"word"}).createIndex("word_lower","word_lower",{unique:!1})}t.objectStoreNames.contains("metadata")||t.createObjectStore("metadata",{keyPath:"key"}),console.log("✅ DirectDataStorage schema created")}})}async importFromDatabase(e,t=null){this.isInitialized||await this.initialize(),console.log("🔄 Starting data import to DirectDataStorage...");const a=Date.now();try{const n=await this.getMetadata("importComplete");if(n&&!0===n.value)return console.log("✅ Data already imported, skipping"),!0;const s=e.exec("\n                SELECT word, phonetic, definition, translation, pos, collins, oxford, \n                       tag, bnc, frq, exchange, detail, audio \n                FROM words\n            ");if(0===s.length||0===s[0].values.length)throw new Error("No data found in SQL database");const i=s[0].values,r=i.length;console.log(`📊 Importing ${r.toLocaleString()} words...`);const o=1e3;let l=0;for(let e=0;e<i.length;e+=o){const a=i.slice(e,e+o),n=this.db.transaction(["words"],"readwrite"),s=n.objectStore("words");for(const e of a){const t={word:e[0],word_lower:e[0].toLowerCase(),phonetic:e[1]||"",definition:e[2]||"",translation:e[3]||"",pos:e[4]||"",collins:parseInt(e[5])||0,oxford:"1"===e[6]||1===e[6],tag:e[7]||"",bnc:parseInt(e[8])||0,frq:parseInt(e[9])||0,exchange:e[10]||"",detail:e[11]||"",audio:e[12]||""};s.put(t)}await new Promise((e,t)=>{n.oncomplete=e,n.onerror=()=>t(n.error)}),l+=a.length,t&&t({imported:l,total:r,percentage:l/r*100}),l%1e4!=0&&l!==r||console.log(`📥 Imported ${l.toLocaleString()}/${r.toLocaleString()} words (${(l/r*100).toFixed(1)}%)`)}await this.setMetadata("importComplete",!0),await this.setMetadata("importDate",(new Date).toISOString()),await this.setMetadata("totalWords",r);const d=Date.now()-a;return console.log(`✅ Import completed in ${(d/1e3).toFixed(2)}s`),console.log(`📊 Total words imported: ${l.toLocaleString()}`),!0}catch(n){throw console.error("❌ Error importing data:",n),n}}async queryWord(e){if(!this.isInitialized)return null;this.stats.totalQueries++;const t=e.toLowerCase();return this.memoryCache.has(t)?(this.stats.cacheHits++,this.memoryCache.get(t)):(this.stats.cacheMisses++,new Promise((a,n)=>{try{const n=this.db.transaction(["words"],"readonly").objectStore("words"),s=n.index("word_lower").get(t);s.onsuccess=e=>{const n=e.target.result;n&&this.addToCache(t,n),a(n||null)},s.onerror=()=>{console.error("Error querying word:",e),a(null)}}catch(s){console.error("Error in queryWord:",s),a(null)}}))}async queryWordsBatch(e){if(!this.isInitialized)return[];const t=[...new Set(e.map(e=>e.toLowerCase()))],a=[],n=[];for(const s of t)this.memoryCache.has(s)?(this.stats.cacheHits++,a.push({word:s,data:this.memoryCache.get(s)})):n.push(s);if(n.length>0){this.stats.cacheMisses+=n.length;const e=this.db.transaction(["words"],"readonly").objectStore("words").index("word_lower"),t=n.map(t=>new Promise(a=>{const n=e.get(t);n.onsuccess=e=>{const n=e.target.result;n?(this.addToCache(t,n),a({word:t,data:n})):a({word:t,data:null})},n.onerror=()=>a({word:t,data:null})})),s=await Promise.all(t);a.push(...s)}return a}addToCache(e,t){if(this.memoryCache.size>=this.maxCacheSize){const e=this.memoryCache.keys().next().value;this.memoryCache.delete(e)}this.memoryCache.set(e,t)}clearCache(){this.memoryCache.clear(),this.stats={cacheHits:0,cacheMisses:0,totalQueries:0}}getCacheStats(){return{...this.stats,cacheSize:this.memoryCache.size,hitRate:this.stats.totalQueries>0?(this.stats.cacheHits/this.stats.totalQueries*100).toFixed(2)+"%":"0%"}}async setMetadata(e,t){return new Promise((a,n)=>{const s=this.db.transaction(["metadata"],"readwrite").objectStore("metadata").put({key:e,value:t});s.onsuccess=()=>a(),s.onerror=()=>n(s.error)})}async getMetadata(e){return new Promise((t,a)=>{const n=this.db.transaction(["metadata"],"readonly").objectStore("metadata").get(e);n.onsuccess=e=>t(e.target.result),n.onerror=()=>t(null)})}async isDataImported(){const e=await this.getMetadata("importComplete");return e&&!0===e.value}async clearData(){return new Promise((e,t)=>{const a=this.db.transaction(["words","metadata"],"readwrite");a.objectStore("words").clear(),a.objectStore("metadata").clear(),a.oncomplete=()=>{this.clearCache(),console.log("✅ DirectDataStorage cleared"),e()},a.onerror=()=>t(a.error)})}close(){this.db&&(this.db.close(),this.db=null,this.isInitialized=!1),this.clearCache()}}class ba{constructor(){this.db=null,this.isLoaded=!1,this.queryCache=new Map,this.SQL=null,this.progressiveLoader=null,this.progressCallback=null,this.directStorage=null,this.useDirectStorage=!0}setProgressCallback(e){this.progressCallback=e}async initialize(){try{if(this.useDirectStorage){console.log("🚀 Initializing DirectDataStorage for optimized lookups..."),this.directStorage=new ya,await this.directStorage.initialize();if(await this.directStorage.isDataImported())return console.log("✅ DirectDataStorage ready with pre-imported data"),this.isLoaded=!0,!0;console.log("⚠️ Data not yet imported to DirectDataStorage, will import after loading SQL database")}let t;console.log("Initializing sql.js...");t=(await function(t,a){let n=Promise.resolve();if(a&&a.length>0){let t=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),i=s?.nonce||s?.getAttribute("nonce");n=t(a.map(t=>{if((t=function(e){return"/woaiios/"+e}(t))in e)return;e[t]=!0;const a=t.endsWith(".css"),n=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${n}`))return;const s=document.createElement("link");return s.rel=a?"stylesheet":"modulepreload",a||(s.as="script"),s.crossOrigin="",s.href=t,i&&s.setAttribute("nonce",i),document.head.appendChild(s),a?new Promise((e,a)=>{s.addEventListener("load",e),s.addEventListener("error",()=>a(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(e=>{for(const t of e||[])"rejected"===t.status&&s(t.reason);return t().catch(s)})}(()=>import("./sql-wasm-DAuD2IuQ.js").then(e=>e.s),[])).default;this.SQL=await t({locateFile:e=>`/woaiios/assets/${e}`}),console.log("🚀 Using progressive database loading..."),this.progressiveLoader=new wa(this.SQL),this.progressiveLoader.on("progress",e=>{this.progressCallback&&this.progressCallback(e)}),this.progressiveLoader.on("chunkLoaded",e=>{console.log(`✅ Chunk ${e.chunkNumber} loaded (${e.percentage.toFixed(1)}% complete)`)}),this.progressiveLoader.on("complete",async e=>{if(console.log(`✨ All database chunks loaded! Total: ${e.totalWords.toLocaleString()} words`),this.useDirectStorage&&this.directStorage){if(!(await this.directStorage.isDataImported())){console.log("🔄 Starting one-time import to DirectDataStorage for future performance...");try{await this.directStorage.importFromDatabase(this.db,e=>{console.log(`📥 Import progress: ${e.percentage.toFixed(1)}%`)}),console.log("✅ Import to DirectDataStorage completed!")}catch(t){console.warn("⚠️ Failed to import to DirectDataStorage, will continue with SQL:",t)}}}}),this.progressiveLoader.on("error",e=>{console.error("Progressive loader error:",e)}),await this.progressiveLoader.initialize(),await this.progressiveLoader.loadPriorityChunks(3),this.db=this.progressiveLoader.getDatabase();const a=this.db.exec("SELECT COUNT(*) as count FROM words LIMIT 1");if(a.length>0){const e=a[0].values[0][0];console.log(`ECDICT database ready with ${e.toLocaleString()} words (loading more in background...)`)}return this.isLoaded=!0,!0}catch(t){return console.error("Error loading ECDICT database:",t),this.isLoaded=!1,!1}}queryWord(e){if(this.useDirectStorage&&this.directStorage&&this.directStorage.isInitialized)return this.directStorage.queryWord(e);if(!this.isLoaded||!this.db)return null;const t=e.toLowerCase();if(this.queryCache.has(t))return this.queryCache.get(t);try{const e=this.db.exec("SELECT word, phonetic, definition, translation, pos, collins, oxford, tag, bnc, frq, exchange, detail \n                 FROM words \n                 WHERE LOWER(word) = ?\n                 LIMIT 1",[t]);if(e.length>0&&e[0].values.length>0){const a=e[0].values[0],n={word:a[0],phonetic:a[1]||"",definition:a[2]||"",translation:a[3]||"",pos:a[4]||"",collins:parseInt(a[5])||0,oxford:"1"===a[6]||1===a[6],tag:a[7]||"",bnc:parseInt(a[8])||0,frq:parseInt(a[9])||0,exchange:a[10]||"",detail:a[11]||""};if(this.queryCache.set(t,n),this.queryCache.size>1e4){const e=this.queryCache.keys().next().value;this.queryCache.delete(e)}return n}return null}catch(a){return console.error("Error querying word:",e,a),null}}async queryWordsBatch(e){if(this.useDirectStorage&&this.directStorage&&this.directStorage.isInitialized){return(await this.directStorage.queryWordsBatch(e)).map(e=>e.data)}if(!this.isLoaded||!this.db)return[];const t=[...new Set(e.map(e=>e.toLowerCase()))],a=[];for(const n of t){const e=this.queryWord(n);e&&(e instanceof Promise?a.push(await e):a.push(e))}return a}parseExchange(e){const t={p:null,d:null,i:null,3:null,r:null,t:null,s:null,0:null,1:null};if(!e)return t;const a=e.split("/");for(const n of a){const[e,a]=n.split(":");e&&a&&(t[e]=a)}return t}async getWordDifficulty(e){let t=await this.queryWord(e);if(t||(t=await this.findByLemma(e)),!t)return{level:"common",score:0,className:"common",info:null};let a="expert",n=100;const s=t.tag||"";let i=!1;if(1===t.oxford?(a="common",n=0,i=!0):t.collins>=5?(a="common",n=10,i=!0):t.collins>=4||s.includes("zk")||s.includes("gk")||s.includes("cet4")?(a="beginner",n=25,i=!0):t.collins>=3||s.includes("cet6")?(a="intermediate",n=50,i=!0):t.collins>=1||s.includes("ielts")||s.includes("toefl")?(a="advanced",n=75,i=!0):t.bnc>0&&t.bnc<2e4?(a="common",n=15,i=!0):t.bnc>0&&t.bnc<5e4?(a="beginner",n=30,i=!0):t.bnc>0&&t.bnc<1e5&&(a="intermediate",n=55,i=!0),!i&&t.exchange){const a=this.parseExchange(t.exchange),n=a[0]||a[1];if(n&&n.toLowerCase()!==e.toLowerCase()){if(await this.queryWord(n)){return await this.getWordDifficulty(n)}}}return{level:a,score:n,className:a,info:t}}async findByLemma(e){if(!this.isLoaded||!this.db)return null;try{const t=this.db.exec("SELECT word, exchange \n                 FROM words \n                 WHERE exchange LIKE ? \n                 LIMIT 10",[`%${e}%`]);if(t.length>0&&t[0].values.length>0)for(const a of t[0].values){const t=a[0],n=a[1],s=this.parseExchange(n);for(const a of Object.values(s))if(a&&a.toLowerCase()===e.toLowerCase())return await this.queryWord(t)}return null}catch(t){return console.error("Error finding lemma:",t),null}}fuzzyMatch(e,t=10){if(!this.isLoaded||!this.db)return[];try{const a=e.toLowerCase(),n=this.db.exec("SELECT word, phonetic, translation \n                 FROM words \n                 WHERE LOWER(word) LIKE ? \n                 LIMIT ?",[`${a}%`,t]);return n.length>0&&n[0].values.length>0?n[0].values.map(e=>({word:e[0],phonetic:e[1]||"",translation:e[2]||""})):[]}catch(a){return console.error("Error fuzzy matching:",a),[]}}isDatabaseLoaded(){return this.isLoaded}close(){this.db&&(this.db.close(),this.db=null,this.isLoaded=!1)}}class _a{constructor(e,t){this.wordDatabase=e,this.translationService=t,this.tokenizer=null,this.translationCache=new Map,this.maxCacheSize=5e3,this.LEMMA_KEY="0",this.LEMMA_VARIATION_KEY="1",this.EXPERT_DIFFICULTY={level:"expert",score:100,className:"expert"},this.loadTokenizer()}async loadTokenizer(){try{if(!Intl.Segmenter)throw new Error("Intl.Segmenter not supported in this browser");this.tokenizer=new Intl.Segmenter(void 0,{granularity:"word"}),console.log("Intl.Segmenter loaded successfully")}catch(e){console.warn("Error loading Intl.Segmenter, falling back to simple extraction:",e),this.tokenizer={tokenize:e=>e.split(/\s+/).map(e=>({value:e,tag:"word"}))}}}parseExchange(e){const t={p:null,d:null,i:null,3:null,r:null,t:null,s:null,[this.LEMMA_KEY]:null,[this.LEMMA_VARIATION_KEY]:null};if(!e)return t;const a=e.split("/");for(const n of a){const[e,a]=n.split(":");e&&a&&(t[e]=a)}return t}hasMetadata(e){if(!e)return!1;const t=e.tag||"";return 1===e.oxford||!0===e.oxford||e.collins>0||e.bnc>0||t.includes("zk")||t.includes("gk")||t.includes("cet4")||t.includes("cet6")||t.includes("ielts")||t.includes("toefl")||t.includes("gre")}extractWords(e){if(this.tokenizer&&this.tokenizer.segment){const t=this.tokenizer.segment(e);return Array.from(t).filter(e=>e.isWordLike).map(e=>e.segment).filter(e=>e.length>1).filter(e=>/^[a-zA-Z]+$/.test(e))}return e.split(/\s+/).filter(e=>e.length>1).filter(e=>/^[a-zA-Z]+$/.test(e))}async analyzeWords(e,t,a,n){const s={totalWords:e.length,highlightedWords:[],newWords:[],difficultyScore:0,wordFrequency:{}},{learning:i,mastered:r}=n;e.forEach(e=>{const t=e.toLowerCase();s.wordFrequency[t]=(s.wordFrequency[t]||0)+1});const o=[...new Set(e.map(e=>e.toLowerCase()))],l=performance.now(),d=new Map;if(this.wordDatabase.useDirectStorage&&this.wordDatabase.directStorage&&this.wordDatabase.directStorage.isInitialized){(await this.wordDatabase.directStorage.queryWordsBatch(o)).forEach(e=>{e.data&&d.set(e.word,e.data)})}else for(const u of o){const e=await this.wordDatabase.queryWord(u);e&&d.set(u,e)}const c=new Set;for(const u of o){const e=d.get(u);if(e&&!this.hasMetadata(e)&&e.exchange){const t=this.parseExchange(e.exchange),a=t[this.LEMMA_KEY]||t[this.LEMMA_VARIATION_KEY];if(a&&a.toLowerCase()!==u){const e=a.toLowerCase();d.has(e)||c.add(e)}}}if(c.size>0){const e=Array.from(c);if(this.wordDatabase.useDirectStorage&&this.wordDatabase.directStorage&&this.wordDatabase.directStorage.isInitialized){(await this.wordDatabase.directStorage.queryWordsBatch(e)).forEach(e=>{e.data&&d.set(e.word,e.data)})}else for(const t of e){const e=await this.wordDatabase.queryWord(t);e&&d.set(t,e)}}for(const u of o){const n=e.find(e=>e.toLowerCase()===u)||u;let o=d.get(u),l=o;if(o&&!this.hasMetadata(o)&&o.exchange){const e=this.parseExchange(o.exchange),t=e[this.LEMMA_KEY]||e[this.LEMMA_VARIATION_KEY];if(t&&t.toLowerCase()!==u){const e=d.get(t.toLowerCase());e&&this.hasMetadata(e)&&(l=e)}}let c=this.calculateDifficultyFromData(l,u);const h=r.has(u),g=i.has(u);g&&(c={...this.EXPERT_DIFFICULTY,info:c.info});!h&&(g||this.shouldHighlight(u,c,a,i,t))&&(s.highlightedWords.push({word:n,difficulty:c,frequency:s.wordFrequency[u],translation:this.formatTranslationFromData(n,o)}),i.has(u)||s.newWords.push(u)),s.difficultyScore+=c.score}const h=performance.now();return console.log(`📊 Analyzed ${o.length} unique words in ${(h-l).toFixed(2)}ms`),s.difficultyScore=o.length>0?Math.round(s.difficultyScore/o.length):0,s}calculateDifficultyFromData(e,t){if(!e)return{level:"common",score:0,className:"common",info:null};let a="expert",n=100;const s=e.tag||"";return 1===e.oxford||!0===e.oxford?(a="common",n=0):e.collins>=5?(a="common",n=10):e.collins>=4||s.includes("zk")||s.includes("gk")||s.includes("cet4")?(a="beginner",n=25):e.collins>=3||s.includes("cet6")?(a="intermediate",n=50):e.collins>=1||s.includes("ielts")||s.includes("toefl")?(a="advanced",n=75):e.bnc>0&&e.bnc<2e4?(a="common",n=15):e.bnc>0&&e.bnc<5e4?(a="beginner",n=30):e.bnc>0&&e.bnc<1e5&&(a="intermediate",n=55),{level:a,score:n,className:a,info:e}}formatTranslationFromData(e,t){if(!t)return`<div class="word-info">\n                <h3>${e}</h3>\n                <p class="no-translation">未找到释义</p>\n            </div>`;let a='<div class="word-info ecdict-entry compact">';if(a+=`<h3 class="word-title">${t.word}</h3>`,t.phonetic&&(a+=`<div class="phonetic-line">/${t.phonetic}/</div>`),t.translation){a+='<div class="translation-compact">';const e=t.translation.split("\\n"),n=e[0]?this.escapeHtml(e[0].trim()):"";n&&(a+=`<p>${n}</p>`),a+="</div>"}return a+='<div class="word-details-toggle" onclick="this.parentElement.classList.toggle(\'expanded\')">',a+='<span class="toggle-icon">▼</span> <span class="toggle-text">更多详情</span>',a+="</div>",a+='<div class="word-details-content">',(t.collins>0||t.oxford)&&(a+='<div class="word-meta">',t.collins>0&&(a+=`<span class="collins-stars">${"★".repeat(t.collins)}</span>`),t.oxford&&(a+='<span class="oxford-badge">Oxford 3000</span>'),a+="</div>"),a+="</div>",a+="</div>",a}shouldHighlight(e,t,a,n,s){const i={common:0,beginner:1,intermediate:2,advanced:3,expert:4,unknown:5},r=i[t.level]>i[s];switch(a){case"unknown":return r&&!n.has(e);case"difficult":return r;case"all":return!0;default:return!1}}async getTranslation(e){const t=e.toLowerCase();if(this.translationCache.has(t))return this.translationCache.get(t);if(!this.wordDatabase.isDatabaseLoaded())return'<div class="word-info"><p>数据库未加载</p></div>';let a,n=await this.wordDatabase.queryWord(t);if(n||(n=await this.wordDatabase.findByLemma(t)),n){if(a='<div class="word-info ecdict-entry compact">',a+=`<h3 class="word-title">${n.word}</h3>`,n.phonetic&&(a+=`<div class="phonetic-line">/${n.phonetic}/</div>`),n.translation){a+='<div class="translation-compact">';const e=n.translation.split("\\n"),t=e[0]?this.escapeHtml(e[0].trim()):"";t&&(a+=`<p>${t}</p>`),a+="</div>"}if(a+='<div class="word-details-toggle" onclick="this.parentElement.classList.toggle(\'expanded\')">',a+='<span class="toggle-icon">▼</span> <span class="toggle-text">更多详情</span>',a+="</div>",a+='<div class="word-details-content">',(n.collins>0||n.oxford)&&(a+='<div class="word-meta">',n.collins>0&&(a+=`<span class="collins-stars">${"★".repeat(n.collins)}</span>`),n.oxford&&(a+='<span class="oxford-badge">Oxford 3000</span>'),a+="</div>"),n.tag){const e=n.tag.split(" ").filter(e=>e);if(e.length>0){a+='<div class="word-tags">';const t={zk:"中考",gk:"高考",cet4:"CET-4",cet6:"CET-6",ielts:"IELTS",toefl:"TOEFL",gre:"GRE",tem4:"TEM-4",tem8:"TEM-8"};e.forEach(e=>{const n=t[e]||e;a+=`<span class="tag">${n}</span>`}),a+="</div>"}}if(n.translation){const e=n.translation.split("\\n");e.length>1&&(a+='<div class="translation">',e.forEach((e,t)=>{e.trim()&&t>0&&(a+=`<p>${this.escapeHtml(e)}</p>`)}),a+="</div>")}if(n.definition){a+='<div class="definition">',a+="<h4>English Definition:</h4>";n.definition.split("\\n").forEach(e=>{e.trim()&&(a+=`<p>${this.escapeHtml(e)}</p>`)}),a+="</div>"}if(n.exchange){const e=this.wordDatabase.parseExchange(n.exchange),t={p:"过去式",d:"过去分词",i:"现在分词",3:"第三人称单数",r:"比较级",t:"最高级",s:"复数",0:"原形"},s=[];for(const[a,n]of Object.entries(e))n&&t[a]&&s.push(`${t[a]}: ${n}`);s.length>0&&(a+='<div class="word-forms">',a+="<h4>词形变化:</h4>",a+=`<p>${s.join(" | ")}</p>`,a+="</div>")}(n.bnc>0||n.frq>0)&&(a+='<div class="word-frequency">',n.bnc>0&&(a+=`<span>BNC词频: ${n.bnc.toLocaleString()}</span>`),n.frq>0&&(a+=`<span>当代词频: ${n.frq.toLocaleString()}</span>`),a+="</div>"),a+="</div>",a+="</div>"}else a=`<div class="word-info">\n                <h3>${e}</h3>\n                <p class="no-translation">未找到释义</p>\n            </div>`;if(this.translationCache.set(t,a),this.translationCache.size>this.maxCacheSize){const e=this.translationCache.keys().next().value;this.translationCache.delete(e)}return a}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async processTextForDisplay(e,t){const a=new Map(t.highlightedWords.map(e=>[e.word.toLowerCase(),e])),n=e.split(/(\b[a-zA-Z-]+\b)/),s=[...new Set(n.filter(e=>/\b[a-zA-Z-]+\b/.test(e)))],i=new Map;for(const o of t.highlightedWords)o.translation&&i.set(o.word.toLowerCase(),o.translation);const r=s.filter(e=>!i.has(e.toLowerCase()));if(r.length>0){const e=await Promise.all(r.map(e=>this.getTranslation(e)));r.forEach((t,a)=>{i.set(t.toLowerCase(),e[a])})}return n.map(e=>{const t=e.toLowerCase();if(!/\b[a-zA-Z-]+\b/.test(t))return e;const n=a.get(t),s=i.get(t)||"";let r="word-span";n&&(r+=` highlighted-word ${n.difficulty.className}`);return`<span class="${r}" data-word="${e}" data-translation="${s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}">${e}</span>`}).join("")}calculateComplexityMetrics(e,t){const a=[...new Set(e)],n={totalWords:e.length,uniqueWords:a.length,averageWordLength:0,difficultyDistribution:{common:0,beginner:0,intermediate:0,advanced:0,expert:0}},s=e.reduce((e,t)=>e+t.length,0);return n.averageWordLength=Math.round(s/e.length*10)/10,a.forEach(e=>{const a=this.wordDatabase.getWordDifficulty(e,t);n.difficultyDistribution[a.level]++}),n}clearTranslationCache(){this.translationCache.clear(),console.log("🗑️ Translation cache cleared")}getCacheStats(){return{size:this.translationCache.size,maxSize:this.maxCacheSize,utilization:`${(this.translationCache.size/this.maxCacheSize*100).toFixed(1)}%`}}}class va{constructor(){this.clientId="781460731280-7moak9c5fq75dubjlnmes4b4gdku3qvt.apps.googleusercontent.com",this.scopes="https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email",this.isInitialized=!1,this.isSignedIn=!1,this.accessToken=null,this.fileId=null,this.gapiLoaded=!1}async initialize(){try{return await this._waitForGoogleIdentityServices(),await this._loadGoogleAPIClient(),this.isInitialized=!0,console.log("Google Drive API initialized successfully"),!0}catch(e){return console.error("Error initializing Google Drive API:",e),!1}}async signIn(e=!1){try{this.isInitialized||await this.initialize();const t=await this._getToken(e);return this.accessToken=t.access_token,this.isSignedIn=!0,await this._initializeGoogleAPIClient(),await this.findOrCreateVocabularyFile(),console.log("Successfully signed in to Google"),!0}catch(t){return console.error("Error signing in:",t),this.isSignedIn=!1,!1}}async signOut(){try{return this.accessToken&&window.google.accounts.oauth2.revoke(this.accessToken),this.isSignedIn=!1,this.accessToken=null,this.fileId=null,console.log("Successfully signed out from Google"),!0}catch(e){return console.error("Error signing out:",e),!1}}async findOrCreateVocabularyFile(){try{let e=await this._findFileInSpace("drive");return e?(this.fileId=e.id,console.log("Found existing vocabulary file in drive:",this.fileId),this.fileId):(e=await this._findFileInSpace("appDataFolder"),e?(this.fileId=e.id,console.warn("Found vocabulary file in hidden appDataFolder."),this.fileId):(this.fileId=await this._createFile(),console.log("Created new vocabulary file in root directory:",this.fileId),this.fileId))}catch(e){return console.error("Error finding/creating vocabulary file:",e),null}}async uploadVocabulary(e){try{if(!this.isSignedIn||!this.fileId)throw new Error("Not signed in or file not found");const t=JSON.stringify(e,null,2);return await gapi.client.request({path:`/upload/drive/v3/files/${this.fileId}`,method:"PATCH",params:{uploadType:"media"},headers:{"Content-Type":"application/json"},body:t}),console.log("Vocabulary uploaded successfully to Google Drive"),!0}catch(t){return console.error("Error uploading vocabulary:",t),403===t.status&&(console.log("Attempting to refresh access token..."),await this.refreshAccessToken(),this.uploadVocabulary(e))}}async downloadVocabulary(){if(!this.isSignedIn||!this.fileId)throw new Error("Not signed in or file not found");try{const e=await gapi.client.drive.files.get({fileId:this.fileId,alt:"media"});return e.body?(console.log("Vocabulary downloaded successfully from Google Drive"),JSON.parse(e.body)):null}catch(e){return console.error("Error downloading vocabulary:",e),null}}async syncVocabulary(e){if(!this.isSignedIn)return{success:!1,error:"Not signed in to Google"};try{const t=await this.downloadVocabulary();if(!t||!t.version){console.log("No remote data or old format found. Uploading local data.");return{success:await this.uploadVocabulary(e),action:"upload",data:e}}const a=this._mergeVocabularies(e,t);return await this.uploadVocabulary(a)?{success:!0,action:"merge",data:a}:{success:!1,action:"merge_fail",data:e,error:"Failed to upload merged vocabulary"}}catch(t){return console.error("Error syncing vocabulary:",t),{success:!1,error:t.message}}}getAuthStatus(){return{isInitialized:this.isInitialized,isSignedIn:this.isSignedIn,hasFile:!!this.fileId}}async getUserInfo(){if(!this.isSignedIn)return null;try{const e=(await gapi.client.people.people.get({resourceName:"people/me",personFields:"names,emailAddresses,photos"})).result;return{name:e.names&&e.names[0]?e.names[0].displayName:"Google User",email:e.emailAddresses&&e.emailAddresses[0]?e.emailAddresses[0].value:"",imageUrl:e.photos&&e.photos[0]?e.photos[0].url:null}}catch(e){return console.error("Error getting user info:",e),null}}_getToken(e=!1){return new Promise((t,a)=>{window.google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:this.scopes,callback:e=>e.error?a(new Error(e.error_description)):t(e)}).requestAccessToken({prompt:e?"none":""})})}async refreshAccessToken(){try{const e=await this._getToken(!0);return this.accessToken=e.access_token,gapi.client.setToken({access_token:this.accessToken}),console.log("Access token refreshed successfully"),!0}catch(e){return console.error("Token refresh error:",e),this.isSignedIn=!1,!1}}_waitForGoogleIdentityServices(){return new Promise((e,t)=>{if(window.google&&window.google.accounts)return e();const a=setTimeout(()=>t(new Error("Google Identity Services failed to load")),1e4),n=setInterval(()=>{window.google&&window.google.accounts&&(clearTimeout(a),clearInterval(n),e())},100)})}_loadGoogleAPIClient(){return new Promise((e,t)=>{if(window.gapi&&window.gapi.client)return e();const a=document.createElement("script");a.src="https://apis.google.com/js/api.js",a.onload=()=>gapi.load("client",e),a.onerror=t,document.head.appendChild(a)})}async _initializeGoogleAPIClient(){await gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest","https://people.googleapis.com/$discovery/rest?version=v1"]}),gapi.client.setToken({access_token:this.accessToken})}async _findFileInSpace(e){const t=await gapi.client.drive.files.list({q:"name='WordDiscoverer_Vocabulary.json' and trashed=false",spaces:e,fields:"files(id, name)"});return t.result.files&&t.result.files.length>0?t.result.files[0]:null}async _createFile(){return(await gapi.client.drive.files.create({resource:{name:"WordDiscoverer_Vocabulary.json",parents:["root"]},fields:"id"})).result.id}_mergeVocabularies(e,t){console.log("Performing two-way merge for vocabulary v2.0");const a=new Map(e.learningWords||[]),n=new Map(e.masteredWords||[]),s=new Map(t.learningWords||t.vocabulary||[]),i=new Map(t.masteredWords||[]),r=new Map([...s,...a]),o=new Map([...i,...n]);for(const l of n.keys())r.has(l)&&r.delete(l);for(const l of a.keys())o.has(l)&&o.delete(l);return{version:"2.0",exportDate:(new Date).toISOString(),learningWords:Array.from(r.entries()),masteredWords:Array.from(o.entries())}}}class ka{constructor(){const{learningWords:e,masteredWords:t}=this.loadVocabulary();this.learningWords=e,this.masteredWords=t,this.googleDriveManager=new va,this.syncEnabled=!1,this.lastSyncTime=null,this.isSyncing=!1}addWord(e,t){return!this.isKnownWord(e)&&(this.learningWords.set(e,{translation:t,addedDate:(new Date).toISOString(),reviewCount:0,lastReviewed:null}),this.saveVocabulary(),!0)}masterWord(e,t){const a=e.toLowerCase();if(this.masteredWords.has(a))return"already_mastered";let n;return this.learningWords.has(a)?(n=this.learningWords.get(a),this.learningWords.delete(a),this.masteredWords.set(a,n),this.saveVocabulary(),"moved_to_mastered"):(n={translation:t,addedDate:(new Date).toISOString(),reviewCount:0,lastReviewed:null},this.masteredWords.set(a,n),this.saveVocabulary(),"added_to_mastered")}unmasterWord(e){const t=e.toLowerCase();if(this.masteredWords.has(t)){const e=this.masteredWords.get(t);return this.masteredWords.delete(t),this.learningWords.set(t,e),this.saveVocabulary(),"moved_to_learning"}return!1}removeWord(e){return this.learningWords.has(e)?(this.learningWords.delete(e),this.saveVocabulary(),!0):!!this.masteredWords.has(e)&&(this.masteredWords.delete(e),this.saveVocabulary(),!0)}isKnownWord(e){return this.learningWords.has(e)||this.masteredWords.has(e)}isMasteredWord(e){return this.masteredWords.has(e)}getWordData(e){return this.learningWords.get(e)||this.masteredWords.get(e)||null}getLearningWords(){return Array.from(this.learningWords.entries())}getMasteredWords(){return Array.from(this.masteredWords.entries())}getLearningSize(){return this.learningWords.size}getTotalSize(){return this.learningWords.size+this.masteredWords.size}clearVocabulary(){return this.learningWords.clear(),this.masteredWords.clear(),this.saveVocabulary(),!0}getSortedByDate(e){return Array.from(e.entries()).sort((e,t)=>new Date(t[1].addedDate)-new Date(e[1].addedDate))}updateReviewCount(e){const t=this.learningWords.get(e);return!!t&&(t.reviewCount++,t.lastReviewed=(new Date).toISOString(),this.saveVocabulary(),!0)}exportVocabulary(){return{version:"2.0",exportDate:(new Date).toISOString(),learningWords:Array.from(this.learningWords.entries()),masteredWords:Array.from(this.masteredWords.entries())}}importVocabulary(e){try{if("2.0"===e.version&&e.learningWords)this.learningWords=new Map(e.learningWords||[]),this.masteredWords=new Map(e.masteredWords||[]);else{if(!e.vocabulary||!Array.isArray(e.vocabulary))return!1;this.learningWords=new Map(e.vocabulary),this.masteredWords=new Map}return this.saveVocabulary(),!0}catch(t){return console.error("Error importing vocabulary:",t),!1}}getStatistics(){const e=[...Array.from(this.learningWords.values()),...Array.from(this.masteredWords.values())].reduce((e,t)=>e+t.reviewCount,0);return{learningWords:this.learningWords.size,masteredWords:this.masteredWords.size,totalWords:this.getTotalSize(),totalReviews:e}}loadVocabulary(){const e=localStorage.getItem("wordDiscovererVocabulary");if(!e)return{learningWords:new Map,masteredWords:new Map};try{const t=JSON.parse(e);if("2.0"===t.version)return{learningWords:new Map(t.learningWords||[]),masteredWords:new Map(t.masteredWords||[])};if(Array.isArray(t))return console.log("Migrating old vocabulary format to new v2.0 format."),{learningWords:new Map(t),masteredWords:new Map}}catch(t){console.error("Error loading vocabulary:",t)}return{learningWords:new Map,masteredWords:new Map}}saveVocabulary(){const e={version:"2.0",learningWords:Array.from(this.learningWords.entries()),masteredWords:Array.from(this.masteredWords.entries())};localStorage.setItem("wordDiscovererVocabulary",JSON.stringify(e)),this.syncEnabled&&!this.isSyncing&&this.syncToGoogleDrive()}async initializeGoogleDrive(){try{const e=await this.googleDriveManager.initialize();return e&&console.log("Google Drive integration initialized"),e}catch(e){return console.error("Error initializing Google Drive:",e),!1}}async enableGoogleDriveSync(e=!1){try{this.googleDriveManager.isInitialized||await this.initializeGoogleDrive();return!!(await this.googleDriveManager.signIn(e))&&(this.syncEnabled=!0,await this.syncToGoogleDrive(),console.log("Google Drive sync enabled"),!0)}catch(t){return console.error("Error enabling Google Drive sync:",t),!1}}async disableGoogleDriveSync(){try{return this.syncEnabled=!1,await this.googleDriveManager.signOut(),console.log("Google Drive sync disabled"),!0}catch(e){return console.error("Error disabling Google Drive sync:",e),!1}}async syncToGoogleDrive(){if(!this.syncEnabled||!this.googleDriveManager.isSignedIn||this.isSyncing)return!1;this.isSyncing=!0;try{const e=this.exportVocabulary(),t=await this.googleDriveManager.syncVocabulary(e);return t.success?("merge"===t.action?(this.importVocabulary(t.data),console.log("Vocabulary merged and synced with Google Drive"),window.wordDiscoverer&&window.wordDiscoverer.refreshTextAnalysis()):"download"===t.action?(this.importVocabulary(t.data),console.log("Vocabulary synced from Google Drive"),window.wordDiscoverer&&window.wordDiscoverer.refreshTextAnalysis()):"upload"===t.action&&console.log("Vocabulary uploaded to Google Drive"),this.lastSyncTime=(new Date).toISOString(),!0):(console.error("Sync failed:",t.error),!1)}catch(e){return console.error("Error syncing to Google Drive:",e),!1}finally{this.isSyncing=!1}}async forceSyncFromGoogleDrive(){try{if(!this.googleDriveManager.isSignedIn)return!1;const e=await this.googleDriveManager.downloadVocabulary();return!!e&&(this.importVocabulary(e),this.lastSyncTime=(new Date).toISOString(),console.log("Vocabulary force synced from Google Drive"),window.wordDiscoverer&&window.wordDiscoverer.refreshTextAnalysis(),!0)}catch(e){return console.error("Error force syncing from Google Drive:",e),!1}}async getGoogleDriveStatus(){const e=this.googleDriveManager.getAuthStatus(),t=await this.googleDriveManager.getUserInfo();return{syncEnabled:this.syncEnabled,isSignedIn:e.isSignedIn,hasFile:e.hasFile,lastSyncTime:this.lastSyncTime,userInfo:t}}getGoogleDriveManager(){return this.googleDriveManager}}class Ea{constructor(){this.settings=this.loadSettings()}getSetting(e){return this.settings[e]}setSetting(e,t){this.settings[e]=t,this.saveSettings()}getAllSettings(){return{...this.settings}}updateSettings(e){this.settings={...this.settings,...e},this.saveSettings()}resetToDefault(){this.settings=this.getDefaultSettings(),this.saveSettings()}exportSettings(){return{settings:this.settings,exportDate:(new Date).toISOString(),version:"1.0"}}importSettings(e){try{return!(!e.settings||"object"!=typeof e.settings)&&(this.settings={...this.getDefaultSettings(),...e.settings},this.saveSettings(),!0)}catch(t){return console.error("Error importing settings:",t),!1}}getDefaultSettings(){return{highlightColor:"#ffeb3b",highlightOpacity:.7,translationService:"bing",targetLanguage:"zh",difficultyLevel:"intermediate",highlightMode:"unknown",autoSave:!0,showTooltips:!0,theme:"light",fontSize:"medium",enableNotifications:!0,reviewReminder:!0,reviewInterval:7,googleDriveSync:!1}}validateSetting(e,t){const a={highlightColor:e=>/^#[0-9A-F]{6}$/i.test(e),highlightOpacity:e=>"number"==typeof e&&e>=0&&e<=1,translationService:e=>["bing","google","yandex"].includes(e),targetLanguage:e=>"string"==typeof e&&2===e.length,difficultyLevel:e=>["common","beginner","intermediate","advanced","expert"].includes(e),highlightMode:e=>["unknown","difficult","all"].includes(e),autoSave:e=>"boolean"==typeof e,showTooltips:e=>"boolean"==typeof e,theme:e=>["light","dark"].includes(e),fontSize:e=>["small","medium","large"].includes(e),enableNotifications:e=>"boolean"==typeof e,reviewReminder:e=>"boolean"==typeof e,reviewInterval:e=>"number"==typeof e&&e>0}[e];return!a||a(t)}getSettingMetadata(e){return{highlightColor:{type:"color",label:"Highlight Color",description:"Color used for highlighting words"},highlightOpacity:{type:"range",label:"Highlight Opacity",description:"Transparency of highlighted words",min:0,max:1,step:.1},translationService:{type:"select",label:"Translation Service",description:"Service used for translations",options:[{value:"bing",label:"Bing Translator"},{value:"google",label:"Google Translate"},{value:"yandex",label:"Yandex Translate"}]},targetLanguage:{type:"text",label:"Target Language",description:"Language code for translations (e.g., zh, es, fr)"},difficultyLevel:{type:"select",label:"Difficulty Level",description:"Base difficulty level for analysis",options:[{value:"common",label:"Common"},{value:"beginner",label:"Beginner"},{value:"intermediate",label:"Intermediate"},{value:"advanced",label:"Advanced"},{value:"expert",label:"Expert"}]},highlightMode:{type:"select",label:"Highlight Mode",description:"Which words to highlight",options:[{value:"unknown",label:"Unknown Words Only"},{value:"difficult",label:"Difficult Words"},{value:"all",label:"All Words"}]},theme:{type:"select",label:"Theme",description:"Application theme",options:[{value:"light",label:"Light"},{value:"dark",label:"Dark"}]},fontSize:{type:"select",label:"Font Size",description:"Text size preference",options:[{value:"small",label:"Small"},{value:"medium",label:"Medium"},{value:"large",label:"Large"}]}}[e]||null}loadSettings(){const e=this.getDefaultSettings(),t=localStorage.getItem("wordDiscovererSettings");if(t)try{const a=JSON.parse(t);return{...e,...a}}catch(a){console.error("Error loading settings:",a)}return e}saveSettings(){localStorage.setItem("wordDiscovererSettings",JSON.stringify(this.settings))}}class xa{constructor(e){this.element="string"==typeof e?document.querySelector(e):e}addEventListener(e,t,a){const n=this.element.querySelector(e);n&&n.addEventListener(t,a.bind(this))}show(){this.element&&(this.element.style.display="block")}hide(){this.element&&(this.element.style.display="none")}}class Sa extends xa{constructor(e,t){super(e),this.title=t,this.modalContent=null,this.element.innerHTML=this.render(),this.modalContent=this.element.querySelector(".modal-content"),this.element.addEventListener("click",e=>{e.target===this.element&&this.close()});const a=this.element.querySelector(".close-btn");a&&a.addEventListener("click",()=>this.close())}render(){return`\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h2>${this.title}</h2>\n                    <button class="close-btn"><i class="fas fa-times"></i></button>\n                </div>\n                <div class="modal-body">\n                    \x3c!-- Content will be injected here --\x3e\n                </div>\n            </div>\n        `}open(e){const t=this.element.querySelector(".modal-body");t&&(t.innerHTML=e),this.element.offsetHeight,this.element.classList.add("show"),requestAnimationFrame(()=>{this.calculatePosition()})}close(){this.element.classList.remove("show")}calculatePosition(){const e=this.modalContent;if(!e)return;e.style.marginTop="",e.style.marginBottom="",e.offsetHeight;const t=window.innerHeight,a=e.offsetHeight;if(a<t){const n=Math.max(10,(t-a)/2);e.style.marginTop=`${n}px`,e.style.marginBottom="auto"}else e.style.marginTop="10px",e.style.marginBottom="10px"}}class Da{constructor(e){this.vocabularyManager=e,this.modal=new Sa("#vocabularyModal","My Vocabulary"),this.app=null}setApp(e){this.app=e}open(){this.modal.open(this.renderContent()),this.addEventListeners(),this.updateAndRenderLists()}addEventListeners(){document.querySelectorAll(".vocab-tab").forEach(e=>{e.addEventListener("click",e=>this.handleTabClick(e))}),document.getElementById("exportVocabBtn").addEventListener("click",()=>this.onExportVocabulary()),document.getElementById("importVocabBtn").addEventListener("click",()=>document.getElementById("importFile").click()),document.getElementById("importFile").addEventListener("change",e=>this.onImportFileChange(e)),document.getElementById("clearVocabBtn").addEventListener("click",()=>this.onClearVocabulary())}renderContent(){return'\n            <div class="vocab-controls">\n                <button class="btn btn-primary" id="exportVocabBtn"><i class="fas fa-download"></i> Export</button>\n                <button class="btn btn-secondary" id="importVocabBtn"><i class="fas fa-upload"></i> Import</button>\n                <input type="file" id="importFile" accept=".json" style="display: none;">\n                <button class="btn btn-danger" id="clearVocabBtn"><i class="fas fa-trash"></i> Clear All</button>\n            </div>\n            <div class="vocab-tabs">\n                <button class="vocab-tab active" data-tab="learning">Learning (<span id="learning-count">0</span>)</button>\n                <button class="vocab-tab" data-tab="mastered">Mastered (<span id="mastered-count">0</span>)</button>\n            </div>\n            <div id="learning-list-container" class="vocab-tab-content active">\n                <div class="vocab-list" id="learning-list"></div>\n            </div>\n            <div id="mastered-list-container" class="vocab-tab-content">\n                <div class="vocab-list" id="mastered-list"></div>\n            </div>\n        '}updateAndRenderLists(){const e=document.getElementById("learning-list"),t=document.getElementById("mastered-list");if(!e||!t)return;const a=this.vocabularyManager.getSortedByDate(this.vocabularyManager.learningWords);this.renderList(e,a,"learning");const n=this.vocabularyManager.getSortedByDate(this.vocabularyManager.masteredWords);this.renderList(t,n,"mastered"),this.updateCounts()}renderList(e,t,a){e.innerHTML="",0!==t.length?(t.forEach(([t,n])=>{const s="learning"===a?`<button class="btn btn-sm btn-success master-btn" data-word="${t}"><i class="fas fa-check"></i> Master</button>`:`<button class="btn btn-sm btn-info unmaster-btn" data-word="${t}"><i class="fas fa-undo"></i> Learn</button>`,i=document.createElement("div");i.className="vocab-item",i.innerHTML=`\n                <div>\n                    <div class="vocab-word">${t}</div>\n                    <div class="vocab-translation">${n.translation}</div>\n                    <div class="vocab-meta">Added: ${new Date(n.addedDate).toLocaleDateString()}</div>\n                </div>\n                <div class="vocab-actions">\n                    ${s}\n                    <button class="btn btn-sm btn-danger delete-btn" data-word="${t}"><i class="fas fa-trash"></i></button>\n                </div>\n            `,e.appendChild(i)}),e.querySelectorAll(".master-btn").forEach(e=>e.addEventListener("click",e=>this.masterWord(e.currentTarget.dataset.word))),e.querySelectorAll(".unmaster-btn").forEach(e=>e.addEventListener("click",e=>this.unmasterWord(e.currentTarget.dataset.word))),e.querySelectorAll(".delete-btn").forEach(e=>e.addEventListener("click",e=>this.removeFromVocabulary(e.currentTarget.dataset.word)))):e.innerHTML='<p style="text-align: center; color: #6b7280; padding: 2rem;">No words in this list yet.</p>'}updateCounts(){const e=this.vocabularyManager.getLearningSize(),t=this.vocabularyManager.masteredWords.size,a=document.getElementById("vocabCount");a&&(a.textContent=e);const n=document.getElementById("learning-count");n&&(n.textContent=e);const s=document.getElementById("mastered-count");s&&(s.textContent=t)}handleTabClick(e){const t=e.target,a=t.dataset.tab;document.querySelectorAll(".vocab-tab").forEach(e=>e.classList.remove("active")),t.classList.add("active"),document.querySelectorAll(".vocab-tab-content").forEach(e=>e.classList.remove("active")),document.getElementById(`${a}-list-container`).classList.add("active")}masterWord(e){this.vocabularyManager.masterWord(e)&&(this.updateAndRenderLists(),this.app.showNotification(`'${e}' moved to mastered list.`),this.app.refreshTextAnalysis())}unmasterWord(e){this.vocabularyManager.unmasterWord(e)&&(this.updateAndRenderLists(),this.app.showNotification(`'${e}' moved back to learning list.`),this.app.refreshTextAnalysis())}removeFromVocabulary(e){confirm(`Are you sure you want to permanently delete "${e}"?`)&&this.vocabularyManager.removeWord(e)&&(this.updateAndRenderLists(),this.app.showNotification(`'${e}' has been deleted.`,"info"),this.app.refreshTextAnalysis())}onExportVocabulary(){const e=this.vocabularyManager.exportVocabulary();this.app.downloadJSON(e,"word-discoverer-vocabulary.json"),this.app.showNotification("Vocabulary exported successfully!")}onImportFileChange(e){const t=e.target.files[0];if(!t)return;const a=new FileReader;a.onload=e=>{try{const t=JSON.parse(e.target.result);this.vocabularyManager.importVocabulary(t)?(this.updateAndRenderLists(),this.app.showNotification("Vocabulary imported successfully!"),this.app.refreshTextAnalysis()):this.app.showNotification("Error importing vocabulary. Check file format.","error")}catch(t){this.app.showNotification("Error importing vocabulary. Check file format.","error")}},a.readAsText(t)}onClearVocabulary(){confirm("Clear all vocabulary (both learning and mastered)? This action cannot be undone.")&&(this.vocabularyManager.clearVocabulary(),this.updateAndRenderLists(),this.app.showNotification("All vocabulary has been cleared."),this.app.refreshTextAnalysis())}}class Ca{constructor(e,t){this.settingsManager=e,this.googleDriveManager=t,this.modal=new Sa("#settingsModal","Settings"),this.app=null,this.userInfo=null,this.lastSyncTime=null}setApp(e){this.app=e}open(){this.modal.open(this.renderContent()),this.loadSettingsToUI(),this.addEventListeners(),this.updateGoogleDriveStatus()}addEventListeners(){const e=document.getElementById("highlightOpacity");e&&e.addEventListener("input",e=>this.onOpacityChange(e));const t=document.getElementById("highlightColor");t&&t.addEventListener("change",e=>this.onColorChange(e));const a=document.getElementById("difficultyLevel");a&&a.addEventListener("change",e=>{this.settingsManager.setSetting("difficultyLevel",e.target.value);const t=document.getElementById("mainDifficultyLevel");t&&t.value!==e.target.value&&(t.value=e.target.value)});const n=document.getElementById("highlightMode");n&&n.addEventListener("change",e=>{this.settingsManager.setSetting("highlightMode",e.target.value);const t=document.getElementById("mainHighlightMode");t&&t.value!==e.target.value&&(t.value=e.target.value)});const s=document.getElementById("exportSettingsBtn");s&&s.addEventListener("click",()=>this.onExportSettings());const i=document.getElementById("importSettingsBtn");i&&i.addEventListener("click",()=>{const e=document.getElementById("importSettingsFile");e&&e.click()});const r=document.getElementById("importSettingsFile");r&&r.addEventListener("change",e=>this.onImportSettingsFileChange(e));const o=document.getElementById("enableGoogleDriveBtn");o&&o.addEventListener("click",()=>this.onEnableGoogleDrive());const l=document.getElementById("syncNowBtn");l&&l.addEventListener("click",()=>this.onSyncNow());const d=document.getElementById("disconnectGoogleDriveBtn");d&&d.addEventListener("click",()=>this.onDisconnectGoogleDrive())}renderContent(){return`\n            <div class="settings-section">\n                <h3>Highlighting</h3>\n                <div class="setting-item">\n                    <label for="highlightColor">Highlight Color:</label>\n                    <input type="color" id="highlightColor">\n                </div>\n                <div class="setting-item">\n                    <label for="highlightOpacity">Opacity:</label>\n                    <input type="range" id="highlightOpacity" min="0.1" max="1" step="0.1">\n                    <span id="opacityValue"></span>\n                </div>\n            </div>\n            <div class="settings-section">\n                <h3>Analysis</h3>\n                <div class="setting-item">\n                    <label for="difficultyLevel">Difficulty Level:</label>\n                    <select id="difficultyLevel">\n                        <option value="beginner">Beginner</option>\n                        <option value="intermediate">Intermediate</option>\n                        <option value="advanced">Advanced</option>\n                        <option value="expert">Expert</option>\n                    </select>\n                </div>\n                <div class="setting-item">\n                    <label for="highlightMode">Highlight Mode:</label>\n                    <select id="highlightMode">\n                        <option value="unknown">Unknown Words Only</option>\n                        <option value="difficult">Difficult Words</option>\n                        <option value="all">All Words</option>\n                    </select>\n                </div>\n            </div>\n            <div class="settings-section">\n                <h3>Google Drive Sync</h3>\n                \x3c!-- Google Drive UI will be rendered here --\x3e\n                <div id="google-drive-section">${this.renderGoogleDriveUI()}</div>\n            </div>\n            <div class="settings-section">\n                <h3>Data Management</h3>\n                <div class="setting-item">\n                    <button class="btn btn-primary" id="exportSettingsBtn"><i class="fas fa-download"></i> Export Settings</button>\n                    <button class="btn btn-secondary" id="importSettingsBtn"><i class="fas fa-upload"></i> Import Settings</button>\n                    <input type="file" id="importSettingsFile" accept=".json" style="display: none;">\n                </div>\n            </div>\n        `}renderGoogleDriveUI(){const e=this.googleDriveManager.getAuthStatus();return e.isInitialized?e.isSignedIn?`\n            <div class="google-drive-status">\n                <div class="user-info">\n                    ${this.userInfo&&this.userInfo.imageUrl?`<img src="${this.userInfo.imageUrl}" alt="User Avatar" class="user-avatar">`:'<div class="user-avatar-placeholder"><i class="fas fa-user"></i></div>'}\n                    <div class="user-details">\n                        <div class="user-name">${this.userInfo?.name||"Google User"}</div>\n                        <div class="user-email">${this.userInfo?.email||"No email provided"}</div>\n                    </div>\n                </div>\n                \n                <div class="sync-controls">\n                    <button class="btn btn-primary" id="syncNowBtn">\n                        <i class="fas fa-sync-alt"></i> Sync Now\n                    </button>\n                    <button class="btn btn-secondary" id="disconnectGoogleDriveBtn">\n                        <i class="fas fa-sign-out-alt"></i> Disconnect\n                    </button>\n                </div>\n                \n                ${this.lastSyncTime?`<div class="sync-info">\n                        <div class="last-sync">\n                            <i class="fas fa-check-circle"></i>\n                            <span>Last synced: ${new Date(this.lastSyncTime).toLocaleString()}</span>\n                        </div>\n                    </div>`:'<div class="sync-info">\n                        <div class="last-sync">\n                            <i class="fas fa-info-circle"></i>\n                            <span>Never synced</span>\n                        </div>\n                    </div>'}\n            </div>\n        `:'\n                <div class="google-drive-status">\n                    <div class="status-indicator">\n                        <i class="fas fa-unlink"></i>\n                        <span>Google Drive not connected</span>\n                    </div>\n                    <button class="btn btn-success" id="enableGoogleDriveBtn">\n                        <i class="fab fa-google"></i> Connect to Google Drive\n                    </button>\n                </div>\n            ':'\n                <div class="google-drive-status">\n                    <div class="status-indicator">\n                        <i class="fas fa-exclamation-circle"></i>\n                        <span>Google Drive not initialized</span>\n                    </div>\n                    <button class="btn btn-primary" id="enableGoogleDriveBtn">\n                        <i class="fab fa-google"></i> Initialize Google Drive\n                    </button>\n                </div>\n            '}async updateGoogleDriveStatus(){try{this.googleDriveManager.isSignedIn&&(this.userInfo=await this.googleDriveManager.getUserInfo());const e=document.getElementById("google-drive-section");e&&(e.innerHTML=this.renderGoogleDriveUI(),this.addEventListeners())}catch(e){console.error("Error updating Google Drive status:",e)}}loadSettingsToUI(){const e=this.settingsManager.getAllSettings();Object.entries(e).forEach(([e,t])=>{const a=document.getElementById(e);if(a)if("range"===a.type){a.value=t;const n=document.getElementById(e+"Value");n&&(n.textContent=Math.round(100*t)+"%")}else a.value=t});const t=document.getElementById("mainDifficultyLevel");t&&(t.value=e.difficultyLevel||"intermediate");const a=document.getElementById("mainHighlightMode");a&&(a.value=e.highlightMode||"unknown")}onOpacityChange(e){const t=parseFloat(e.target.value),a=document.getElementById("opacityValue");a&&(a.textContent=Math.round(100*t)+"%"),this.settingsManager.setSetting("highlightOpacity",t)}onColorChange(e){this.settingsManager.setSetting("highlightColor",e.target.value)}onExportSettings(){const e=this.settingsManager.exportSettings();this.app.downloadJSON(e,"settings.json"),this.app.showNotification("Settings exported successfully!")}onImportSettingsFileChange(e){const t=e.target.files[0];if(!t)return;const a=new FileReader;a.onload=e=>{try{const t=JSON.parse(e.target.result);this.settingsManager.importSettings(t)?(this.loadSettingsToUI(),this.app.showNotification("Settings imported successfully!")):this.app.showNotification("Error importing settings.","error")}catch(t){this.app.showNotification("Error importing settings.","error")}},a.readAsText(t)}async onEnableGoogleDrive(){try{const e=document.getElementById("enableGoogleDriveBtn");e&&(e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Connecting...',e.disabled=!0),this.googleDriveManager.isInitialized||await this.googleDriveManager.initialize();await this.googleDriveManager.signIn()?(this.app.showNotification("Successfully connected to Google Drive!"),await this.updateGoogleDriveStatus()):(this.app.showNotification("Failed to connect to Google Drive.","error"),e&&(e.innerHTML='<i class="fab fa-google"></i> Connect to Google Drive',e.disabled=!1))}catch(e){console.error("Error enabling Google Drive:",e),this.app.showNotification("Error connecting to Google Drive.","error");const t=document.getElementById("enableGoogleDriveBtn");t&&(t.innerHTML='<i class="fab fa-google"></i> Connect to Google Drive',t.disabled=!1)}}async onSyncNow(){try{const e=document.getElementById("syncNowBtn");if(e){const t=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Syncing...',e.disabled=!0;try{const e=this.app.vocabularyManager.exportVocabulary(),t=await this.googleDriveManager.syncVocabulary(e);t.success?(this.lastSyncTime=new Date,this.app.showNotification("Successfully synced with Google Drive!"),await this.updateGoogleDriveStatus(),"download"!==t.action&&"merge"!==t.action||(this.app.vocabularyManager.importVocabulary(t.data),this.app.updateCounts(),this.app.showNotification("Vocabulary updated from Google Drive!"))):this.app.showNotification("Failed to sync with Google Drive: "+t.error,"error")}finally{e.innerHTML=t,e.disabled=!1}}}catch(e){console.error("Error syncing with Google Drive:",e),this.app.showNotification("Error syncing with Google Drive.","error");const t=document.getElementById("syncNowBtn");t&&(t.innerHTML='<i class="fas fa-sync-alt"></i> Sync Now',t.disabled=!1)}}async onDisconnectGoogleDrive(){try{await this.googleDriveManager.signOut()?(this.userInfo=null,this.lastSyncTime=null,this.app.showNotification("Disconnected from Google Drive."),await this.updateGoogleDriveStatus()):this.app.showNotification("Failed to disconnect from Google Drive.","error")}catch(e){console.error("Error disconnecting from Google Drive:",e),this.app.showNotification("Error disconnecting from Google Drive.","error")}}}class La extends xa{constructor(e,t){super(e),this.vocabularyManager=t,this.app=null,this.currentWord=null,this.currentTranslation=null}setApp(e){this.app=e}render(e){this.element.innerHTML=e,this.addEventListeners()}addEventListeners(){this.element.addEventListener("click",e=>{if(e.target.classList.contains("word-span")){const t=e.target.dataset.word,a=e.target.dataset.translation;this.showWordModal(t,a,e)}})}showWordModal(e,t,a){this.currentWord=e,this.currentTranslation=t;const n=document.getElementById("wordModal");document.getElementById("wordModalContent");const s=document.getElementById("wordModalTitle"),i=document.getElementById("wordModalTranslation"),r=document.getElementById("wordModalActions");if(s.textContent=e,t.includes("<")&&t.includes(">")?i.innerHTML=t:i.textContent=t,r.innerHTML="",this.vocabularyManager.masteredWords.has(e)){const t=document.createElement("button");t.textContent="Move to Learning List",t.className="btn btn-secondary",t.onclick=()=>{this.handleWordUnmaster(e),this.closeWordModal()},r.appendChild(t)}else if(this.vocabularyManager.learningWords.has(e)){const a=document.createElement("button");a.textContent="Mark as Mastered",a.className="btn btn-primary",a.onclick=()=>{this.handleWordMaster(e,t),this.closeWordModal()},r.appendChild(a)}else{const a=document.createElement("button");a.textContent="Add to Learning List",a.className="btn btn-primary",a.onclick=()=>{this.handleWordAddToLearning(e,t),this.closeWordModal()},r.appendChild(a);const n=document.createElement("button");n.textContent="Add to Mastered List",n.className="btn btn-secondary",n.onclick=()=>{this.handleWordMaster(e,t),this.closeWordModal()},r.appendChild(n)}const o=document.createElement("button");o.textContent="Close",o.className="btn btn-outline",o.onclick=()=>this.closeWordModal(),r.appendChild(o),n.classList.add("show"),n.onclick=e=>{e.target===n&&this.closeWordModal()}}closeWordModal(){document.getElementById("wordModal").classList.remove("show")}async handleWordAddToLearning(e,t){this.vocabularyManager.addWord(e,t)&&this.app.showNotification(`📖 '${e}' added to learning list.`),this.app.updateCounts(),await this.refreshTextAnalysis()}async handleWordMaster(e,t){const a=this.vocabularyManager.masterWord(e,t);"added_to_mastered"!==a&&"moved_to_mastered"!==a||this.app.showNotification(`✅ '${e}' marked as mastered.`),this.app.updateCounts(),await this.refreshTextAnalysis()}async handleWordUnmaster(e){"moved_to_learning"===this.vocabularyManager.unmasterWord(e)&&(this.app.showNotification(`📖 '${e}' moved to learning list.`),this.app.updateCounts()),await this.refreshTextAnalysis()}async refreshTextAnalysis(){const e=document.getElementById("textInput").value;if(!e)return;const t=await this.app.performTextAnalysis(e),a=await this.app.textAnalyzer.processTextForDisplay(e,t);this.render(a),this.app.updateStatistics&&this.app.updateStatistics(t),this.app.displayHighlightedWords?.(t.highlightedWords)}}class Ia{constructor(){this.settingsManager=new Ea,this.wordDatabase=new ba,this.vocabularyManager=new ka,this.textAnalyzer=new _a(this.wordDatabase),this.vocabularyComponent=new Da(this.vocabularyManager),this.settingsComponent=new Ca(this.settingsManager,this.vocabularyManager.googleDriveManager),this.analyzedTextComponent=new La("#analyzedText",this.vocabularyManager),this.vocabularyComponent.setApp(this),this.settingsComponent.setApp(this),this.analyzedTextComponent.setApp(this),this.initialize()}async initialize(){this.addEventListeners(),this.updateCounts();const e=document.getElementById("dbLoadingOverlay"),t=document.getElementById("dbProgressBar"),a=document.getElementById("dbProgressPercentage"),n=document.getElementById("dbProgressChunks"),s=document.getElementById("dbLoadingMessage");e.classList.add("show"),this.wordDatabase.setProgressCallback(e=>{t.style.width=`${e.percentage.toFixed(1)}%`,a.textContent=`${e.percentage.toFixed(1)}%`;let n=e.message||"Loading...";!0===e.fromCache?(n=`📦 ${n}`,s.style.color="#059669"):!1===e.fromCache&&(n=`⬇️ ${n}`,s.style.color="#3b82f6"),s.textContent=n}),this.wordDatabase.progressiveLoader&&(this.wordDatabase.progressiveLoader.on("chunkLoaded",e=>{const t=e.fromCache?" (cached)":"";n.textContent=`${e.loaded}/${e.total} chunks${t}`}),this.wordDatabase.progressiveLoader.on("complete",()=>{setTimeout(()=>{e.classList.remove("show")},1e3)})),await this.wordDatabase.initialize(),setTimeout(()=>{e.classList.remove("show")},500),console.log("WordDiscoverer initialized successfully")}addEventListeners(){document.getElementById("analyzeBtn").addEventListener("click",()=>this.analyzeText()),document.getElementById("vocabularyBtn").addEventListener("click",()=>this.vocabularyComponent.open()),document.getElementById("settingsBtn").addEventListener("click",()=>this.settingsComponent.open()),document.getElementById("clearBtn").addEventListener("click",()=>this.clearText());const e=document.getElementById("wordModalClose");e&&e.addEventListener("click",()=>{document.getElementById("wordModal").classList.remove("show")});const t=document.getElementById("mainDifficultyLevel");t&&t.addEventListener("change",async e=>{this.settingsManager.setSetting("difficultyLevel",e.target.value),await this.refreshTextAnalysis()});const a=document.getElementById("mainHighlightMode");a&&a.addEventListener("change",async e=>{this.settingsManager.setSetting("highlightMode",e.target.value),await this.refreshTextAnalysis()})}async analyzeText(){const e=document.getElementById("textInput").value.trim();if(!e)return void this.showNotification("Please enter some text to analyze.","error");const t=document.getElementById("loadingOverlay");t.classList.add("show");try{const t=await this.performTextAnalysis(e),a=await this.textAnalyzer.processTextForDisplay(e,t);this.analyzedTextComponent.render(a),document.getElementById("analyzedTextSection").style.display="block",document.getElementById("statistics").style.display="flex",document.getElementById("highlightedWordsList").style.display="block",this.updateStatistics(t),this.displayHighlightedWords(t.highlightedWords)}catch(a){console.error("Analysis error:",a),this.showNotification("Error analyzing text. Please try again.","error")}finally{t.classList.remove("show")}}async performTextAnalysis(e){const t=this.textAnalyzer.extractWords(e);return await this.textAnalyzer.analyzeWords(t,this.settingsManager.getSetting("difficultyLevel"),this.settingsManager.getSetting("highlightMode"),{learning:this.vocabularyManager.learningWords,mastered:this.vocabularyManager.masteredWords})}async refreshTextAnalysis(){if("block"!==document.getElementById("analyzedTextSection").style.display)return;const e=document.getElementById("textInput").value.trim();if(!e)return;const t=await this.performTextAnalysis(e),a=await this.textAnalyzer.processTextForDisplay(e,t);this.analyzedTextComponent.render(a),this.updateStatistics(t),this.displayHighlightedWords(t.highlightedWords)}updateStatistics(e){document.getElementById("totalWords").textContent=e.totalWords,document.getElementById("highlightedWords").textContent=e.highlightedWords.length,document.getElementById("newWords").textContent=e.newWords.length,document.getElementById("difficultyScore").textContent=e.difficultyScore}displayHighlightedWords(e){const t=document.getElementById("highlightedWordsContainer");if(t.innerHTML="",0===e.length)return void(t.innerHTML="<p>No highlighted words found.</p>");e.forEach(e=>{const a=document.createElement("div");a.className="highlighted-word-item";const n=document.createElement("div");n.innerHTML=e.translation;let s="",i="";const r=n.querySelector(".phonetic-line");r&&(s=r.textContent.trim());const o=n.querySelector(".translation-compact p");if(o&&(i=o.textContent.trim()),!s&&!i){const e=n.querySelector(".pron");e&&(s=e.textContent.trim());const t=n.querySelector(".trans");t&&(i=t.textContent.trim())}if(!i){const e=n.querySelector("p");e&&(i=e.textContent.trim())}const l=document.createElement("div");l.className="word",l.textContent=s?`${e.word} ${s}`:e.word,a.appendChild(l);const d=document.createElement("div");d.className="translation",d.textContent=i||"无翻译",a.appendChild(d),t.appendChild(a)})}updateCounts(){this.vocabularyComponent.updateCounts()}showNotification(e,t="success"){const a=document.createElement("div"),n={success:"#10b981",error:"#ef4444",info:"#3b82f6"};a.style.cssText=`\n            position: fixed; top: 20px; right: 20px; background: ${n[t]||n.success}; color: white;\n            padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n            z-index: 3000; animation: slideIn 0.3s ease; max-width: 300px; word-wrap: break-word;\n        `,a.textContent=e,document.body.appendChild(a),setTimeout(()=>a.remove(),3e3)}downloadJSON(e,t){const a=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}clearText(){document.getElementById("textInput").value="",document.getElementById("analyzedTextSection").style.display="none",document.getElementById("statistics").style.display="none",document.getElementById("highlightedWordsList").style.display="none",document.getElementById("analyzedText").innerHTML="",document.getElementById("totalWords").textContent="0",document.getElementById("highlightedWords").textContent="0",document.getElementById("newWords").textContent="0",document.getElementById("difficultyScore").textContent="0",document.getElementById("highlightedWordsContainer").innerHTML=""}}document.addEventListener("DOMContentLoaded",()=>{window.wordDiscoverer=new Ia});
