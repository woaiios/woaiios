!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e={};function t(e){let t=e.length;for(;--t>=0;)e[t]=0}const n=256,a=286,s=30,i=15,r=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),o=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),l=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),d=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=new Array(576);t(c);const h=new Array(60);t(h);const u=new Array(512);t(u);const g=new Array(256);t(g);const m=new Array(29);t(m);const f=new Array(s);function p(e,t,n,a,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=a,this.max_length=s,this.has_stree=e&&e.length}let w,y,b;function _(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(f);const v=e=>e<256?u[e]:u[256+(e>>>7)],k=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},E=(e,t,n)=>{e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,k(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},x=(e,t,n)=>{E(e,n[2*t],n[2*t+1])},S=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},L=(e,t,n)=>{const a=new Array(16);let s,r,o=0;for(s=1;s<=i;s++)o=o+n[s-1]<<1,a[s]=o;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=S(a[t]++,t))}},I=e=>{let t;for(t=0;t<a;t++)e.dyn_ltree[2*t]=0;for(t=0;t<s;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},D=e=>{e.bi_valid>8?k(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},z=(e,t,n,a)=>{const s=2*t,i=2*n;return e[s]<e[i]||e[s]===e[i]&&a[t]<=a[n]},C=(e,t,n)=>{const a=e.heap[n];let s=n<<1;for(;s<=e.heap_len&&(s<e.heap_len&&z(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!z(t,a,e.heap[s],e.depth));)e.heap[n]=e.heap[s],n=s,s<<=1;e.heap[n]=a},T=(e,t,a)=>{let s,i,l,d,c=0;if(0!==e.sym_next)do{s=255&e.pending_buf[e.sym_buf+c++],s+=(255&e.pending_buf[e.sym_buf+c++])<<8,i=e.pending_buf[e.sym_buf+c++],0===s?x(e,i,t):(l=g[i],x(e,l+n+1,t),d=r[l],0!==d&&(i-=m[l],E(e,i,d)),s--,l=v(s),x(e,l,a),d=o[l],0!==d&&(s-=f[l],E(e,s,d)))}while(c<e.sym_next);x(e,256,t)},A=(e,t)=>{const n=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,r=t.stat_desc.elems;let o,l,d,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<r;o++)0!==n[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):n[2*o+1]=0;for(;e.heap_len<2;)d=e.heap[++e.heap_len]=c<2?++c:0,n[2*d]=1,e.depth[d]=0,e.opt_len--,s&&(e.static_len-=a[2*d+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)C(e,n,o);d=r;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],C(e,n,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,n[2*d]=n[2*o]+n[2*l],e.depth[d]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,n[2*o+1]=n[2*l+1]=d,e.heap[1]=d++,C(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const n=t.dyn_tree,a=t.max_code,s=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,d=t.stat_desc.max_length;let c,h,u,g,m,f,p=0;for(g=0;g<=i;g++)e.bl_count[g]=0;for(n[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)h=e.heap[c],g=n[2*n[2*h+1]+1]+1,g>d&&(g=d,p++),n[2*h+1]=g,h>a||(e.bl_count[g]++,m=0,h>=l&&(m=o[h-l]),f=n[2*h],e.opt_len+=f*(g+m),r&&(e.static_len+=f*(s[2*h+1]+m)));if(0!==p){do{for(g=d-1;0===e.bl_count[g];)g--;e.bl_count[g]--,e.bl_count[g+1]+=2,e.bl_count[d]--,p-=2}while(p>0);for(g=d;0!==g;g--)for(h=e.bl_count[g];0!==h;)u=e.heap[--c],u>a||(n[2*u+1]!==g&&(e.opt_len+=(g-n[2*u+1])*n[2*u],n[2*u+1]=g),h--)}})(e,t),L(n,c,e.bl_count)},M=(e,t,n)=>{let a,s,i=-1,r=t[1],o=0,l=7,d=4;for(0===r&&(l=138,d=3),t[2*(n+1)+1]=65535,a=0;a<=n;a++)s=r,r=t[2*(a+1)+1],++o<l&&s===r||(o<d?e.bl_tree[2*s]+=o:0!==s?(s!==i&&e.bl_tree[2*s]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,i=s,0===r?(l=138,d=3):s===r?(l=6,d=3):(l=7,d=4))},B=(e,t,n)=>{let a,s,i=-1,r=t[1],o=0,l=7,d=4;for(0===r&&(l=138,d=3),a=0;a<=n;a++)if(s=r,r=t[2*(a+1)+1],!(++o<l&&s===r)){if(o<d)do{x(e,s,e.bl_tree)}while(0!==--o);else 0!==s?(s!==i&&(x(e,s,e.bl_tree),o--),x(e,16,e.bl_tree),E(e,o-3,2)):o<=10?(x(e,17,e.bl_tree),E(e,o-3,3)):(x(e,18,e.bl_tree),E(e,o-11,7));o=0,i=s,0===r?(l=138,d=3):s===r?(l=6,d=3):(l=7,d=4)}};let W=!1;const N=(e,t,n,a)=>{E(e,0+(a?1:0),3),D(e),k(e,n),k(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n};var R={_tr_init:e=>{W||((()=>{let e,t,n,d,_;const v=new Array(16);for(n=0,d=0;d<28;d++)for(m[d]=n,e=0;e<1<<r[d];e++)g[n++]=d;for(g[n-1]=d,_=0,d=0;d<16;d++)for(f[d]=_,e=0;e<1<<o[d];e++)u[_++]=d;for(_>>=7;d<s;d++)for(f[d]=_<<7,e=0;e<1<<o[d]-7;e++)u[256+_++]=d;for(t=0;t<=i;t++)v[t]=0;for(e=0;e<=143;)c[2*e+1]=8,e++,v[8]++;for(;e<=255;)c[2*e+1]=9,e++,v[9]++;for(;e<=279;)c[2*e+1]=7,e++,v[7]++;for(;e<=287;)c[2*e+1]=8,e++,v[8]++;for(L(c,287,v),e=0;e<s;e++)h[2*e+1]=5,h[2*e]=S(e,5);w=new p(c,r,257,a,i),y=new p(h,o,0,s,i),b=new p(new Array(0),l,0,19,7)})(),W=!0),e.l_desc=new _(e.dyn_ltree,w),e.d_desc=new _(e.dyn_dtree,y),e.bl_desc=new _(e.bl_tree,b),e.bi_buf=0,e.bi_valid=0,I(e)},_tr_stored_block:N,_tr_flush_block:(e,t,a,s)=>{let i,r,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,a=4093624447;for(t=0;t<=31;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<n;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),A(e,e.l_desc),A(e,e.d_desc),o=(e=>{let t;for(M(e,e.dyn_ltree,e.l_desc.max_code),M(e,e.dyn_dtree,e.d_desc.max_code),A(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*d[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=i&&(i=r)):i=r=a+5,a+4<=i&&-1!==t?N(e,t,a,s):4===e.strategy||r===i?(E(e,2+(s?1:0),3),T(e,c,h)):(E(e,4+(s?1:0),3),((e,t,n,a)=>{let s;for(E(e,t-257,5),E(e,n-1,5),E(e,a-4,4),s=0;s<a;s++)E(e,e.bl_tree[2*d[s]+1],3);B(e,e.dyn_ltree,t-1),B(e,e.dyn_dtree,n-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),T(e,e.dyn_ltree,e.dyn_dtree)),I(e),s&&D(e)},_tr_tally:(e,t,a)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=a,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(g[a]+n+1)]++,e.dyn_dtree[2*v(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{E(e,2,3),x(e,256,c),(e=>{16===e.bi_valid?(k(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var F=(e,t,n,a)=>{let s=65535&e,i=e>>>16&65535,r=0;for(;0!==n;){r=n>2e3?2e3:n,n-=r;do{s=s+t[a++]|0,i=i+s|0}while(--r);s%=65521,i%=65521}return s|i<<16};const O=new Uint32Array((()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t})());var U=(e,t,n,a)=>{const s=O,i=a+n;e^=-1;for(let r=a;r<i;r++)e=e>>>8^s[255&(e^t[r])];return-1^e},G={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},$={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Z,_tr_stored_block:V,_tr_flush_block:H,_tr_tally:P,_tr_align:q}=R,{Z_NO_FLUSH:j,Z_PARTIAL_FLUSH:K,Z_FULL_FLUSH:X,Z_FINISH:J,Z_BLOCK:Y,Z_OK:Q,Z_STREAM_END:ee,Z_STREAM_ERROR:te,Z_DATA_ERROR:ne,Z_BUF_ERROR:ae,Z_DEFAULT_COMPRESSION:se,Z_FILTERED:ie,Z_HUFFMAN_ONLY:re,Z_RLE:oe,Z_FIXED:le,Z_DEFAULT_STRATEGY:de,Z_UNKNOWN:ce,Z_DEFLATED:he}=$,ue=258,ge=262,me=42,fe=113,pe=666,we=(e,t)=>(e.msg=G[t],t),ye=e=>2*e-(e>4?9:0),be=e=>{let t=e.length;for(;--t>=0;)e[t]=0},_e=e=>{let t,n,a,s=e.w_size;t=e.hash_size,a=t;do{n=e.head[--a],e.head[a]=n>=s?n-s:0}while(--t);t=s,a=t;do{n=e.prev[--a],e.prev[a]=n>=s?n-s:0}while(--t)};let ve=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask;const ke=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Ee=(e,t)=>{H(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ke(e.strm)},xe=(e,t)=>{e.pending_buf[e.pending++]=t},Se=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Le=(e,t,n,a)=>{let s=e.avail_in;return s>a&&(s=a),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),1===e.state.wrap?e.adler=F(e.adler,t,s,n):2===e.state.wrap&&(e.adler=U(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},Ie=(e,t)=>{let n,a,s=e.max_chain_length,i=e.strstart,r=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-ge?e.strstart-(e.w_size-ge):0,d=e.window,c=e.w_mask,h=e.prev,u=e.strstart+ue;let g=d[i+r-1],m=d[i+r];e.prev_length>=e.good_match&&(s>>=2),o>e.lookahead&&(o=e.lookahead);do{if(n=t,d[n+r]===m&&d[n+r-1]===g&&d[n]===d[i]&&d[++n]===d[i+1]){i+=2,n++;do{}while(d[++i]===d[++n]&&d[++i]===d[++n]&&d[++i]===d[++n]&&d[++i]===d[++n]&&d[++i]===d[++n]&&d[++i]===d[++n]&&d[++i]===d[++n]&&d[++i]===d[++n]&&i<u);if(a=ue-(u-i),i=u-ue,a>r){if(e.match_start=t,r=a,a>=o)break;g=d[i+r-1],m=d[i+r]}}}while((t=h[t&c])>l&&0!==--s);return r<=e.lookahead?r:e.lookahead},De=e=>{const t=e.w_size;let n,a,s;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ge)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),_e(e),a+=t),0===e.strm.avail_in)break;if(n=Le(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=ve(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=ve(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<ge&&0!==e.strm.avail_in)},ze=(e,t)=>{let n,a,s,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,r=0,o=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,a=e.strstart-e.block_start,n>a+e.strm.avail_in&&(n=a+e.strm.avail_in),n>s&&(n=s),n<i&&(0===n&&t!==J||t===j||n!==a+e.strm.avail_in))break;r=t===J&&n===a+e.strm.avail_in?1:0,V(e,0,0,r),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,ke(e.strm),a&&(a>n&&(a=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,n-=a),n&&(Le(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===r);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),r?4:t!==j&&t!==J&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(Le(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,i=s>e.w_size?e.w_size:s,a=e.strstart-e.block_start,(a>=i||(a||t===J)&&t!==j&&0===e.strm.avail_in&&a<=s)&&(n=a>s?s:a,r=t===J&&0===e.strm.avail_in&&n===a?1:0,V(e,e.block_start,n,r),e.block_start+=n,ke(e.strm)),r?3:1)},Ce=(e,t)=>{let n,a;for(;;){if(e.lookahead<ge){if(De(e),e.lookahead<ge&&t===j)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ge&&(e.match_length=Ie(e,n)),e.match_length>=3)if(a=P(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=ve(e,e.ins_h,e.window[e.strstart+1]);else a=P(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(Ee(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===J?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2},Te=(e,t)=>{let n,a,s;for(;;){if(e.lookahead<ge){if(De(e),e.lookahead<ge&&t===j)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ge&&(e.match_length=Ie(e,n),e.match_length<=5&&(e.strategy===ie||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,a=P(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=ve(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(Ee(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(a=P(e,0,e.window[e.strstart-1]),a&&Ee(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=P(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===J?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2};function Ae(e,t,n,a,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=a,this.func=s}const Me=[new Ae(0,0,0,0,ze),new Ae(4,4,8,4,Ce),new Ae(4,5,16,8,Ce),new Ae(4,6,32,32,Ce),new Ae(4,4,16,16,Te),new Ae(8,16,32,32,Te),new Ae(8,16,128,128,Te),new Ae(8,32,128,256,Te),new Ae(32,128,258,1024,Te),new Ae(32,258,258,4096,Te)];function Be(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=he,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),be(this.dyn_ltree),be(this.dyn_dtree),be(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),be(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),be(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const We=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==me&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==fe&&t.status!==pe?1:0},Ne=e=>{if(We(e))return we(e,te);e.total_in=e.total_out=0,e.data_type=ce;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?me:fe,e.adler=2===t.wrap?0:1,t.last_flush=-2,Z(t),Q},Re=e=>{const t=Ne(e);var n;return t===Q&&((n=e.state).window_size=2*n.w_size,be(n.head),n.max_lazy_match=Me[n.level].max_lazy,n.good_match=Me[n.level].good_length,n.nice_match=Me[n.level].nice_length,n.max_chain_length=Me[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),t},Fe=(e,t,n,a,s,i)=>{if(!e)return te;let r=1;if(t===se&&(t=6),a<0?(r=0,a=-a):a>15&&(r=2,a-=16),s<1||s>9||n!==he||a<8||a>15||t<0||t>9||i<0||i>le||8===a&&1!==r)return we(e,te);8===a&&(a=9);const o=new Be;return e.state=o,o.strm=e,o.status=me,o.wrap=r,o.gzhead=null,o.w_bits=a,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=i,o.method=n,Re(e)};var Oe={deflateInit:(e,t)=>Fe(e,t,he,15,8,de),deflateInit2:Fe,deflateReset:Re,deflateResetKeep:Ne,deflateSetHeader:(e,t)=>We(e)||2!==e.state.wrap?te:(e.state.gzhead=t,Q),deflate:(e,t)=>{if(We(e)||t>Y||t<0)return e?we(e,te):te;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===pe&&t!==J)return we(e,0===e.avail_out?ae:te);const a=n.last_flush;if(n.last_flush=t,0!==n.pending){if(ke(e),0===e.avail_out)return n.last_flush=-1,Q}else if(0===e.avail_in&&ye(t)<=ye(a)&&t!==J)return we(e,ae);if(n.status===pe&&0!==e.avail_in)return we(e,ae);if(n.status===me&&0===n.wrap&&(n.status=fe),n.status===me){let t=he+(n.w_bits-8<<4)<<8,a=-1;if(a=n.strategy>=re||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=a<<6,0!==n.strstart&&(t|=32),t+=31-t%31,Se(n,t),0!==n.strstart&&(Se(n,e.adler>>>16),Se(n,65535&e.adler)),e.adler=1,n.status=fe,ke(e),0!==n.pending)return n.last_flush=-1,Q}if(57===n.status)if(e.adler=0,xe(n,31),xe(n,139),xe(n,8),n.gzhead)xe(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),xe(n,255&n.gzhead.time),xe(n,n.gzhead.time>>8&255),xe(n,n.gzhead.time>>16&255),xe(n,n.gzhead.time>>24&255),xe(n,9===n.level?2:n.strategy>=re||n.level<2?4:0),xe(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(xe(n,255&n.gzhead.extra.length),xe(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=U(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(xe(n,0),xe(n,0),xe(n,0),xe(n,0),xe(n,0),xe(n,9===n.level?2:n.strategy>=re||n.level<2?4:0),xe(n,3),n.status=fe,ke(e),0!==n.pending)return n.last_flush=-1,Q;if(69===n.status){if(n.gzhead.extra){let t=n.pending,a=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+a>n.pending_buf_size;){let s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=U(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=s,ke(e),0!==n.pending)return n.last_flush=-1,Q;t=0,a-=s}let s=new Uint8Array(n.gzhead.extra);n.pending_buf.set(s.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending+=a,n.gzhead.hcrc&&n.pending>t&&(e.adler=U(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let t,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=U(e.adler,n.pending_buf,n.pending-a,a)),ke(e),0!==n.pending)return n.last_flush=-1,Q;a=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,xe(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>a&&(e.adler=U(e.adler,n.pending_buf,n.pending-a,a)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let t,a=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>a&&(e.adler=U(e.adler,n.pending_buf,n.pending-a,a)),ke(e),0!==n.pending)return n.last_flush=-1,Q;a=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,xe(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>a&&(e.adler=U(e.adler,n.pending_buf,n.pending-a,a))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(ke(e),0!==n.pending))return n.last_flush=-1,Q;xe(n,255&e.adler),xe(n,e.adler>>8&255),e.adler=0}if(n.status=fe,ke(e),0!==n.pending)return n.last_flush=-1,Q}if(0!==e.avail_in||0!==n.lookahead||t!==j&&n.status!==pe){let a=0===n.level?ze(n,t):n.strategy===re?((e,t)=>{let n;for(;;){if(0===e.lookahead&&(De(e),0===e.lookahead)){if(t===j)return 1;break}if(e.match_length=0,n=P(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Ee(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===J?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===oe?((e,t)=>{let n,a,s,i;const r=e.window;for(;;){if(e.lookahead<=ue){if(De(e),e.lookahead<=ue&&t===j)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,a=r[s],a===r[++s]&&a===r[++s]&&a===r[++s])){i=e.strstart+ue;do{}while(a===r[++s]&&a===r[++s]&&a===r[++s]&&a===r[++s]&&a===r[++s]&&a===r[++s]&&a===r[++s]&&a===r[++s]&&s<i);e.match_length=ue-(i-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=P(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=P(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Ee(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===J?(Ee(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Ee(e,!1),0===e.strm.avail_out)?1:2})(n,t):Me[n.level].func(n,t);if(3!==a&&4!==a||(n.status=pe),1===a||3===a)return 0===e.avail_out&&(n.last_flush=-1),Q;if(2===a&&(t===K?q(n):t!==Y&&(V(n,0,0,!1),t===X&&(be(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),ke(e),0===e.avail_out))return n.last_flush=-1,Q}return t!==J?Q:n.wrap<=0?ee:(2===n.wrap?(xe(n,255&e.adler),xe(n,e.adler>>8&255),xe(n,e.adler>>16&255),xe(n,e.adler>>24&255),xe(n,255&e.total_in),xe(n,e.total_in>>8&255),xe(n,e.total_in>>16&255),xe(n,e.total_in>>24&255)):(Se(n,e.adler>>>16),Se(n,65535&e.adler)),ke(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Q:ee)},deflateEnd:e=>{if(We(e))return te;const t=e.state.status;return e.state=null,t===fe?we(e,ne):Q},deflateSetDictionary:(e,t)=>{let n=t.length;if(We(e))return te;const a=e.state,s=a.wrap;if(2===s||1===s&&a.status!==me||a.lookahead)return te;if(1===s&&(e.adler=F(e.adler,t,n,0)),a.wrap=0,n>=a.w_size){0===s&&(be(a.head),a.strstart=0,a.block_start=0,a.insert=0);let e=new Uint8Array(a.w_size);e.set(t.subarray(n-a.w_size,n),0),t=e,n=a.w_size}const i=e.avail_in,r=e.next_in,o=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,De(a);a.lookahead>=3;){let e=a.strstart,t=a.lookahead-2;do{a.ins_h=ve(a,a.ins_h,a.window[e+3-1]),a.prev[e&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=e,e++}while(--t);a.strstart=e,a.lookahead=2,De(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=r,e.input=o,e.avail_in=i,a.wrap=s,Q},deflateInfo:"pako deflate (from Nodeca project)"};const Ue=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Ge=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const t in n)Ue(n,t)&&(e[t]=n[t])}}return e},$e=e=>{let t=0;for(let a=0,s=e.length;a<s;a++)t+=e[a].length;const n=new Uint8Array(t);for(let a=0,s=0,i=e.length;a<i;a++){let t=e[a];n.set(t,s),s+=t.length}return n};let Ze=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Cn){Ze=!1}const Ve=new Uint8Array(256);for(let Tn=0;Tn<256;Tn++)Ve[Tn]=Tn>=252?6:Tn>=248?5:Tn>=240?4:Tn>=224?3:Tn>=192?2:1;Ve[254]=Ve[254]=1;var He=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,a,s,i,r=e.length,o=0;for(s=0;s<r;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<r&&(a=e.charCodeAt(s+1),56320==(64512&a)&&(n=65536+(n-55296<<10)+(a-56320),s++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),i=0,s=0;i<o;s++)n=e.charCodeAt(s),55296==(64512&n)&&s+1<r&&(a=e.charCodeAt(s+1),56320==(64512&a)&&(n=65536+(n-55296<<10)+(a-56320),s++)),n<128?t[i++]=n:n<2048?(t[i++]=192|n>>>6,t[i++]=128|63&n):n<65536?(t[i++]=224|n>>>12,t[i++]=128|n>>>6&63,t[i++]=128|63&n):(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63,t[i++]=128|n>>>6&63,t[i++]=128|63&n);return t},Pe=(e,t)=>{const n=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let a,s;const i=new Array(2*n);for(s=0,a=0;a<n;){let t=e[a++];if(t<128){i[s++]=t;continue}let r=Ve[t];if(r>4)i[s++]=65533,a+=r-1;else{for(t&=2===r?31:3===r?15:7;r>1&&a<n;)t=t<<6|63&e[a++],r--;r>1?i[s++]=65533:t<65536?i[s++]=t:(t-=65536,i[s++]=55296|t>>10&1023,i[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Ze)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n})(i,s)},qe=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let n=t-1;for(;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Ve[e[n]]>t?n:t};var je=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ke=Object.prototype.toString,{Z_NO_FLUSH:Xe,Z_SYNC_FLUSH:Je,Z_FULL_FLUSH:Ye,Z_FINISH:Qe,Z_OK:et,Z_STREAM_END:tt,Z_DEFAULT_COMPRESSION:nt,Z_DEFAULT_STRATEGY:at,Z_DEFLATED:st}=$;function it(e){this.options=Ge({level:nt,method:st,chunkSize:16384,windowBits:15,memLevel:8,strategy:at},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new je,this.strm.avail_out=0;let n=Oe.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==et)throw new Error(G[n]);if(t.header&&Oe.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?He(t.dictionary):"[object ArrayBuffer]"===Ke.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=Oe.deflateSetDictionary(this.strm,e),n!==et)throw new Error(G[n]);this._dict_set=!0}}function rt(e,t){const n=new it(t);if(n.push(e,!0),n.err)throw n.msg||G[n.err];return n.result}it.prototype.push=function(e,t){const n=this.strm,a=this.options.chunkSize;let s,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?Qe:Xe,"string"==typeof e?n.input=He(e):"[object ArrayBuffer]"===Ke.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(a),n.next_out=0,n.avail_out=a),(i===Je||i===Ye)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=Oe.deflate(n,i),s===tt)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=Oe.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===et;if(0!==n.avail_out){if(i>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},it.prototype.onData=function(e){this.chunks.push(e)},it.prototype.onEnd=function(e){e===et&&(this.result=$e(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ot={Deflate:it,deflate:rt,deflateRaw:function(e,t){return(t=t||{}).raw=!0,rt(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,rt(e,t)}};const lt=16209;var dt=function(e,t){let n,a,s,i,r,o,l,d,c,h,u,g,m,f,p,w,y,b,_,v,k,E,x,S;const L=e.state;n=e.next_in,x=e.input,a=n+(e.avail_in-5),s=e.next_out,S=e.output,i=s-(t-e.avail_out),r=s+(e.avail_out-257),o=L.dmax,l=L.wsize,d=L.whave,c=L.wnext,h=L.window,u=L.hold,g=L.bits,m=L.lencode,f=L.distcode,p=(1<<L.lenbits)-1,w=(1<<L.distbits)-1;e:do{g<15&&(u+=x[n++]<<g,g+=8,u+=x[n++]<<g,g+=8),y=m[u&p];t:for(;;){if(b=y>>>24,u>>>=b,g-=b,b=y>>>16&255,0===b)S[s++]=65535&y;else{if(!(16&b)){if(64&b){if(32&b){L.mode=16191;break e}e.msg="invalid literal/length code",L.mode=lt;break e}y=m[(65535&y)+(u&(1<<b)-1)];continue t}for(_=65535&y,b&=15,b&&(g<b&&(u+=x[n++]<<g,g+=8),_+=u&(1<<b)-1,u>>>=b,g-=b),g<15&&(u+=x[n++]<<g,g+=8,u+=x[n++]<<g,g+=8),y=f[u&w];;){if(b=y>>>24,u>>>=b,g-=b,b=y>>>16&255,16&b){if(v=65535&y,b&=15,g<b&&(u+=x[n++]<<g,g+=8,g<b&&(u+=x[n++]<<g,g+=8)),v+=u&(1<<b)-1,v>o){e.msg="invalid distance too far back",L.mode=lt;break e}if(u>>>=b,g-=b,b=s-i,v>b){if(b=v-b,b>d&&L.sane){e.msg="invalid distance too far back",L.mode=lt;break e}if(k=0,E=h,0===c){if(k+=l-b,b<_){_-=b;do{S[s++]=h[k++]}while(--b);k=s-v,E=S}}else if(c<b){if(k+=l+c-b,b-=c,b<_){_-=b;do{S[s++]=h[k++]}while(--b);if(k=0,c<_){b=c,_-=b;do{S[s++]=h[k++]}while(--b);k=s-v,E=S}}}else if(k+=c-b,b<_){_-=b;do{S[s++]=h[k++]}while(--b);k=s-v,E=S}for(;_>2;)S[s++]=E[k++],S[s++]=E[k++],S[s++]=E[k++],_-=3;_&&(S[s++]=E[k++],_>1&&(S[s++]=E[k++]))}else{k=s-v;do{S[s++]=S[k++],S[s++]=S[k++],S[s++]=S[k++],_-=3}while(_>2);_&&(S[s++]=S[k++],_>1&&(S[s++]=S[k++]))}break}if(64&b){e.msg="invalid distance code",L.mode=lt;break e}y=f[(65535&y)+(u&(1<<b)-1)]}}break}}while(n<a&&s<r);_=g>>3,n-=_,g-=_<<3,u&=(1<<g)-1,e.next_in=n,e.next_out=s,e.avail_in=n<a?a-n+5:5-(n-a),e.avail_out=s<r?r-s+257:257-(s-r),L.hold=u,L.bits=g};const ct=15,ht=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ut=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),gt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),mt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ft=(e,t,n,a,s,i,r,o)=>{const l=o.bits;let d,c,h,u,g,m,f=0,p=0,w=0,y=0,b=0,_=0,v=0,k=0,E=0,x=0,S=null;const L=new Uint16Array(16),I=new Uint16Array(16);let D,z,C,T=null;for(f=0;f<=ct;f++)L[f]=0;for(p=0;p<a;p++)L[t[n+p]]++;for(b=l,y=ct;y>=1&&0===L[y];y--);if(b>y&&(b=y),0===y)return s[i++]=20971520,s[i++]=20971520,o.bits=1,0;for(w=1;w<y&&0===L[w];w++);for(b<w&&(b=w),k=1,f=1;f<=ct;f++)if(k<<=1,k-=L[f],k<0)return-1;if(k>0&&(0===e||1!==y))return-1;for(I[1]=0,f=1;f<ct;f++)I[f+1]=I[f]+L[f];for(p=0;p<a;p++)0!==t[n+p]&&(r[I[t[n+p]]++]=p);if(0===e?(S=T=r,m=20):1===e?(S=ht,T=ut,m=257):(S=gt,T=mt,m=0),x=0,p=0,f=w,g=i,_=b,v=0,h=-1,E=1<<b,u=E-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){D=f-v,r[p]+1<m?(z=0,C=r[p]):r[p]>=m?(z=T[r[p]-m],C=S[r[p]-m]):(z=96,C=0),d=1<<f-v,c=1<<_,w=c;do{c-=d,s[g+(x>>v)+c]=D<<24|z<<16|C}while(0!==c);for(d=1<<f-1;x&d;)d>>=1;if(0!==d?(x&=d-1,x+=d):x=0,p++,0===--L[f]){if(f===y)break;f=t[n+r[p]]}if(f>b&&(x&u)!==h){for(0===v&&(v=b),g+=w,_=f-v,k=1<<_;_+v<y&&(k-=L[_+v],!(k<=0));)_++,k<<=1;if(E+=1<<_,1===e&&E>852||2===e&&E>592)return 1;h=x&u,s[h]=b<<24|_<<16|g-i}}return 0!==x&&(s[g+x]=f-v<<24|64<<16),o.bits=b,0};const{Z_FINISH:pt,Z_BLOCK:wt,Z_TREES:yt,Z_OK:bt,Z_STREAM_END:_t,Z_NEED_DICT:vt,Z_STREAM_ERROR:kt,Z_DATA_ERROR:Et,Z_MEM_ERROR:xt,Z_BUF_ERROR:St,Z_DEFLATED:Lt}=$,It=16180,Dt=16190,zt=16191,Ct=16192,Tt=16194,At=16199,Mt=16200,Bt=16206,Wt=16209,Nt=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Rt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ft=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<It||t.mode>16211?1:0},Ot=e=>{if(Ft(e))return kt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=It,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,bt},Ut=e=>{if(Ft(e))return kt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Ot(e)},Gt=(e,t)=>{let n;if(Ft(e))return kt;const a=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?kt:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=n,a.wbits=t,Ut(e))},$t=(e,t)=>{if(!e)return kt;const n=new Rt;e.state=n,n.strm=e,n.window=null,n.mode=It;const a=Gt(e,t);return a!==bt&&(e.state=null),a};let Zt,Vt,Ht=!0;const Pt=e=>{if(Ht){Zt=new Int32Array(512),Vt=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ft(1,e.lens,0,288,Zt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ft(2,e.lens,0,32,Vt,0,e.work,{bits:5}),Ht=!1}e.lencode=Zt,e.lenbits=9,e.distcode=Vt,e.distbits=5},qt=(e,t,n,a)=>{let s;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),a>=i.wsize?(i.window.set(t.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(s=i.wsize-i.wnext,s>a&&(s=a),i.window.set(t.subarray(n-a,n-a+s),i.wnext),(a-=s)?(i.window.set(t.subarray(n-a,n),0),i.wnext=a,i.whave=i.wsize):(i.wnext+=s,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=s))),0};var jt={inflateReset:Ut,inflateReset2:Gt,inflateResetKeep:Ot,inflateInit:e=>$t(e,15),inflateInit2:$t,inflate:(e,t)=>{let n,a,s,i,r,o,l,d,c,h,u,g,m,f,p,w,y,b,_,v,k,E,x=0;const S=new Uint8Array(4);let L,I;const D=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ft(e)||!e.output||!e.input&&0!==e.avail_in)return kt;n=e.state,n.mode===zt&&(n.mode=Ct),r=e.next_out,s=e.output,l=e.avail_out,i=e.next_in,a=e.input,o=e.avail_in,d=n.hold,c=n.bits,h=o,u=l,E=bt;e:for(;;)switch(n.mode){case It:if(0===n.wrap){n.mode=Ct;break}for(;c<16;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}if(2&n.wrap&&35615===d){0===n.wbits&&(n.wbits=15),n.check=0,S[0]=255&d,S[1]=d>>>8&255,n.check=U(n.check,S,2,0),d=0,c=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&d)<<8)+(d>>8))%31){e.msg="incorrect header check",n.mode=Wt;break}if((15&d)!==Lt){e.msg="unknown compression method",n.mode=Wt;break}if(d>>>=4,c-=4,k=8+(15&d),0===n.wbits&&(n.wbits=k),k>15||k>n.wbits){e.msg="invalid window size",n.mode=Wt;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&d?16189:zt,d=0,c=0;break;case 16181:for(;c<16;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}if(n.flags=d,(255&n.flags)!==Lt){e.msg="unknown compression method",n.mode=Wt;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Wt;break}n.head&&(n.head.text=d>>8&1),512&n.flags&&4&n.wrap&&(S[0]=255&d,S[1]=d>>>8&255,n.check=U(n.check,S,2,0)),d=0,c=0,n.mode=16182;case 16182:for(;c<32;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}n.head&&(n.head.time=d),512&n.flags&&4&n.wrap&&(S[0]=255&d,S[1]=d>>>8&255,S[2]=d>>>16&255,S[3]=d>>>24&255,n.check=U(n.check,S,4,0)),d=0,c=0,n.mode=16183;case 16183:for(;c<16;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}n.head&&(n.head.xflags=255&d,n.head.os=d>>8),512&n.flags&&4&n.wrap&&(S[0]=255&d,S[1]=d>>>8&255,n.check=U(n.check,S,2,0)),d=0,c=0,n.mode=16184;case 16184:if(1024&n.flags){for(;c<16;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}n.length=d,n.head&&(n.head.extra_len=d),512&n.flags&&4&n.wrap&&(S[0]=255&d,S[1]=d>>>8&255,n.check=U(n.check,S,2,0)),d=0,c=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(g=n.length,g>o&&(g=o),g&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(a.subarray(i,i+g),k)),512&n.flags&&4&n.wrap&&(n.check=U(n.check,a,g,i)),o-=g,i+=g,n.length-=g),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;g=0;do{k=a[i+g++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&g<o);if(512&n.flags&&4&n.wrap&&(n.check=U(n.check,a,g,i)),o-=g,i+=g,k)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;g=0;do{k=a[i+g++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&g<o);if(512&n.flags&&4&n.wrap&&(n.check=U(n.check,a,g,i)),o-=g,i+=g,k)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;c<16;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}if(4&n.wrap&&d!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Wt;break}d=0,c=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=zt;break;case 16189:for(;c<32;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}e.adler=n.check=Nt(d),d=0,c=0,n.mode=Dt;case Dt:if(0===n.havedict)return e.next_out=r,e.avail_out=l,e.next_in=i,e.avail_in=o,n.hold=d,n.bits=c,vt;e.adler=n.check=1,n.mode=zt;case zt:if(t===wt||t===yt)break e;case Ct:if(n.last){d>>>=7&c,c-=7&c,n.mode=Bt;break}for(;c<3;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}switch(n.last=1&d,d>>>=1,c-=1,3&d){case 0:n.mode=16193;break;case 1:if(Pt(n),n.mode=At,t===yt){d>>>=2,c-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Wt}d>>>=2,c-=2;break;case 16193:for(d>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}if((65535&d)!=(d>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Wt;break}if(n.length=65535&d,d=0,c=0,n.mode=Tt,t===yt)break e;case Tt:n.mode=16195;case 16195:if(g=n.length,g){if(g>o&&(g=o),g>l&&(g=l),0===g)break e;s.set(a.subarray(i,i+g),r),o-=g,i+=g,l-=g,r+=g,n.length-=g;break}n.mode=zt;break;case 16196:for(;c<14;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}if(n.nlen=257+(31&d),d>>>=5,c-=5,n.ndist=1+(31&d),d>>>=5,c-=5,n.ncode=4+(15&d),d>>>=4,c-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Wt;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;c<3;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}n.lens[D[n.have++]]=7&d,d>>>=3,c-=3}for(;n.have<19;)n.lens[D[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,L={bits:n.lenbits},E=ft(0,n.lens,0,19,n.lencode,0,n.work,L),n.lenbits=L.bits,E){e.msg="invalid code lengths set",n.mode=Wt;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;x=n.lencode[d&(1<<n.lenbits)-1],p=x>>>24,w=x>>>16&255,y=65535&x,!(p<=c);){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}if(y<16)d>>>=p,c-=p,n.lens[n.have++]=y;else{if(16===y){for(I=p+2;c<I;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}if(d>>>=p,c-=p,0===n.have){e.msg="invalid bit length repeat",n.mode=Wt;break}k=n.lens[n.have-1],g=3+(3&d),d>>>=2,c-=2}else if(17===y){for(I=p+3;c<I;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}d>>>=p,c-=p,k=0,g=3+(7&d),d>>>=3,c-=3}else{for(I=p+7;c<I;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}d>>>=p,c-=p,k=0,g=11+(127&d),d>>>=7,c-=7}if(n.have+g>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Wt;break}for(;g--;)n.lens[n.have++]=k}}if(n.mode===Wt)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Wt;break}if(n.lenbits=9,L={bits:n.lenbits},E=ft(1,n.lens,0,n.nlen,n.lencode,0,n.work,L),n.lenbits=L.bits,E){e.msg="invalid literal/lengths set",n.mode=Wt;break}if(n.distbits=6,n.distcode=n.distdyn,L={bits:n.distbits},E=ft(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,L),n.distbits=L.bits,E){e.msg="invalid distances set",n.mode=Wt;break}if(n.mode=At,t===yt)break e;case At:n.mode=Mt;case Mt:if(o>=6&&l>=258){e.next_out=r,e.avail_out=l,e.next_in=i,e.avail_in=o,n.hold=d,n.bits=c,dt(e,u),r=e.next_out,s=e.output,l=e.avail_out,i=e.next_in,a=e.input,o=e.avail_in,d=n.hold,c=n.bits,n.mode===zt&&(n.back=-1);break}for(n.back=0;x=n.lencode[d&(1<<n.lenbits)-1],p=x>>>24,w=x>>>16&255,y=65535&x,!(p<=c);){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}if(w&&!(240&w)){for(b=p,_=w,v=y;x=n.lencode[v+((d&(1<<b+_)-1)>>b)],p=x>>>24,w=x>>>16&255,y=65535&x,!(b+p<=c);){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}d>>>=b,c-=b,n.back+=b}if(d>>>=p,c-=p,n.back+=p,n.length=y,0===w){n.mode=16205;break}if(32&w){n.back=-1,n.mode=zt;break}if(64&w){e.msg="invalid literal/length code",n.mode=Wt;break}n.extra=15&w,n.mode=16201;case 16201:if(n.extra){for(I=n.extra;c<I;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,c-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;x=n.distcode[d&(1<<n.distbits)-1],p=x>>>24,w=x>>>16&255,y=65535&x,!(p<=c);){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}if(!(240&w)){for(b=p,_=w,v=y;x=n.distcode[v+((d&(1<<b+_)-1)>>b)],p=x>>>24,w=x>>>16&255,y=65535&x,!(b+p<=c);){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}d>>>=b,c-=b,n.back+=b}if(d>>>=p,c-=p,n.back+=p,64&w){e.msg="invalid distance code",n.mode=Wt;break}n.offset=y,n.extra=15&w,n.mode=16203;case 16203:if(n.extra){for(I=n.extra;c<I;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,c-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Wt;break}n.mode=16204;case 16204:if(0===l)break e;if(g=u-l,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Wt;break}g>n.wnext?(g-=n.wnext,m=n.wsize-g):m=n.wnext-g,g>n.length&&(g=n.length),f=n.window}else f=s,m=r-n.offset,g=n.length;g>l&&(g=l),l-=g,n.length-=g;do{s[r++]=f[m++]}while(--g);0===n.length&&(n.mode=Mt);break;case 16205:if(0===l)break e;s[r++]=n.length,l--,n.mode=Mt;break;case Bt:if(n.wrap){for(;c<32;){if(0===o)break e;o--,d|=a[i++]<<c,c+=8}if(u-=l,e.total_out+=u,n.total+=u,4&n.wrap&&u&&(e.adler=n.check=n.flags?U(n.check,s,u,r-u):F(n.check,s,u,r-u)),u=l,4&n.wrap&&(n.flags?d:Nt(d))!==n.check){e.msg="incorrect data check",n.mode=Wt;break}d=0,c=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;c<32;){if(0===o)break e;o--,d+=a[i++]<<c,c+=8}if(4&n.wrap&&d!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Wt;break}d=0,c=0}n.mode=16208;case 16208:E=_t;break e;case Wt:E=Et;break e;case 16210:return xt;default:return kt}return e.next_out=r,e.avail_out=l,e.next_in=i,e.avail_in=o,n.hold=d,n.bits=c,(n.wsize||u!==e.avail_out&&n.mode<Wt&&(n.mode<Bt||t!==pt))&&qt(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,n.total+=u,4&n.wrap&&u&&(e.adler=n.check=n.flags?U(n.check,s,u,e.next_out-u):F(n.check,s,u,e.next_out-u)),e.data_type=n.bits+(n.last?64:0)+(n.mode===zt?128:0)+(n.mode===At||n.mode===Tt?256:0),(0===h&&0===u||t===pt)&&E===bt&&(E=St),E},inflateEnd:e=>{if(Ft(e))return kt;let t=e.state;return t.window&&(t.window=null),e.state=null,bt},inflateGetHeader:(e,t)=>{if(Ft(e))return kt;const n=e.state;return 2&n.wrap?(n.head=t,t.done=!1,bt):kt},inflateSetDictionary:(e,t)=>{const n=t.length;let a,s,i;return Ft(e)?kt:(a=e.state,0!==a.wrap&&a.mode!==Dt?kt:a.mode===Dt&&(s=1,s=F(s,t,n,0),s!==a.check)?Et:(i=qt(e,t,n,n),i?(a.mode=16210,xt):(a.havedict=1,bt)))},inflateInfo:"pako inflate (from Nodeca project)"};var Kt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Xt=Object.prototype.toString,{Z_NO_FLUSH:Jt,Z_FINISH:Yt,Z_OK:Qt,Z_STREAM_END:en,Z_NEED_DICT:tn,Z_STREAM_ERROR:nn,Z_DATA_ERROR:an,Z_MEM_ERROR:sn}=$;function rn(e){this.options=Ge({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new je,this.strm.avail_out=0;let n=jt.inflateInit2(this.strm,t.windowBits);if(n!==Qt)throw new Error(G[n]);if(this.header=new Kt,jt.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=He(t.dictionary):"[object ArrayBuffer]"===Xt.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=jt.inflateSetDictionary(this.strm,t.dictionary),n!==Qt)))throw new Error(G[n])}function on(e,t){const n=new rn(t);if(n.push(e),n.err)throw n.msg||G[n.err];return n.result}rn.prototype.push=function(e,t){const n=this.strm,a=this.options.chunkSize,s=this.options.dictionary;let i,r,o;if(this.ended)return!1;for(r=t===~~t?t:!0===t?Yt:Jt,"[object ArrayBuffer]"===Xt.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(a),n.next_out=0,n.avail_out=a),i=jt.inflate(n,r),i===tn&&s&&(i=jt.inflateSetDictionary(n,s),i===Qt?i=jt.inflate(n,r):i===an&&(i=tn));n.avail_in>0&&i===en&&n.state.wrap>0&&0!==e[n.next_in];)jt.inflateReset(n),i=jt.inflate(n,r);switch(i){case nn:case an:case tn:case sn:return this.onEnd(i),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||i===en))if("string"===this.options.to){let e=qe(n.output,n.next_out),t=n.next_out-e,s=Pe(n.output,e);n.next_out=t,n.avail_out=a-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(i!==Qt||0!==o){if(i===en)return i=jt.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},rn.prototype.onData=function(e){this.chunks.push(e)},rn.prototype.onEnd=function(e){e===Qt&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=$e(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ln={Inflate:rn,inflate:on,inflateRaw:function(e,t){return(t=t||{}).raw=!0,on(e,t)},ungzip:on};const{Deflate:dn,deflate:cn,deflateRaw:hn,gzip:un}=ot,{Inflate:gn,inflate:mn,inflateRaw:fn,ungzip:pn}=ln;var wn={Deflate:dn,deflate:cn,deflateRaw:hn,gzip:un,Inflate:gn,inflate:mn,inflateRaw:fn,ungzip:pn,constants:$};class yn{constructor(e){this.SQL=e,this.db=null,this.metadata=null,this.loadedChunks=new Set,this.loadingProgress=0,this.totalBytes=0,this.loadedBytes=0,this.isInitialized=!1,this.listeners={progress:[],chunkLoaded:[],complete:[],error:[]},this.dbName="WordDiscovererCache",this.dbVersion=1,this.cacheDB=null}async initializeCache(){return new Promise((e,t)=>{const n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>{console.warn("Failed to open IndexedDB, continuing without cache"),e(null)},n.onsuccess=t=>{this.cacheDB=t.target.result,console.log("✅ IndexedDB cache initialized"),e(this.cacheDB)},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains("chunks")||t.createObjectStore("chunks",{keyPath:"chunkNumber"}),t.objectStoreNames.contains("metadata")||t.createObjectStore("metadata",{keyPath:"key"})}})}async saveChunkToCache(e,t){if(this.cacheDB)return new Promise((n,a)=>{const s=this.cacheDB.transaction(["chunks"],"readwrite").objectStore("chunks").put({chunkNumber:e,data:t,timestamp:Date.now()});s.onsuccess=()=>n(),s.onerror=()=>{console.warn(`Failed to cache chunk ${e}`),n()}})}async loadChunkFromCache(e){return this.cacheDB?new Promise((t,n)=>{const a=this.cacheDB.transaction(["chunks"],"readonly").objectStore("chunks").get(e);a.onsuccess=n=>{const a=n.target.result;a&&a.data?(console.log(`✅ Loaded chunk ${e} from cache`),t(a.data)):t(null)},a.onerror=()=>t(null)}):null}async saveMetadataToCache(e){if(this.cacheDB)return new Promise((t,n)=>{const a=this.cacheDB.transaction(["metadata"],"readwrite").objectStore("metadata").put({key:"metadata",data:e,timestamp:Date.now()});a.onsuccess=()=>t(),a.onerror=()=>t()})}async loadMetadataFromCache(){return this.cacheDB?new Promise((e,t)=>{const n=this.cacheDB.transaction(["metadata"],"readonly").objectStore("metadata").get("metadata");n.onsuccess=t=>{const n=t.target.result;n&&n.data?(console.log("✅ Loaded metadata from cache"),e(n.data)):e(null)},n.onerror=()=>e(null)}):null}async isChunkCached(e){return null!==await this.loadChunkFromCache(e)}async initialize(){try{console.log("🚀 Initializing Progressive Database Loader..."),await this.initializeCache();let e=await this.loadMetadataFromCache();if(!e){const t="/db-chunks/metadata.json";console.log("📥 Fetching metadata...");const n=await fetch(t);if(!n.ok)throw new Error(`Failed to load metadata: ${n.status}`);e=await n.json(),await this.saveMetadataToCache(e)}return this.metadata=e,this.totalBytes=e.chunks.reduce((e,t)=>e+t.sizeBytes,0),console.log(`📊 Metadata loaded: ${e.totalChunks} chunks, ${e.totalWords.toLocaleString()} words`),this.db=new this.SQL.Database,this.db.exec("\n                CREATE TABLE words (\n                    id INTEGER PRIMARY KEY AUTOINCREMENT,\n                    word TEXT NOT NULL,\n                    phonetic TEXT,\n                    definition TEXT,\n                    translation TEXT,\n                    pos TEXT,\n                    collins INTEGER DEFAULT 0,\n                    oxford INTEGER DEFAULT 0,\n                    tag TEXT,\n                    bnc INTEGER DEFAULT 0,\n                    frq INTEGER DEFAULT 0,\n                    exchange TEXT,\n                    detail TEXT,\n                    audio TEXT\n                );\n                CREATE INDEX idx_word ON words(word);\n            "),this.isInitialized=!0,this.emit("progress",{loaded:0,total:this.totalBytes,percentage:0,message:"Initialized"}),!0}catch(e){return console.error("Error initializing progressive loader:",e),this.emit("error",e),!1}}async loadChunk(e){if(!this.isInitialized)throw new Error("Loader not initialized");if(this.loadedChunks.has(e))return console.log(`⚠️ Chunk ${e} already loaded`),!0;try{const t=this.metadata.chunks.find(t=>t.chunkNumber===e);if(!t)throw new Error(`Chunk ${e} not found in metadata`);console.log(`📥 Loading chunk ${e}/${this.metadata.totalChunks} (${t.wordCount.toLocaleString()} words)...`);let n=await this.loadChunkFromCache(e);if(!n){const a=`/db-chunks/${t.filename}`,s=await fetch(a);if(!s.ok)throw new Error(`Failed to load chunk ${e}: ${s.status}`);let i=await s.arrayBuffer();if("gzip"===s.headers.get("Content-Encoding")||i.byteLength>1.5*t.sizeBytes)n=i;else{const e=new Uint8Array(i);n=wn.ungzip(e).buffer}await this.saveChunkToCache(e,n)}const a=new this.SQL.Database(new Uint8Array(n)),s=a.exec("SELECT word, phonetic, definition, translation, pos, collins, oxford, tag, bnc, frq, exchange, detail, audio FROM words");if(s.length>0&&s[0].values.length>0){const e=this.db.prepare("\n                    INSERT INTO words (word, phonetic, definition, translation, pos, collins, oxford, tag, bnc, frq, exchange, detail, audio)\n                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n                ");for(const t of s[0].values)e.run(t);e.free()}return a.close(),this.loadedChunks.add(e),this.loadedBytes+=t.sizeBytes,this.loadingProgress=this.loadedBytes/this.totalBytes*100,console.log(`✅ Chunk ${e} loaded (${this.loadingProgress.toFixed(1)}% complete)`),this.emit("chunkLoaded",{chunkNumber:e,loaded:this.loadedChunks.size,total:this.metadata.totalChunks,percentage:this.loadingProgress}),this.emit("progress",{loaded:this.loadedBytes,total:this.totalBytes,percentage:this.loadingProgress,message:`Loaded chunk ${e}/${this.metadata.totalChunks}`}),!0}catch(t){return console.error(`Error loading chunk ${e}:`,t),console.error("Error stack:",t.stack),console.error("Error details:",{message:t.message,name:t.name,chunkNumber:e}),this.emit("error",t),!1}}async loadAllChunks(){this.isInitialized||await this.initialize(),console.log("📚 Starting progressive database loading...");for(let e=1;e<=this.metadata.totalChunks;e++)await this.loadChunk(e);return console.log("✨ All chunks loaded successfully!"),this.emit("complete",{totalChunks:this.metadata.totalChunks,totalWords:this.metadata.totalWords}),!0}async loadPriorityChunks(e=3){this.isInitialized||await this.initialize(),console.log(`📚 Loading ${e} priority chunks...`);for(let t=1;t<=Math.min(e,this.metadata.totalChunks);t++)await this.loadChunk(t);return e<this.metadata.totalChunks&&this.loadRemainingChunksInBackground(e+1),!0}async loadRemainingChunksInBackground(e){console.log(`🔄 Loading remaining chunks in background starting from ${e}...`);for(let t=e;t<=this.metadata.totalChunks;t++)await this.loadChunk(t),await new Promise(e=>setTimeout(e,100));console.log("✨ All chunks loaded successfully!"),this.emit("complete",{totalChunks:this.metadata.totalChunks,totalWords:this.metadata.totalWords})}getDatabase(){return this.db}isReady(){return this.isInitialized&&this.loadedChunks.size>0}getProgress(){return{percentage:this.loadingProgress,loadedChunks:this.loadedChunks.size,totalChunks:this.metadata?this.metadata.totalChunks:0,loadedBytes:this.loadedBytes,totalBytes:this.totalBytes}}on(e,t){this.listeners[e]&&this.listeners[e].push(t)}emit(e,t){this.listeners[e]&&this.listeners[e].forEach(e=>e(t))}close(){this.db&&(this.db.close(),this.db=null),this.cacheDB&&(this.cacheDB.close(),this.cacheDB=null)}}class bn{constructor(){this.db=null,this.isLoaded=!1,this.queryCache=new Map,this.SQL=null,this.progressiveLoader=null,this.progressCallback=null}setProgressCallback(e){this.progressCallback=e}async initialize(){try{let t;console.log("Initializing sql.js...");t=(await function(t,n){let a=Promise.resolve();if(n&&n.length>0){let t=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),i=s?.nonce||s?.getAttribute("nonce");a=t(n.map(t=>{if((t=function(e){return"/"+e}(t))in e)return;e[t]=!0;const n=t.endsWith(".css"),a=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${a}`))return;const s=document.createElement("link");return s.rel=n?"stylesheet":"modulepreload",n||(s.as="script"),s.crossOrigin="",s.href=t,i&&s.setAttribute("nonce",i),document.head.appendChild(s),n?new Promise((e,n)=>{s.addEventListener("load",e),s.addEventListener("error",()=>n(new Error(`Unable to preload CSS for ${t}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(e=>{for(const t of e||[])"rejected"===t.status&&s(t.reason);return t().catch(s)})}(()=>import("./sql-wasm-DAuD2IuQ.js").then(e=>e.s),[])).default;this.SQL=await t({locateFile:e=>`/assets/${e}`}),console.log("🚀 Using progressive database loading..."),this.progressiveLoader=new yn(this.SQL),this.progressiveLoader.on("progress",e=>{this.progressCallback&&this.progressCallback(e)}),this.progressiveLoader.on("chunkLoaded",e=>{console.log(`✅ Chunk ${e.chunkNumber} loaded (${e.percentage.toFixed(1)}% complete)`)}),this.progressiveLoader.on("complete",e=>{console.log(`✨ All database chunks loaded! Total: ${e.totalWords.toLocaleString()} words`)}),this.progressiveLoader.on("error",e=>{console.error("Progressive loader error:",e)}),await this.progressiveLoader.initialize(),await this.progressiveLoader.loadPriorityChunks(3),this.db=this.progressiveLoader.getDatabase();const n=this.db.exec("SELECT COUNT(*) as count FROM words LIMIT 1");if(n.length>0){const e=n[0].values[0][0];console.log(`ECDICT database ready with ${e.toLocaleString()} words (loading more in background...)`)}return this.isLoaded=!0,!0}catch(t){return console.error("Error loading ECDICT database:",t),this.isLoaded=!1,!1}}queryWord(e){if(!this.isLoaded||!this.db)return null;const t=e.toLowerCase();if(this.queryCache.has(t))return this.queryCache.get(t);try{const e=this.db.exec("SELECT word, phonetic, definition, translation, pos, collins, oxford, tag, bnc, frq, exchange, detail \n                 FROM words \n                 WHERE LOWER(word) = ? \n                 LIMIT 1",[t]);if(e.length>0&&e[0].values.length>0){const n=e[0].values[0],a={word:n[0],phonetic:n[1]||"",definition:n[2]||"",translation:n[3]||"",pos:n[4]||"",collins:parseInt(n[5])||0,oxford:"1"===n[6]||1===n[6],tag:n[7]||"",bnc:parseInt(n[8])||0,frq:parseInt(n[9])||0,exchange:n[10]||"",detail:n[11]||""};if(this.queryCache.set(t,a),this.queryCache.size>1e4){const e=this.queryCache.keys().next().value;this.queryCache.delete(e)}return a}return null}catch(n){return console.error("Error querying word:",e,n),null}}parseExchange(e){const t={p:null,d:null,i:null,3:null,r:null,t:null,s:null,0:null,1:null};if(!e)return t;const n=e.split("/");for(const a of n){const[e,n]=a.split(":");e&&n&&(t[e]=n)}return t}getWordDifficulty(e){const t=this.queryWord(e);if(!t)return{level:"common",score:0,className:"common",info:null};let n="expert",a=100;const s=t.tag||"";return 1===t.oxford?(n="common",a=0):t.collins>=5?(n="common",a=10):t.collins>=4||s.includes("zk")||s.includes("gk")||s.includes("cet4")?(n="beginner",a=25):t.collins>=3||s.includes("cet6")?(n="intermediate",a=50):t.collins>=1||s.includes("ielts")||s.includes("toefl")?(n="advanced",a=75):t.bnc>0&&t.bnc<2e4?(n="common",a=15):t.bnc>0&&t.bnc<5e4?(n="beginner",a=30):t.bnc>0&&t.bnc<1e5&&(n="intermediate",a=55),{level:n,score:a,className:n,info:t}}findByLemma(e){if(!this.isLoaded||!this.db)return null;try{const t=this.db.exec("SELECT word, exchange \n                 FROM words \n                 WHERE exchange LIKE ? \n                 LIMIT 10",[`%${e}%`]);if(t.length>0&&t[0].values.length>0)for(const n of t[0].values){const t=n[0],a=n[1],s=this.parseExchange(a);for(const n of Object.values(s))if(n&&n.toLowerCase()===e.toLowerCase())return this.queryWord(t)}return null}catch(t){return console.error("Error finding lemma:",t),null}}fuzzyMatch(e,t=10){if(!this.isLoaded||!this.db)return[];try{const n=e.toLowerCase(),a=this.db.exec("SELECT word, phonetic, translation \n                 FROM words \n                 WHERE LOWER(word) LIKE ? \n                 LIMIT ?",[`${n}%`,t]);return a.length>0&&a[0].values.length>0?a[0].values.map(e=>({word:e[0],phonetic:e[1]||"",translation:e[2]||""})):[]}catch(n){return console.error("Error fuzzy matching:",n),[]}}isDatabaseLoaded(){return this.isLoaded}close(){this.db&&(this.db.close(),this.db=null,this.isLoaded=!1)}}class _n{constructor(e,t){this.wordDatabase=e,this.translationService=t,this.tokenizer=null,this.loadTokenizer()}async loadTokenizer(){try{if(!Intl.Segmenter)throw new Error("Intl.Segmenter not supported in this browser");this.tokenizer=new Intl.Segmenter(void 0,{granularity:"word"}),console.log("Intl.Segmenter loaded successfully")}catch(e){console.warn("Error loading Intl.Segmenter, falling back to simple extraction:",e),this.tokenizer={tokenize:e=>e.split(/\s+/).map(e=>({value:e,tag:"word"}))}}}extractWords(e){if(this.tokenizer&&this.tokenizer.segment){const t=this.tokenizer.segment(e);return Array.from(t).filter(e=>e.isWordLike).map(e=>e.segment).filter(e=>e.length>1).filter(e=>/^[a-zA-Z]+$/.test(e))}return e.split(/\s+/).filter(e=>e.length>1).filter(e=>/^[a-zA-Z]+$/.test(e))}analyzeWords(e,t,n,a){const s={totalWords:e.length,highlightedWords:[],newWords:[],difficultyScore:0,wordFrequency:{}},{learning:i,mastered:r}=a;e.forEach(e=>{const t=e.toLowerCase();s.wordFrequency[t]=(s.wordFrequency[t]||0)+1});const o=[...new Set(e.map(e=>e.toLowerCase()))];return o.forEach(a=>{const o=e.find(e=>e.toLowerCase()===a)||a,l=this.wordDatabase.getWordDifficulty(a),d=r.has(a),c=i.has(a);!d&&(c||this.shouldHighlight(a,l,n,i,t))&&(s.highlightedWords.push({word:o,difficulty:l,frequency:s.wordFrequency[a],translation:this.getTranslation(o)}),i.has(a)||s.newWords.push(a)),s.difficultyScore+=l.score}),s.difficultyScore=o.length>0?Math.round(s.difficultyScore/o.length):0,s}shouldHighlight(e,t,n,a,s){const i={common:0,beginner:1,intermediate:2,advanced:3,expert:4,unknown:5},r=i[t.level]>i[s];switch(n){case"unknown":return r&&!a.has(e);case"difficult":return r;case"all":return!0;default:return!1}}getTranslation(e){if(!this.wordDatabase.isDatabaseLoaded())return'<div class="word-info"><p>数据库未加载</p></div>';const t=e.toLowerCase();let n=this.wordDatabase.queryWord(t);if(n||(n=this.wordDatabase.findByLemma(t)),!n)return`<div class="word-info">\n                <h3>${e}</h3>\n                <p class="no-translation">未找到释义</p>\n            </div>`;let a='<div class="word-info ecdict-entry">';if(a+=`<h3>${n.word}`,n.phonetic&&(a+=` <span class="phonetic">/${n.phonetic}/</span>`),a+="</h3>",(n.collins>0||n.oxford)&&(a+='<div class="word-meta">',n.collins>0&&(a+=`<span class="collins-stars">${"★".repeat(n.collins)}</span>`),n.oxford&&(a+='<span class="oxford-badge">Oxford 3000</span>'),a+="</div>"),n.tag){const e=n.tag.split(" ").filter(e=>e);if(e.length>0){a+='<div class="word-tags">';const t={zk:"中考",gk:"高考",cet4:"CET-4",cet6:"CET-6",ielts:"IELTS",toefl:"TOEFL",gre:"GRE",tem4:"TEM-4",tem8:"TEM-8"};e.forEach(e=>{const n=t[e]||e;a+=`<span class="tag">${n}</span>`}),a+="</div>"}}if(n.translation){a+='<div class="translation">';n.translation.split("\\n").forEach(e=>{e.trim()&&(a+=`<p>${this.escapeHtml(e)}</p>`)}),a+="</div>"}if(n.definition){a+='<div class="definition">',a+="<h4>Definition:</h4>";n.definition.split("\\n").forEach(e=>{e.trim()&&(a+=`<p>${this.escapeHtml(e)}</p>`)}),a+="</div>"}if(n.exchange){const e=this.wordDatabase.parseExchange(n.exchange),t={p:"过去式",d:"过去分词",i:"现在分词",3:"第三人称单数",r:"比较级",t:"最高级",s:"复数",0:"原形"},s=[];for(const[n,a]of Object.entries(e))a&&t[n]&&s.push(`${t[n]}: ${a}`);s.length>0&&(a+='<div class="word-forms">',a+="<h4>词形变化:</h4>",a+=`<p>${s.join(" | ")}</p>`,a+="</div>")}return(n.bnc>0||n.frq>0)&&(a+='<div class="word-frequency">',n.bnc>0&&(a+=`<span>BNC词频: ${n.bnc.toLocaleString()}</span>`),n.frq>0&&(a+=`<span>当代词频: ${n.frq.toLocaleString()}</span>`),a+="</div>"),a+="</div>",a}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}processTextForDisplay(e,t){const n=new Map(t.highlightedWords.map(e=>[e.word.toLowerCase(),e]));return e.split(/(\b[a-zA-Z-]+\b)/).map(e=>{const t=e.toLowerCase();if(!/\b[a-zA-Z-]+\b/.test(t))return e;const a=n.get(t),s=this.getTranslation(e);let i="word-span";a&&(i+=` highlighted-word ${a.difficulty.className}`);return`<span class="${i}" data-word="${e}" data-translation="${s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}">${e}</span>`}).join("")}calculateComplexityMetrics(e,t){const n=[...new Set(e)],a={totalWords:e.length,uniqueWords:n.length,averageWordLength:0,difficultyDistribution:{common:0,beginner:0,intermediate:0,advanced:0,expert:0}},s=e.reduce((e,t)=>e+t.length,0);return a.averageWordLength=Math.round(s/e.length*10)/10,n.forEach(e=>{const n=this.wordDatabase.getWordDifficulty(e,t);a.difficultyDistribution[n.level]++}),a}}class vn{constructor(){this.clientId="781460731280-7moak9c5fq75dubjlnmes4b4gdku3qvt.apps.googleusercontent.com",this.scopes="https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email",this.isInitialized=!1,this.isSignedIn=!1,this.accessToken=null,this.fileId=null,this.gapiLoaded=!1}async initialize(){try{return await this._waitForGoogleIdentityServices(),await this._loadGoogleAPIClient(),this.isInitialized=!0,console.log("Google Drive API initialized successfully"),!0}catch(e){return console.error("Error initializing Google Drive API:",e),!1}}async signIn(e=!1){try{this.isInitialized||await this.initialize();const t=await this._getToken(e);return this.accessToken=t.access_token,this.isSignedIn=!0,await this._initializeGoogleAPIClient(),await this.findOrCreateVocabularyFile(),console.log("Successfully signed in to Google"),!0}catch(t){return console.error("Error signing in:",t),this.isSignedIn=!1,!1}}async signOut(){try{return this.accessToken&&window.google.accounts.oauth2.revoke(this.accessToken),this.isSignedIn=!1,this.accessToken=null,this.fileId=null,console.log("Successfully signed out from Google"),!0}catch(e){return console.error("Error signing out:",e),!1}}async findOrCreateVocabularyFile(){try{let e=await this._findFileInSpace("drive");return e?(this.fileId=e.id,console.log("Found existing vocabulary file in drive:",this.fileId),this.fileId):(e=await this._findFileInSpace("appDataFolder"),e?(this.fileId=e.id,console.warn("Found vocabulary file in hidden appDataFolder."),this.fileId):(this.fileId=await this._createFile(),console.log("Created new vocabulary file in root directory:",this.fileId),this.fileId))}catch(e){return console.error("Error finding/creating vocabulary file:",e),null}}async uploadVocabulary(e){try{if(!this.isSignedIn||!this.fileId)throw new Error("Not signed in or file not found");const t=JSON.stringify(e,null,2);return await gapi.client.request({path:`/upload/drive/v3/files/${this.fileId}`,method:"PATCH",params:{uploadType:"media"},headers:{"Content-Type":"application/json"},body:t}),console.log("Vocabulary uploaded successfully to Google Drive"),!0}catch(t){return console.error("Error uploading vocabulary:",t),403===t.status&&(console.log("Attempting to refresh access token..."),await this.refreshAccessToken(),this.uploadVocabulary(e))}}async downloadVocabulary(){if(!this.isSignedIn||!this.fileId)throw new Error("Not signed in or file not found");try{const e=await gapi.client.drive.files.get({fileId:this.fileId,alt:"media"});return e.body?(console.log("Vocabulary downloaded successfully from Google Drive"),JSON.parse(e.body)):null}catch(e){return console.error("Error downloading vocabulary:",e),null}}async syncVocabulary(e){if(!this.isSignedIn)return{success:!1,error:"Not signed in to Google"};try{const t=await this.downloadVocabulary();if(!t||!t.version){console.log("No remote data or old format found. Uploading local data.");return{success:await this.uploadVocabulary(e),action:"upload",data:e}}const n=this._mergeVocabularies(e,t);return await this.uploadVocabulary(n)?{success:!0,action:"merge",data:n}:{success:!1,action:"merge_fail",data:e,error:"Failed to upload merged vocabulary"}}catch(t){return console.error("Error syncing vocabulary:",t),{success:!1,error:t.message}}}getAuthStatus(){return{isInitialized:this.isInitialized,isSignedIn:this.isSignedIn,hasFile:!!this.fileId}}async getUserInfo(){if(!this.isSignedIn)return null;try{const e=(await gapi.client.people.people.get({resourceName:"people/me",personFields:"names,emailAddresses,photos"})).result;return{name:e.names&&e.names[0]?e.names[0].displayName:"Google User",email:e.emailAddresses&&e.emailAddresses[0]?e.emailAddresses[0].value:"",imageUrl:e.photos&&e.photos[0]?e.photos[0].url:null}}catch(e){return console.error("Error getting user info:",e),null}}_getToken(e=!1){return new Promise((t,n)=>{window.google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:this.scopes,callback:e=>e.error?n(new Error(e.error_description)):t(e)}).requestAccessToken({prompt:e?"none":""})})}async refreshAccessToken(){try{const e=await this._getToken(!0);return this.accessToken=e.access_token,gapi.client.setToken({access_token:this.accessToken}),console.log("Access token refreshed successfully"),!0}catch(e){return console.error("Token refresh error:",e),this.isSignedIn=!1,!1}}_waitForGoogleIdentityServices(){return new Promise((e,t)=>{if(window.google&&window.google.accounts)return e();const n=setTimeout(()=>t(new Error("Google Identity Services failed to load")),1e4),a=setInterval(()=>{window.google&&window.google.accounts&&(clearTimeout(n),clearInterval(a),e())},100)})}_loadGoogleAPIClient(){return new Promise((e,t)=>{if(window.gapi&&window.gapi.client)return e();const n=document.createElement("script");n.src="https://apis.google.com/js/api.js",n.onload=()=>gapi.load("client",e),n.onerror=t,document.head.appendChild(n)})}async _initializeGoogleAPIClient(){await gapi.client.init({discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest","https://people.googleapis.com/$discovery/rest?version=v1"]}),gapi.client.setToken({access_token:this.accessToken})}async _findFileInSpace(e){const t=await gapi.client.drive.files.list({q:"name='WordDiscoverer_Vocabulary.json' and trashed=false",spaces:e,fields:"files(id, name)"});return t.result.files&&t.result.files.length>0?t.result.files[0]:null}async _createFile(){return(await gapi.client.drive.files.create({resource:{name:"WordDiscoverer_Vocabulary.json",parents:["root"]},fields:"id"})).result.id}_mergeVocabularies(e,t){console.log("Performing two-way merge for vocabulary v2.0");const n=new Map(e.learningWords||[]),a=new Map(e.masteredWords||[]),s=new Map(t.learningWords||t.vocabulary||[]),i=new Map(t.masteredWords||[]),r=new Map([...s,...n]),o=new Map([...i,...a]);for(const l of a.keys())r.has(l)&&r.delete(l);for(const l of n.keys())o.has(l)&&o.delete(l);return{version:"2.0",exportDate:(new Date).toISOString(),learningWords:Array.from(r.entries()),masteredWords:Array.from(o.entries())}}}class kn{constructor(){const{learningWords:e,masteredWords:t}=this.loadVocabulary();this.learningWords=e,this.masteredWords=t,this.googleDriveManager=new vn,this.syncEnabled=!1,this.lastSyncTime=null,this.isSyncing=!1}addWord(e,t){return!this.isKnownWord(e)&&(this.learningWords.set(e,{translation:t,addedDate:(new Date).toISOString(),reviewCount:0,lastReviewed:null}),this.saveVocabulary(),!0)}masterWord(e,t){const n=e.toLowerCase();if(this.masteredWords.has(n))return"already_mastered";let a;return this.learningWords.has(n)?(a=this.learningWords.get(n),this.learningWords.delete(n),this.masteredWords.set(n,a),this.saveVocabulary(),"moved_to_mastered"):(a={translation:t,addedDate:(new Date).toISOString(),reviewCount:0,lastReviewed:null},this.masteredWords.set(n,a),this.saveVocabulary(),"added_to_mastered")}unmasterWord(e){const t=e.toLowerCase();if(this.masteredWords.has(t)){const e=this.masteredWords.get(t);return this.masteredWords.delete(t),this.learningWords.set(t,e),this.saveVocabulary(),"moved_to_learning"}return!1}removeWord(e){return this.learningWords.has(e)?(this.learningWords.delete(e),this.saveVocabulary(),!0):!!this.masteredWords.has(e)&&(this.masteredWords.delete(e),this.saveVocabulary(),!0)}isKnownWord(e){return this.learningWords.has(e)||this.masteredWords.has(e)}isMasteredWord(e){return this.masteredWords.has(e)}getWordData(e){return this.learningWords.get(e)||this.masteredWords.get(e)||null}getLearningWords(){return Array.from(this.learningWords.entries())}getMasteredWords(){return Array.from(this.masteredWords.entries())}getLearningSize(){return this.learningWords.size}getTotalSize(){return this.learningWords.size+this.masteredWords.size}clearVocabulary(){return this.learningWords.clear(),this.masteredWords.clear(),this.saveVocabulary(),!0}getSortedByDate(e){return Array.from(e.entries()).sort((e,t)=>new Date(t[1].addedDate)-new Date(e[1].addedDate))}updateReviewCount(e){const t=this.learningWords.get(e);return!!t&&(t.reviewCount++,t.lastReviewed=(new Date).toISOString(),this.saveVocabulary(),!0)}exportVocabulary(){return{version:"2.0",exportDate:(new Date).toISOString(),learningWords:Array.from(this.learningWords.entries()),masteredWords:Array.from(this.masteredWords.entries())}}importVocabulary(e){try{if("2.0"===e.version&&e.learningWords)this.learningWords=new Map(e.learningWords||[]),this.masteredWords=new Map(e.masteredWords||[]);else{if(!e.vocabulary||!Array.isArray(e.vocabulary))return!1;this.learningWords=new Map(e.vocabulary),this.masteredWords=new Map}return this.saveVocabulary(),!0}catch(t){return console.error("Error importing vocabulary:",t),!1}}getStatistics(){const e=[...Array.from(this.learningWords.values()),...Array.from(this.masteredWords.values())].reduce((e,t)=>e+t.reviewCount,0);return{learningWords:this.learningWords.size,masteredWords:this.masteredWords.size,totalWords:this.getTotalSize(),totalReviews:e}}loadVocabulary(){const e=localStorage.getItem("wordDiscovererVocabulary");if(!e)return{learningWords:new Map,masteredWords:new Map};try{const t=JSON.parse(e);if("2.0"===t.version)return{learningWords:new Map(t.learningWords||[]),masteredWords:new Map(t.masteredWords||[])};if(Array.isArray(t))return console.log("Migrating old vocabulary format to new v2.0 format."),{learningWords:new Map(t),masteredWords:new Map}}catch(t){console.error("Error loading vocabulary:",t)}return{learningWords:new Map,masteredWords:new Map}}saveVocabulary(){const e={version:"2.0",learningWords:Array.from(this.learningWords.entries()),masteredWords:Array.from(this.masteredWords.entries())};localStorage.setItem("wordDiscovererVocabulary",JSON.stringify(e)),this.syncEnabled&&!this.isSyncing&&this.syncToGoogleDrive()}async initializeGoogleDrive(){try{const e=await this.googleDriveManager.initialize();return e&&console.log("Google Drive integration initialized"),e}catch(e){return console.error("Error initializing Google Drive:",e),!1}}async enableGoogleDriveSync(e=!1){try{this.googleDriveManager.isInitialized||await this.initializeGoogleDrive();return!!(await this.googleDriveManager.signIn(e))&&(this.syncEnabled=!0,await this.syncToGoogleDrive(),console.log("Google Drive sync enabled"),!0)}catch(t){return console.error("Error enabling Google Drive sync:",t),!1}}async disableGoogleDriveSync(){try{return this.syncEnabled=!1,await this.googleDriveManager.signOut(),console.log("Google Drive sync disabled"),!0}catch(e){return console.error("Error disabling Google Drive sync:",e),!1}}async syncToGoogleDrive(){if(!this.syncEnabled||!this.googleDriveManager.isSignedIn||this.isSyncing)return!1;this.isSyncing=!0;try{const e=this.exportVocabulary(),t=await this.googleDriveManager.syncVocabulary(e);return t.success?("merge"===t.action?(this.importVocabulary(t.data),console.log("Vocabulary merged and synced with Google Drive"),window.wordDiscoverer&&window.wordDiscoverer.refreshTextAnalysis()):"download"===t.action?(this.importVocabulary(t.data),console.log("Vocabulary synced from Google Drive"),window.wordDiscoverer&&window.wordDiscoverer.refreshTextAnalysis()):"upload"===t.action&&console.log("Vocabulary uploaded to Google Drive"),this.lastSyncTime=(new Date).toISOString(),!0):(console.error("Sync failed:",t.error),!1)}catch(e){return console.error("Error syncing to Google Drive:",e),!1}finally{this.isSyncing=!1}}async forceSyncFromGoogleDrive(){try{if(!this.googleDriveManager.isSignedIn)return!1;const e=await this.googleDriveManager.downloadVocabulary();return!!e&&(this.importVocabulary(e),this.lastSyncTime=(new Date).toISOString(),console.log("Vocabulary force synced from Google Drive"),window.wordDiscoverer&&window.wordDiscoverer.refreshTextAnalysis(),!0)}catch(e){return console.error("Error force syncing from Google Drive:",e),!1}}async getGoogleDriveStatus(){const e=this.googleDriveManager.getAuthStatus(),t=await this.googleDriveManager.getUserInfo();return{syncEnabled:this.syncEnabled,isSignedIn:e.isSignedIn,hasFile:e.hasFile,lastSyncTime:this.lastSyncTime,userInfo:t}}getGoogleDriveManager(){return this.googleDriveManager}}class En{constructor(){this.settings=this.loadSettings()}getSetting(e){return this.settings[e]}setSetting(e,t){this.settings[e]=t,this.saveSettings()}getAllSettings(){return{...this.settings}}updateSettings(e){this.settings={...this.settings,...e},this.saveSettings()}resetToDefault(){this.settings=this.getDefaultSettings(),this.saveSettings()}exportSettings(){return{settings:this.settings,exportDate:(new Date).toISOString(),version:"1.0"}}importSettings(e){try{return!(!e.settings||"object"!=typeof e.settings)&&(this.settings={...this.getDefaultSettings(),...e.settings},this.saveSettings(),!0)}catch(t){return console.error("Error importing settings:",t),!1}}getDefaultSettings(){return{highlightColor:"#ffeb3b",highlightOpacity:.7,translationService:"bing",targetLanguage:"zh",difficultyLevel:"intermediate",highlightMode:"unknown",autoSave:!0,showTooltips:!0,theme:"light",fontSize:"medium",enableNotifications:!0,reviewReminder:!0,reviewInterval:7,googleDriveSync:!1}}validateSetting(e,t){const n={highlightColor:e=>/^#[0-9A-F]{6}$/i.test(e),highlightOpacity:e=>"number"==typeof e&&e>=0&&e<=1,translationService:e=>["bing","google","yandex"].includes(e),targetLanguage:e=>"string"==typeof e&&2===e.length,difficultyLevel:e=>["common","beginner","intermediate","advanced","expert"].includes(e),highlightMode:e=>["unknown","difficult","all"].includes(e),autoSave:e=>"boolean"==typeof e,showTooltips:e=>"boolean"==typeof e,theme:e=>["light","dark"].includes(e),fontSize:e=>["small","medium","large"].includes(e),enableNotifications:e=>"boolean"==typeof e,reviewReminder:e=>"boolean"==typeof e,reviewInterval:e=>"number"==typeof e&&e>0}[e];return!n||n(t)}getSettingMetadata(e){return{highlightColor:{type:"color",label:"Highlight Color",description:"Color used for highlighting words"},highlightOpacity:{type:"range",label:"Highlight Opacity",description:"Transparency of highlighted words",min:0,max:1,step:.1},translationService:{type:"select",label:"Translation Service",description:"Service used for translations",options:[{value:"bing",label:"Bing Translator"},{value:"google",label:"Google Translate"},{value:"yandex",label:"Yandex Translate"}]},targetLanguage:{type:"text",label:"Target Language",description:"Language code for translations (e.g., zh, es, fr)"},difficultyLevel:{type:"select",label:"Difficulty Level",description:"Base difficulty level for analysis",options:[{value:"common",label:"Common"},{value:"beginner",label:"Beginner"},{value:"intermediate",label:"Intermediate"},{value:"advanced",label:"Advanced"},{value:"expert",label:"Expert"}]},highlightMode:{type:"select",label:"Highlight Mode",description:"Which words to highlight",options:[{value:"unknown",label:"Unknown Words Only"},{value:"difficult",label:"Difficult Words"},{value:"all",label:"All Words"}]},theme:{type:"select",label:"Theme",description:"Application theme",options:[{value:"light",label:"Light"},{value:"dark",label:"Dark"}]},fontSize:{type:"select",label:"Font Size",description:"Text size preference",options:[{value:"small",label:"Small"},{value:"medium",label:"Medium"},{value:"large",label:"Large"}]}}[e]||null}loadSettings(){const e=this.getDefaultSettings(),t=localStorage.getItem("wordDiscovererSettings");if(t)try{const n=JSON.parse(t);return{...e,...n}}catch(n){console.error("Error loading settings:",n)}return e}saveSettings(){localStorage.setItem("wordDiscovererSettings",JSON.stringify(this.settings))}}class xn{constructor(e){this.element="string"==typeof e?document.querySelector(e):e}addEventListener(e,t,n){const a=this.element.querySelector(e);a&&a.addEventListener(t,n.bind(this))}show(){this.element&&(this.element.style.display="block")}hide(){this.element&&(this.element.style.display="none")}}class Sn extends xn{constructor(e,t){super(e),this.title=t,this.modalContent=null,this.element.innerHTML=this.render(),this.modalContent=this.element.querySelector(".modal-content"),this.element.addEventListener("click",e=>{e.target===this.element&&this.close()});const n=this.element.querySelector(".close-btn");n&&n.addEventListener("click",()=>this.close())}render(){return`\n            <div class="modal-content">\n                <div class="modal-header">\n                    <h2>${this.title}</h2>\n                    <button class="close-btn"><i class="fas fa-times"></i></button>\n                </div>\n                <div class="modal-body">\n                    \x3c!-- Content will be injected here --\x3e\n                </div>\n            </div>\n        `}open(e){const t=this.element.querySelector(".modal-body");t&&(t.innerHTML=e),this.element.offsetHeight,this.element.classList.add("show"),requestAnimationFrame(()=>{this.calculatePosition()})}close(){this.element.classList.remove("show")}calculatePosition(){const e=this.modalContent;if(!e)return;e.style.marginTop="",e.style.marginBottom="",e.offsetHeight;const t=window.innerHeight,n=e.offsetHeight;if(n<t){const a=Math.max(10,(t-n)/2);e.style.marginTop=`${a}px`,e.style.marginBottom="auto"}else e.style.marginTop="10px",e.style.marginBottom="10px"}}class Ln{constructor(e){this.vocabularyManager=e,this.modal=new Sn("#vocabularyModal","My Vocabulary"),this.app=null}setApp(e){this.app=e}open(){this.modal.open(this.renderContent()),this.addEventListeners(),this.updateAndRenderLists()}addEventListeners(){document.querySelectorAll(".vocab-tab").forEach(e=>{e.addEventListener("click",e=>this.handleTabClick(e))}),document.getElementById("exportVocabBtn").addEventListener("click",()=>this.onExportVocabulary()),document.getElementById("importVocabBtn").addEventListener("click",()=>document.getElementById("importFile").click()),document.getElementById("importFile").addEventListener("change",e=>this.onImportFileChange(e)),document.getElementById("clearVocabBtn").addEventListener("click",()=>this.onClearVocabulary())}renderContent(){return'\n            <div class="vocab-controls">\n                <button class="btn btn-primary" id="exportVocabBtn"><i class="fas fa-download"></i> Export</button>\n                <button class="btn btn-secondary" id="importVocabBtn"><i class="fas fa-upload"></i> Import</button>\n                <input type="file" id="importFile" accept=".json" style="display: none;">\n                <button class="btn btn-danger" id="clearVocabBtn"><i class="fas fa-trash"></i> Clear All</button>\n            </div>\n            <div class="vocab-tabs">\n                <button class="vocab-tab active" data-tab="learning">Learning (<span id="learning-count">0</span>)</button>\n                <button class="vocab-tab" data-tab="mastered">Mastered (<span id="mastered-count">0</span>)</button>\n            </div>\n            <div id="learning-list-container" class="vocab-tab-content active">\n                <div class="vocab-list" id="learning-list"></div>\n            </div>\n            <div id="mastered-list-container" class="vocab-tab-content">\n                <div class="vocab-list" id="mastered-list"></div>\n            </div>\n        '}updateAndRenderLists(){const e=document.getElementById("learning-list"),t=document.getElementById("mastered-list");if(!e||!t)return;const n=this.vocabularyManager.getSortedByDate(this.vocabularyManager.learningWords);this.renderList(e,n,"learning");const a=this.vocabularyManager.getSortedByDate(this.vocabularyManager.masteredWords);this.renderList(t,a,"mastered"),this.updateCounts()}renderList(e,t,n){e.innerHTML="",0!==t.length?(t.forEach(([t,a])=>{const s="learning"===n?`<button class="btn btn-sm btn-success master-btn" data-word="${t}"><i class="fas fa-check"></i> Master</button>`:`<button class="btn btn-sm btn-info unmaster-btn" data-word="${t}"><i class="fas fa-undo"></i> Learn</button>`,i=document.createElement("div");i.className="vocab-item",i.innerHTML=`\n                <div>\n                    <div class="vocab-word">${t}</div>\n                    <div class="vocab-translation">${a.translation}</div>\n                    <div class="vocab-meta">Added: ${new Date(a.addedDate).toLocaleDateString()}</div>\n                </div>\n                <div class="vocab-actions">\n                    ${s}\n                    <button class="btn btn-sm btn-danger delete-btn" data-word="${t}"><i class="fas fa-trash"></i></button>\n                </div>\n            `,e.appendChild(i)}),e.querySelectorAll(".master-btn").forEach(e=>e.addEventListener("click",e=>this.masterWord(e.currentTarget.dataset.word))),e.querySelectorAll(".unmaster-btn").forEach(e=>e.addEventListener("click",e=>this.unmasterWord(e.currentTarget.dataset.word))),e.querySelectorAll(".delete-btn").forEach(e=>e.addEventListener("click",e=>this.removeFromVocabulary(e.currentTarget.dataset.word)))):e.innerHTML='<p style="text-align: center; color: #6b7280; padding: 2rem;">No words in this list yet.</p>'}updateCounts(){const e=this.vocabularyManager.getLearningSize(),t=this.vocabularyManager.masteredWords.size,n=document.getElementById("vocabCount");n&&(n.textContent=e);const a=document.getElementById("learning-count");a&&(a.textContent=e);const s=document.getElementById("mastered-count");s&&(s.textContent=t)}handleTabClick(e){const t=e.target,n=t.dataset.tab;document.querySelectorAll(".vocab-tab").forEach(e=>e.classList.remove("active")),t.classList.add("active"),document.querySelectorAll(".vocab-tab-content").forEach(e=>e.classList.remove("active")),document.getElementById(`${n}-list-container`).classList.add("active")}masterWord(e){this.vocabularyManager.masterWord(e)&&(this.updateAndRenderLists(),this.app.showNotification(`'${e}' moved to mastered list.`),this.app.refreshTextAnalysis())}unmasterWord(e){this.vocabularyManager.unmasterWord(e)&&(this.updateAndRenderLists(),this.app.showNotification(`'${e}' moved back to learning list.`),this.app.refreshTextAnalysis())}removeFromVocabulary(e){confirm(`Are you sure you want to permanently delete "${e}"?`)&&this.vocabularyManager.removeWord(e)&&(this.updateAndRenderLists(),this.app.showNotification(`'${e}' has been deleted.`,"info"),this.app.refreshTextAnalysis())}onExportVocabulary(){const e=this.vocabularyManager.exportVocabulary();this.app.downloadJSON(e,"word-discoverer-vocabulary.json"),this.app.showNotification("Vocabulary exported successfully!")}onImportFileChange(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=e=>{try{const t=JSON.parse(e.target.result);this.vocabularyManager.importVocabulary(t)?(this.updateAndRenderLists(),this.app.showNotification("Vocabulary imported successfully!"),this.app.refreshTextAnalysis()):this.app.showNotification("Error importing vocabulary. Check file format.","error")}catch(t){this.app.showNotification("Error importing vocabulary. Check file format.","error")}},n.readAsText(t)}onClearVocabulary(){confirm("Clear all vocabulary (both learning and mastered)? This action cannot be undone.")&&(this.vocabularyManager.clearVocabulary(),this.updateAndRenderLists(),this.app.showNotification("All vocabulary has been cleared."),this.app.refreshTextAnalysis())}}class In{constructor(e,t){this.settingsManager=e,this.googleDriveManager=t,this.modal=new Sn("#settingsModal","Settings"),this.app=null,this.userInfo=null,this.lastSyncTime=null}setApp(e){this.app=e}open(){this.modal.open(this.renderContent()),this.loadSettingsToUI(),this.addEventListeners(),this.updateGoogleDriveStatus()}addEventListeners(){const e=document.getElementById("highlightOpacity");e&&e.addEventListener("input",e=>this.onOpacityChange(e));const t=document.getElementById("highlightColor");t&&t.addEventListener("change",e=>this.onColorChange(e));const n=document.getElementById("difficultyLevel");n&&n.addEventListener("change",e=>{this.settingsManager.setSetting("difficultyLevel",e.target.value);const t=document.getElementById("mainDifficultyLevel");t&&t.value!==e.target.value&&(t.value=e.target.value)});const a=document.getElementById("highlightMode");a&&a.addEventListener("change",e=>{this.settingsManager.setSetting("highlightMode",e.target.value);const t=document.getElementById("mainHighlightMode");t&&t.value!==e.target.value&&(t.value=e.target.value)});const s=document.getElementById("exportSettingsBtn");s&&s.addEventListener("click",()=>this.onExportSettings());const i=document.getElementById("importSettingsBtn");i&&i.addEventListener("click",()=>{const e=document.getElementById("importSettingsFile");e&&e.click()});const r=document.getElementById("importSettingsFile");r&&r.addEventListener("change",e=>this.onImportSettingsFileChange(e));const o=document.getElementById("enableGoogleDriveBtn");o&&o.addEventListener("click",()=>this.onEnableGoogleDrive());const l=document.getElementById("syncNowBtn");l&&l.addEventListener("click",()=>this.onSyncNow());const d=document.getElementById("disconnectGoogleDriveBtn");d&&d.addEventListener("click",()=>this.onDisconnectGoogleDrive())}renderContent(){return`\n            <div class="settings-section">\n                <h3>Highlighting</h3>\n                <div class="setting-item">\n                    <label for="highlightColor">Highlight Color:</label>\n                    <input type="color" id="highlightColor">\n                </div>\n                <div class="setting-item">\n                    <label for="highlightOpacity">Opacity:</label>\n                    <input type="range" id="highlightOpacity" min="0.1" max="1" step="0.1">\n                    <span id="opacityValue"></span>\n                </div>\n            </div>\n            <div class="settings-section">\n                <h3>Analysis</h3>\n                <div class="setting-item">\n                    <label for="difficultyLevel">Difficulty Level:</label>\n                    <select id="difficultyLevel">\n                        <option value="beginner">Beginner</option>\n                        <option value="intermediate">Intermediate</option>\n                        <option value="advanced">Advanced</option>\n                        <option value="expert">Expert</option>\n                    </select>\n                </div>\n                <div class="setting-item">\n                    <label for="highlightMode">Highlight Mode:</label>\n                    <select id="highlightMode">\n                        <option value="unknown">Unknown Words Only</option>\n                        <option value="difficult">Difficult Words</option>\n                        <option value="all">All Words</option>\n                    </select>\n                </div>\n            </div>\n            <div class="settings-section">\n                <h3>Google Drive Sync</h3>\n                \x3c!-- Google Drive UI will be rendered here --\x3e\n                <div id="google-drive-section">${this.renderGoogleDriveUI()}</div>\n            </div>\n            <div class="settings-section">\n                <h3>Data Management</h3>\n                <div class="setting-item">\n                    <button class="btn btn-primary" id="exportSettingsBtn"><i class="fas fa-download"></i> Export Settings</button>\n                    <button class="btn btn-secondary" id="importSettingsBtn"><i class="fas fa-upload"></i> Import Settings</button>\n                    <input type="file" id="importSettingsFile" accept=".json" style="display: none;">\n                </div>\n            </div>\n        `}renderGoogleDriveUI(){const e=this.googleDriveManager.getAuthStatus();return e.isInitialized?e.isSignedIn?`\n            <div class="google-drive-status">\n                <div class="user-info">\n                    ${this.userInfo&&this.userInfo.imageUrl?`<img src="${this.userInfo.imageUrl}" alt="User Avatar" class="user-avatar">`:'<div class="user-avatar-placeholder"><i class="fas fa-user"></i></div>'}\n                    <div class="user-details">\n                        <div class="user-name">${this.userInfo?.name||"Google User"}</div>\n                        <div class="user-email">${this.userInfo?.email||"No email provided"}</div>\n                    </div>\n                </div>\n                \n                <div class="sync-controls">\n                    <button class="btn btn-primary" id="syncNowBtn">\n                        <i class="fas fa-sync-alt"></i> Sync Now\n                    </button>\n                    <button class="btn btn-secondary" id="disconnectGoogleDriveBtn">\n                        <i class="fas fa-sign-out-alt"></i> Disconnect\n                    </button>\n                </div>\n                \n                ${this.lastSyncTime?`<div class="sync-info">\n                        <div class="last-sync">\n                            <i class="fas fa-check-circle"></i>\n                            <span>Last synced: ${new Date(this.lastSyncTime).toLocaleString()}</span>\n                        </div>\n                    </div>`:'<div class="sync-info">\n                        <div class="last-sync">\n                            <i class="fas fa-info-circle"></i>\n                            <span>Never synced</span>\n                        </div>\n                    </div>'}\n            </div>\n        `:'\n                <div class="google-drive-status">\n                    <div class="status-indicator">\n                        <i class="fas fa-unlink"></i>\n                        <span>Google Drive not connected</span>\n                    </div>\n                    <button class="btn btn-success" id="enableGoogleDriveBtn">\n                        <i class="fab fa-google"></i> Connect to Google Drive\n                    </button>\n                </div>\n            ':'\n                <div class="google-drive-status">\n                    <div class="status-indicator">\n                        <i class="fas fa-exclamation-circle"></i>\n                        <span>Google Drive not initialized</span>\n                    </div>\n                    <button class="btn btn-primary" id="enableGoogleDriveBtn">\n                        <i class="fab fa-google"></i> Initialize Google Drive\n                    </button>\n                </div>\n            '}async updateGoogleDriveStatus(){try{this.googleDriveManager.isSignedIn&&(this.userInfo=await this.googleDriveManager.getUserInfo());const e=document.getElementById("google-drive-section");e&&(e.innerHTML=this.renderGoogleDriveUI(),this.addEventListeners())}catch(e){console.error("Error updating Google Drive status:",e)}}loadSettingsToUI(){const e=this.settingsManager.getAllSettings();Object.entries(e).forEach(([e,t])=>{const n=document.getElementById(e);if(n)if("range"===n.type){n.value=t;const a=document.getElementById(e+"Value");a&&(a.textContent=Math.round(100*t)+"%")}else n.value=t});const t=document.getElementById("mainDifficultyLevel");t&&(t.value=e.difficultyLevel||"intermediate");const n=document.getElementById("mainHighlightMode");n&&(n.value=e.highlightMode||"unknown")}onOpacityChange(e){const t=parseFloat(e.target.value),n=document.getElementById("opacityValue");n&&(n.textContent=Math.round(100*t)+"%"),this.settingsManager.setSetting("highlightOpacity",t)}onColorChange(e){this.settingsManager.setSetting("highlightColor",e.target.value)}onExportSettings(){const e=this.settingsManager.exportSettings();this.app.downloadJSON(e,"settings.json"),this.app.showNotification("Settings exported successfully!")}onImportSettingsFileChange(e){const t=e.target.files[0];if(!t)return;const n=new FileReader;n.onload=e=>{try{const t=JSON.parse(e.target.result);this.settingsManager.importSettings(t)?(this.loadSettingsToUI(),this.app.showNotification("Settings imported successfully!")):this.app.showNotification("Error importing settings.","error")}catch(t){this.app.showNotification("Error importing settings.","error")}},n.readAsText(t)}async onEnableGoogleDrive(){try{const e=document.getElementById("enableGoogleDriveBtn");e&&(e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Connecting...',e.disabled=!0),this.googleDriveManager.isInitialized||await this.googleDriveManager.initialize();await this.googleDriveManager.signIn()?(this.app.showNotification("Successfully connected to Google Drive!"),await this.updateGoogleDriveStatus()):(this.app.showNotification("Failed to connect to Google Drive.","error"),e&&(e.innerHTML='<i class="fab fa-google"></i> Connect to Google Drive',e.disabled=!1))}catch(e){console.error("Error enabling Google Drive:",e),this.app.showNotification("Error connecting to Google Drive.","error");const t=document.getElementById("enableGoogleDriveBtn");t&&(t.innerHTML='<i class="fab fa-google"></i> Connect to Google Drive',t.disabled=!1)}}async onSyncNow(){try{const e=document.getElementById("syncNowBtn");if(e){const t=e.innerHTML;e.innerHTML='<i class="fas fa-spinner fa-spin"></i> Syncing...',e.disabled=!0;try{const e=this.app.vocabularyManager.exportVocabulary(),t=await this.googleDriveManager.syncVocabulary(e);t.success?(this.lastSyncTime=new Date,this.app.showNotification("Successfully synced with Google Drive!"),await this.updateGoogleDriveStatus(),"download"!==t.action&&"merge"!==t.action||(this.app.vocabularyManager.importVocabulary(t.data),this.app.updateCounts(),this.app.showNotification("Vocabulary updated from Google Drive!"))):this.app.showNotification("Failed to sync with Google Drive: "+t.error,"error")}finally{e.innerHTML=t,e.disabled=!1}}}catch(e){console.error("Error syncing with Google Drive:",e),this.app.showNotification("Error syncing with Google Drive.","error");const t=document.getElementById("syncNowBtn");t&&(t.innerHTML='<i class="fas fa-sync-alt"></i> Sync Now',t.disabled=!1)}}async onDisconnectGoogleDrive(){try{await this.googleDriveManager.signOut()?(this.userInfo=null,this.lastSyncTime=null,this.app.showNotification("Disconnected from Google Drive."),await this.updateGoogleDriveStatus()):this.app.showNotification("Failed to disconnect from Google Drive.","error")}catch(e){console.error("Error disconnecting from Google Drive:",e),this.app.showNotification("Error disconnecting from Google Drive.","error")}}}class Dn extends xn{constructor(e,t){super(e),this.vocabularyManager=t,this.app=null,this.currentWord=null,this.currentTranslation=null}setApp(e){this.app=e}render(e){this.element.innerHTML=e,this.addEventListeners()}addEventListeners(){this.element.addEventListener("click",e=>{if(e.target.classList.contains("word-span")){const t=e.target.dataset.word,n=e.target.dataset.translation;this.showWordModal(t,n,e)}})}showWordModal(e,t,n){this.currentWord=e,this.currentTranslation=t;const a=document.getElementById("wordModal");document.getElementById("wordModalContent");const s=document.getElementById("wordModalTitle"),i=document.getElementById("wordModalTranslation"),r=document.getElementById("wordModalActions");if(s.textContent=e,t.includes("<")&&t.includes(">")?i.innerHTML=t:i.textContent=t,r.innerHTML="",this.vocabularyManager.masteredWords.has(e)){const t=document.createElement("button");t.textContent="Move to Learning List",t.className="btn btn-secondary",t.onclick=()=>{this.handleWordUnmaster(e),this.closeWordModal()},r.appendChild(t)}else if(this.vocabularyManager.learningWords.has(e)){const n=document.createElement("button");n.textContent="Mark as Mastered",n.className="btn btn-primary",n.onclick=()=>{this.handleWordMaster(e,t),this.closeWordModal()},r.appendChild(n)}else{const n=document.createElement("button");n.textContent="Add to Learning List",n.className="btn btn-primary",n.onclick=()=>{this.handleWordAddToLearning(e,t),this.closeWordModal()},r.appendChild(n);const a=document.createElement("button");a.textContent="Add to Mastered List",a.className="btn btn-secondary",a.onclick=()=>{this.handleWordMaster(e,t),this.closeWordModal()},r.appendChild(a)}const o=document.createElement("button");o.textContent="Close",o.className="btn btn-outline",o.onclick=()=>this.closeWordModal(),r.appendChild(o),a.classList.add("show"),a.onclick=e=>{e.target===a&&this.closeWordModal()}}closeWordModal(){document.getElementById("wordModal").classList.remove("show")}handleWordAddToLearning(e,t){this.vocabularyManager.addWord(e,t)&&this.app.showNotification(`📖 '${e}' added to learning list.`),this.app.updateCounts(),this.refreshTextAnalysis()}handleWordMaster(e,t){const n=this.vocabularyManager.masterWord(e,t);"added_to_mastered"!==n&&"moved_to_mastered"!==n||this.app.showNotification(`✅ '${e}' marked as mastered.`),this.app.updateCounts(),this.refreshTextAnalysis()}handleWordUnmaster(e){"moved_to_learning"===this.vocabularyManager.unmasterWord(e)&&(this.app.showNotification(`📖 '${e}' moved to learning list.`),this.app.updateCounts()),this.refreshTextAnalysis()}refreshTextAnalysis(){const e=document.getElementById("textInput").value;if(!e)return;const t=this.app.performTextAnalysis(e),n=this.app.textAnalyzer.processTextForDisplay(e,t);this.render(n),this.app.updateStatistics&&this.app.updateStatistics(t)}}class zn{constructor(){this.settingsManager=new En,this.wordDatabase=new bn,this.vocabularyManager=new kn,this.textAnalyzer=new _n(this.wordDatabase),this.vocabularyComponent=new Ln(this.vocabularyManager),this.settingsComponent=new In(this.settingsManager,this.vocabularyManager.googleDriveManager),this.analyzedTextComponent=new Dn("#analyzedText",this.vocabularyManager),this.vocabularyComponent.setApp(this),this.settingsComponent.setApp(this),this.analyzedTextComponent.setApp(this),this.initialize()}async initialize(){this.addEventListeners(),this.updateCounts();const e=document.getElementById("dbLoadingOverlay"),t=document.getElementById("dbProgressBar"),n=document.getElementById("dbProgressPercentage"),a=document.getElementById("dbProgressChunks"),s=document.getElementById("dbLoadingMessage");e.classList.add("show"),this.wordDatabase.setProgressCallback(e=>{t.style.width=`${e.percentage.toFixed(1)}%`,n.textContent=`${e.percentage.toFixed(1)}%`,s.textContent=e.message||"Loading..."}),this.wordDatabase.progressiveLoader&&(this.wordDatabase.progressiveLoader.on("chunkLoaded",e=>{a.textContent=`${e.loaded}/${e.total} chunks`}),this.wordDatabase.progressiveLoader.on("complete",()=>{setTimeout(()=>{e.classList.remove("show")},1e3)})),await this.wordDatabase.initialize(),setTimeout(()=>{e.classList.remove("show")},500),console.log("WordDiscoverer initialized successfully")}addEventListeners(){document.getElementById("analyzeBtn").addEventListener("click",()=>this.analyzeText()),document.getElementById("vocabularyBtn").addEventListener("click",()=>this.vocabularyComponent.open()),document.getElementById("settingsBtn").addEventListener("click",()=>this.settingsComponent.open()),document.getElementById("clearBtn").addEventListener("click",()=>this.clearText());const e=document.getElementById("wordModalClose");e&&e.addEventListener("click",()=>{document.getElementById("wordModal").classList.remove("show")});const t=document.getElementById("mainDifficultyLevel");t&&t.addEventListener("change",e=>{this.settingsManager.setSetting("difficultyLevel",e.target.value),this.refreshTextAnalysis()});const n=document.getElementById("mainHighlightMode");n&&n.addEventListener("change",e=>{this.settingsManager.setSetting("highlightMode",e.target.value),this.refreshTextAnalysis()})}async analyzeText(){const e=document.getElementById("textInput").value.trim();if(!e)return void this.showNotification("Please enter some text to analyze.","error");const t=document.getElementById("loadingOverlay");t.classList.add("show");try{const t=this.performTextAnalysis(e),n=this.textAnalyzer.processTextForDisplay(e,t);this.analyzedTextComponent.render(n),document.getElementById("analyzedTextSection").style.display="block",document.getElementById("statistics").style.display="flex",document.getElementById("highlightedWordsList").style.display="block",this.updateStatistics(t),this.displayHighlightedWords(t.highlightedWords)}catch(n){console.error("Analysis error:",n),this.showNotification("Error analyzing text. Please try again.","error")}finally{t.classList.remove("show")}}performTextAnalysis(e){const t=this.textAnalyzer.extractWords(e);return this.textAnalyzer.analyzeWords(t,this.settingsManager.getSetting("difficultyLevel"),this.settingsManager.getSetting("highlightMode"),{learning:this.vocabularyManager.learningWords,mastered:this.vocabularyManager.masteredWords})}refreshTextAnalysis(){if("block"!==document.getElementById("analyzedTextSection").style.display)return;const e=document.getElementById("textInput").value.trim();if(!e)return;const t=this.performTextAnalysis(e),n=this.textAnalyzer.processTextForDisplay(e,t);this.analyzedTextComponent.render(n),this.updateStatistics(t),this.displayHighlightedWords(t.highlightedWords)}updateStatistics(e){document.getElementById("totalWords").textContent=e.totalWords,document.getElementById("highlightedWords").textContent=e.highlightedWords.length,document.getElementById("newWords").textContent=e.newWords.length,document.getElementById("difficultyScore").textContent=e.difficultyScore}displayHighlightedWords(e){const t=document.getElementById("highlightedWordsContainer");t.innerHTML="",0!==e.length?e.forEach(e=>{const n=document.createElement("div");n.className="highlighted-word-item";const a=document.createElement("div");a.innerHTML=e.translation;let s="",i="";const r=a.querySelector(".pron");r&&(s=r.textContent.trim());const o=a.querySelector(".trans");o&&(i=o.textContent.trim()),r||o||(i=e.translation),n.innerHTML=`\n                <div class="word">${e.word}</div>\n                ${s?`<div class="pronunciation">/${s}/</div>`:""}\n                <div class="translation">${i}</div>\n            `,t.appendChild(n)}):t.innerHTML="<p>No highlighted words found.</p>"}updateCounts(){this.vocabularyComponent.updateCounts()}showNotification(e,t="success"){const n=document.createElement("div"),a={success:"#10b981",error:"#ef4444",info:"#3b82f6"};n.style.cssText=`\n            position: fixed; top: 20px; right: 20px; background: ${a[t]||a.success}; color: white;\n            padding: 1rem 1.5rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);\n            z-index: 3000; animation: slideIn 0.3s ease; max-width: 300px; word-wrap: break-word;\n        `,n.textContent=e,document.body.appendChild(n),setTimeout(()=>n.remove(),3e3)}downloadJSON(e,t){const n=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}clearText(){document.getElementById("textInput").value="",document.getElementById("analyzedTextSection").style.display="none",document.getElementById("statistics").style.display="none",document.getElementById("highlightedWordsList").style.display="none",document.getElementById("analyzedText").innerHTML="",document.getElementById("totalWords").textContent="0",document.getElementById("highlightedWords").textContent="0",document.getElementById("newWords").textContent="0",document.getElementById("difficultyScore").textContent="0",document.getElementById("highlightedWordsContainer").innerHTML=""}}document.addEventListener("DOMContentLoaded",()=>{window.wordDiscoverer=new zn});
